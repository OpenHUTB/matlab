<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://www.mathworks.com/help/schema/MathWorksDocPage">
<head>
<meta xmlns="http://www.w3.org/1999/xhtml" charset="utf-8"/>
<meta xmlns="http://www.w3.org/1999/xhtml" name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta xmlns="http://www.w3.org/1999/xhtml" http-equiv="X-UA-Compatible" content="IE=edge"/>
<title>Multiple Object Tracking Tutorial</title>
<script xmlns="http://www.w3.org/1999/xhtml" type="application/ld+json">
      {
      "@context": "http://schema.org",
      "@type": "BreadcrumbList",
      "itemListElement":
      [{
          "@type": "ListItem",
          "position": 1,

          "item": {
          "@id": "../index.html",
          "name": "Automated Driving Toolbox"
}

          } 
        ,
        {
          "@type": "ListItem",
          "position": 2,

          "item": {
          "@id": "../detection-and-tracking.html",
          "name": "Detection and Tracking"
}

          }
        ,
        {
          "@type": "ListItem",
          "position": 3,

          "item": {
          "@id": "../tracking-and-sensor-fusion.html",
          "name": "Tracking and Sensor Fusion"
}

          }]
      }</script>
<script xmlns="http://www.w3.org/1999/xhtml" type="application/ld+json">
        {
        "@context": "http://schema.org",
        "@type": "ItemList",
          "name": "VisibleBreadcrumbs",

        "itemListElement":
        [
        "tracking-and-sensor-fusion"
        ],
        "itemListOrder": "http://schema.org/ItemListOrderAscending"
        }
        </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="application/ld+json">
        {
        "@context": "http://schema.org",
        "@type": "DigitalDocument",
          "headline": "Multiple Object Tracking Tutorial",
          "description": "Perform automatic detection and motion-based tracking of moving objects in a video by using a multi-object tracker.",
          "thumbnailURL": "../../examples/driving/win64/MultipleObjectTrackingExample_01.png",
          "genre": "Live Script",
          "isBasedOn": {
          "@type": "Product",
          "name": "MATLAB"

        },
          "identifier": "driving.MultipleObjectTrackingExample",
          "name": "MultipleObjectTrackingExample",
          "url": "multiple-object-tracking-tutorial.html"

        }</script>
<script xmlns="http://www.w3.org/1999/xhtml" type="application/ld+json">
        {
        "@context": "http://schema.org",
        "@type": "PropertyValue",
          "name": "open_command",
          "value": "matlab:openExample('driving/MultipleObjectTrackingExample')"

        }</script>
<script xmlns="http://www.w3.org/1999/xhtml" type="application/ld+json">
        {
        "@context": "http://schema.org",
        "@type": "ItemList",
          "name": "ExampleSourceFiles",

        "itemListElement":
        [
        "MultipleObjectTrackingExample.mlx"
        ],
        "itemListOrder": "http://schema.org/ItemListOrderAscending"
        }
        </script>
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/bootstrap.min.css" rel="stylesheet" type="text/css"/>


  <meta xmlns="http://www.w3.org/1999/xhtml" http-equiv="Content-Script-Type" content="text/javascript"/>
<meta xmlns="http://www.w3.org/1999/xhtml" name="toctype" itemprop="pagetype" content="ug"/>
<meta xmlns="http://www.w3.org/1999/xhtml" name="infotype" itemprop="infotype" content="ex"/>

<meta xmlns="http://www.w3.org/1999/xhtml" name="description" itemprop="description" content="Perform automatic detection and motion-based tracking of moving objects in a video by using a multi-object tracker."/>
<meta xmlns="http://www.w3.org/1999/xhtml" content="../../examples/driving/win64/MultipleObjectTrackingExample_01.png" itemprop="thumbnailUrl"/>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/jquery/jquery-latest.js"></script>
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/site6.css" rel="stylesheet" type="text/css"/>
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/site6_lg.css" rel="stylesheet" media="screen and (min-width: 1200px)"/>
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/site6_md.css" rel="stylesheet" media="screen and (min-width: 992px) and (max-width: 1199px)"/>
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/site6_sm+xs.css" rel="stylesheet" media="screen and (max-width: 991px)"/>
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/site6_sm.css" rel="stylesheet" media="screen and (min-width: 768px) and (max-width: 991px)"/>
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/site6_xs.css" rel="stylesheet" media="screen and (max-width: 767px)"/>
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/site6_offcanvas_v2.css" rel="stylesheet" type="text/css"/>

<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/l10n.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/docscripts.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/f1help.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/docscripts.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/mw.imageanimation.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/jquery.highlight.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/underscore-min.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/use_platform_screenshots.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/suggest.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/overload.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/helpservices.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/productfilter.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/product_group.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/saxonjs/SaxonJS2.rt.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml">
            window.history.replaceState(window.location.href, null, ""); // Initialize
            window.onload = function() {    
            mystylesheetLocation = "../../includes/shared/scripts/product_group-sef.json";
            mysourceLocation = "../../docset.xml";
            product_help_location = "driving";
            pagetype = "section";
            doccentertype = "product";
            langcode = "";
            getProductFilteredList(mystylesheetLocation, mysourceLocation, product_help_location, pagetype, doccentertype, langcode);  
            }
          </script>




<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/jquery/jquery.mobile.custom.min.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/bootstrap.min.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/global.js"></script>
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/doc_center_base.css" rel="stylesheet" type="text/css"/>
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/doc_center_installed.css" rel="stylesheet" type="text/css"/>
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/doc_center_print.css" rel="stylesheet" type="text/css" media="print"/>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/equationrenderer/release/MathRenderer.js"></script>
</head>
<body id="responsive_offcanvas">
<div xmlns="http://www.w3.org/1999/xhtml" id="doc_header_spacer" class="header"></div>
<div xmlns="http://www.w3.org/1999/xhtml" class="section_header level_3"><div class="container-fluid"><div class="row" id="mobile_search_row"><div class="col-sm-6 col-md-7 has_horizontal_local_nav" id="section_header_title"><div class="section_header_content"><div class="section_header_title"><h1><a href="../../documentation-center.html">Help Center</a></h1>
</div>
</div>
</div>
<div class="col-xs-12 col-sm-6 col-md-5" id="mobile_search"><div class="search_nested_content_container"><form id="docsearch_form" name="docsearch_form" method="get" data-release="R2022b" data-language="en" action="../../templates/searchresults.html"><div class="input-group tokenized_search_field"><label class="sr-only">Search Help</label><input type="text" class="form-control conjoined_search" autocomplete="off" name="qdoc" placeholder="Search Help" id="docsearch"/> <div class="input-group-btn"><button type="submit" name="submitsearch" id="submitsearch" class="btn icon-search btn_search_adjacent btn_search icon_16" tabindex="-1"></button></div>
</div></form>
</div>
<button class="btn icon-remove btn_search pull-right icon_32 visible-xs" data-toggle="collapse" href="#mobile_search" aria-expanded="false" aria-controls="mobile_search"></button></div>
<div class="visible-xs" id="search_actuator"><button class="btn icon-search btn_search pull-right icon_16" data-toggle="collapse" href="#mobile_search" aria-expanded="false" aria-controls="mobile_search"></button></div>
</div>
</div>
</div>
<div class="row-offcanvas row-offcanvas-left">
<div xmlns="http://www.w3.org/1999/xhtml" class="sidebar-offcanvas" id="sidebar">
<nav class="offcanvas_nav" role="navigation">
<div class="offcanvas_actuator" data-toggle="offcanvas" data-target="#sidebar" id="nav_toggle"><button type="button" class="btn"><span class="sr-only">Off-Canvas Navigation Menu Toggle
                  Off-Canvas Navigation Menu Toggle</span><span class="icon-menu"></span></button><span class="offcanvas_actuator_label" id="translation_icon-menu" tabindex="-1" aria-hidden="true"></span></div><div class="nav_list_wrapper" id="nav_list_wrapper"><nav class="offcanvas_nav" role="navigation"><ul class="nav_breadcrumb" id="ul_left_nav_ancestors"><li itemscope="" itemtype="http://www.data-vocabulary.org/Breadcrumb" itemprop="breadcrumb"><a href="../../documentation-center.html?s_tid=CRUX_lftnav" itemprop="url"><span itemprop="title">Documentation Home</span></a></li>
</ul><ul class="nav_breadcrumb" id="ul_left_nav_productgroups"><li itemscope="" itemtype="http://www.data-vocabulary.org/Breadcrumb" itemprop="breadcrumb"><a href="../../overview/robotics-and-autonomous-systems.html" itemprop="url"><span itemprop="title">Robotics and Autonomous Systems</span></a></li>
<li itemscope="" itemtype="http://www.data-vocabulary.org/Breadcrumb" itemprop="breadcrumb"><a href="../../overview/automotive.html" itemprop="url"><span itemprop="title">Automotive</span></a></li>
</ul>
<ul class="nav_disambiguation"><li><a href="../index.html?s_tid=CRUX_lftnav">Automated Driving Toolbox</a>
</li>
<li itemscope="" itemtype="http://www.data-vocabulary.org/Breadcrumb" itemprop="breadcrumb"><a href="../detection-and-tracking.html?s_tid=CRUX_lftnav" itemprop="url"><span itemprop="title">Detection and Tracking</span></a></li>
<li itemscope="" itemtype="http://www.data-vocabulary.org/Breadcrumb" itemprop="breadcrumb"><a href="../tracking-and-sensor-fusion.html?s_tid=CRUX_lftnav" itemprop="url"><span itemprop="title">Tracking and Sensor Fusion</span></a></li>
</ul><ul class="nav_scrollspy nav">
<li class="nav_scrollspy_function"><a href="#responsive_offcanvas">Multiple Object Tracking Tutorial</a></li>
<li class="nav_scrollspy_title" id="SSPY810-section">On this page</li>
<!--ADD_REFENTRY_TITLE_HERE 11--><li><a href="#MultipleObjectTrackingExample-1" class="intrnllnk">Set Up Vehicle Detector and Video Objects</a></li>
<li><a href="#MultipleObjectTrackingExample-2" class="intrnllnk">Create Multi-Object Tracker</a></li>
<li><a href="#MultipleObjectTrackingExample-3" class="intrnllnk">Detect and Track Objects</a></li>
<li><a href="#MultipleObjectTrackingExample-4" class="intrnllnk">Conclusion and Next Steps</a></li>
<li><a href="#MultipleObjectTrackingExample-5" class="intrnllnk">Supporting Functions</a></li>
<li><a href="#d124e29285" class="intrnllnk">See Also</a></li>
<li><a href="#d124e29313" class="intrnllnk">Related Topics</a></li>
</ul>
</nav>
</div></nav>
<script src="../../includes/product/scripts/offcanvas_v2.js"></script>
</div>
<!--END.CLASS sidebar-offcanvas--><div class="offcanvas_content_container">
<div xmlns="http://www.w3.org/1999/xhtml" class="sticky_header_container"><div class="horizontal_nav"><div class="horizontal_nav_container"><div class="offcanvas_horizontal_nav"><div class="container-fluid"><div class="row"><div class="col-sm-12 hidden-xs"><nav class="navbar navbar-default" role="navigation" id="subnav"><div><ul class="nav navbar-nav crux_browse"><li id="crux_nav_documentation" class="crux_resource active"><a>Documentation</a></li>
<li id="crux_nav_example" class="crux_resource"><a href="../examples.html?category=tracking-and-sensor-fusion&amp;s_tid=CRUX_topnav">Examples</a></li>
<li id="crux_nav_function" class="crux_resource"><a href="../referencelist.html?type=function&amp;category=tracking-and-sensor-fusion&amp;s_tid=CRUX_topnav">Functions</a></li>
<li id="crux_nav_block" class="crux_resource"><a href="../referencelist.html?type=block&amp;category=tracking-and-sensor-fusion&amp;s_tid=CRUX_topnav">Blocks</a></li>
<li id="crux_nav_app" class="crux_resource"><a href="../referencelist.html?type=app&amp;category=tracking-and-sensor-fusion&amp;s_tid=CRUX_topnav">Apps</a></li>
<li id="crux_nav_scene" class="crux_resource"><a href="../referencelist.html?type=scene&amp;category=tracking-and-sensor-fusion&amp;s_tid=CRUX_topnav">Scenes</a></li>
</ul>
</div></nav>
</div>
<div class="visible-xs"><div class="container-fluid"><div class="row"><div class="col-xs-9"><div class="mobile_crux_nav_trigger"><div class="btn-group"><button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Resources<span class="icon-arrow-down icon_16"></span></button><ul class="dropdown-menu"><li id="crux_nav_mobile_documentation" class="crux_resource active"><a>Documentation</a></li>
<li id="crux_nav_mobile_example" class="crux_resource"><a href="../examples.html?category=tracking-and-sensor-fusion&amp;s_tid=CRUX_topnav">Examples</a></li>
<li id="crux_nav_mobile_function" class="crux_resource"><a href="../referencelist.html?type=function&amp;category=tracking-and-sensor-fusion&amp;s_tid=CRUX_topnav">Functions</a></li>
<li id="crux_nav_mobile_block" class="crux_resource"><a href="../referencelist.html?type=block&amp;category=tracking-and-sensor-fusion&amp;s_tid=CRUX_topnav">Blocks</a></li>
<li id="crux_nav_mobile_app" class="crux_resource"><a href="../referencelist.html?type=app&amp;category=tracking-and-sensor-fusion&amp;s_tid=CRUX_topnav">Apps</a></li>
<li id="crux_nav_mobile_scene" class="crux_resource"><a href="../referencelist.html?type=scene&amp;category=tracking-and-sensor-fusion&amp;s_tid=CRUX_topnav">Scenes</a></li>
</ul>
</div>
</div>
</div>
<div class="col-xs-3"><div class="translate_placeholder"></div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="content_container" id="content_container" itemprop="content">
<div class="container-fluid">
<div class="row">
<div class="col-xs-12">

<div xmlns="http://www.w3.org/1999/xhtml" id="product_info_alert"></div>
<section xmlns="http://www.w3.org/1999/xhtml" id="doc_center_content" lang="en" data-language="en"><div id="pgtype-topic">
<section itemprop="content"><h1 class="r2022b" itemprop="title content" id="mw_cbbec159-67a1-46f5-adf4-bfdcfa841230">多对象跟踪教程</h1>
<div class="examples_short_list hidden_ios_android"><div data-pane="metadata" class="panel metadata_container panel-default"><div class="panel-body metadata_content"><a class="btn btn_secondary btn-block" href="matlab:openExample('driving/MultipleObjectTrackingExample')" data-ex-genre="Live Script">Open Live Script</a></div>
</div>
</div>
<div itemscope="" itemtype="http://www.mathworks.com/help/schema/MathWorksDocPage/Example" itemprop="example" class="em_example"><meta itemprop="exampleid" content="driving-MultipleObjectTrackingExample"/>
<meta itemprop="exampletitle" content="Multiple Object Tracking Tutorial"/>
</div>
<span id="MultipleObjectTrackingExample" class="anchor_target"></span><p class="shortdesc">这个例子展示了如何使用 <code class="literal"></code><a href="../ref/multiobjecttracker-system-object.html" data-docid="driving_ref#bvigrmf-1" class="a"><code class="olink">multiObjectTracker</code></a> System object™在视频中进行移动物体的自动检测和基于运动的跟踪。</p>
<p><span style="font-family: &quot;Microsoft YaHei&quot;;">移动物体检测和基于运动的跟踪是自适应巡航控制、自动紧急制动和自动驾驶等自动驾驶辅助系统的重要组成部分。您可以将基于运动的对象追踪分为两部分：</span></p>
<div class="orderedlist"><ol style="list-style: decimal;"><li><p>检测每帧中的移动物体。<br/></p></li>
<li><p>从一帧到另一帧跟踪移动对象。<br/></p></li>
</ol>
</div>
<p><span style="font-family: &quot;Microsoft YaHei&quot;;">使用预训练的聚合通道特征 </span>(ACF) <span style="font-family: &quot;Microsoft YaHei&quot;;">车辆检测器来检测移动物体。</span></p>
<p>然后，使用 <code class="literal">multiObjectTracker</code> 对象从帧到帧跟踪移动物体。<code class="literal">multiObjectTracker</code> 对象负责以下任务：</p>
<div class="orderedlist"><ol style="list-style: decimal;"><li><p>将检测分配给轨道。<br/></p></li>
<li><p>根据未分配的检测初始化新轨道。</p></li>
<li><p>确认轨道在 <span class="emphasis" _istranslated="1"><em _istranslated="1">N</em></span> 帧中分配的检测数是否超过 <span class="emphasis" _istranslated="1"><em _istranslated="1">M</em></span> 个。<br/></p></li>
<li><p>根据分配的检测更新现有轨道。<br/></p></li>
<li><p>滑行（预测）现有的未分配轨道。<br/></p></li>
<li><p>如果轨迹长时间未分配（滑行），则删除轨迹。<br/></p></li>
</ol>
</div>
<p>在这个例子中，您在相机的帧中跟踪车辆，以像素为单位测量车辆位置，以帧计数为单位测量时间。您使用卡尔曼滤波器估计每个轨迹的运动。该滤波器在每个帧中预测轨迹的像素位置，并确定每个检测被分配给每个轨迹的可能性。要初始化您设计的滤波器，请使用 <code class="literal">FilterInitializationFcn</code> 的 <span style="font-family: monospace;">multiObjectTracker </span>属性。</p>
<p><span style="font-family: &quot;Microsoft YaHei&quot;;">有关详细信息，请参阅</span> <a href="../../vision/ug/multiple-object-tracking.html" data-docid="vision_ug#buq9qny-1" class="a">Multiple Object Tracking</a><span style="font-family: &quot;Microsoft YaHei&quot;;">。</span></p>
<div class="procedure"><h3 class="title" id="MultipleObjectTrackingExample-1"><strong class="emphasis bold" _msttexthash="60210761" _msthash="49" style="font-family: &quot;Microsoft YaHei&quot;;">设置车辆检测器和视频对象</strong></h3>
<p><span style="font-family: &quot;Microsoft YaHei&quot;;">创建一个 ACF 车辆检测器，使用来自车辆前后侧的无遮挡图像进行预训练。</span></p>
<div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>detector = vehicleDetectorACF(<span style="color:#A020F0">"front-rear-view"</span>);</pre>
</div>
</div>
</div>
<p><span style="font-family: &quot;Microsoft YaHei&quot;;">创建对象以读取和显示视频帧。</span></p>
<div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>vReader = VideoReader(<span style="color:#A020F0">"05_highway_lanechange_25s.mp4"</span>);
trackPlayer = vision.VideoPlayer(Position=[700 400 700 400]);</pre>
</div>
</div>
</div>
<h3 class="title" id="MultipleObjectTrackingExample-2">创建多对象跟踪器</h3>
<p><span style="font-family: &quot;Microsoft YaHei&quot;;">创建一个 </span> <code class="literal">multiObjectTracker</code><span style="font-family: &quot;Microsoft YaHei&quot;;">，指定以下属性：</span></p>
<div class="orderedlist"><ol style="list-style: decimal;"><li><p><code class="literal">FilterInitializationFcn</code> — 这个函数指定了卡尔曼滤波器的运动模型和测量模型。在这个例子中，因为您预期车辆具有恒定的速度，所以指定 <code class="literal">helperInitDemoFilter</code> 函数，该函数配置一个线性卡尔曼滤波器来跟踪车辆的运动。有关更多信息，请参阅 <a href="multiple-object-tracking-tutorial.html#MultipleObjectTrackingExample-6" class="intrnllnk">Supporting Functions</a> 部分。</p></li>
<li><p><code class="literal">AssignmentThreshold</code> — 距离轨迹的最大准确归一化距离，在此距离内，跟踪器可以将检测分配给该轨迹。如果有未分配给轨迹但应该分配的检测，请增加此值。如果有分配给距离太远轨迹的检测，请减小此值。对于这个例子，请指定一个阈值为 30。 </p></li>
<li><p><code class="literal">DeletionThreshold</code> — 在删除之前，跟踪器在没有检测的情况下保持轨迹的更新次数。在这个例子中，指定一个值为15帧。因为视频每秒有20帧，所以跟踪器会删除在0.75秒内没有分配检测的轨迹。</p></li>
<li><p><code class="literal">ConfirmationThreshold</code> — 轨迹必须接收的检测数量以及确认所需的更新次数。跟踪器使用每个未分配的检测初始化一个轨迹。由于其中一些检测可能是错误的，所以最初所有的轨迹都是 <code class="literal">'Tentative'</code>（暂定的）。要确认一个轨迹，它必须在 <span class="emphasis"><em>N</em></span> 帧中至少被检测到 <span class="emphasis"><em>M</em></span> 次。选择 <span class="emphasis"><em>M</em></span> 和 <span class="emphasis"><em>N</em></span> 取决于物体的可见性。这个例子</p></li>
</ol>
</div>
<div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>tracker = multiObjectTracker(<span style="color:#0000FF">...</span>
FilterInitializationFcn=@helperInitDemoFilter, <span style="color:#0000FF">...</span>
AssignmentThreshold=30, <span style="color:#0000FF">...</span>
DeletionThreshold=15, <span style="color:#0000FF">...</span>
ConfirmationThreshold=[3 5] <span style="color:#0000FF">...</span><span style="color:#228B22"> </span>
);</pre>
</div>
</div>
</div>
<h3 class="title" id="MultipleObjectTrackingExample-3">检测和跟踪对象</h3>
<p><span style="font-family: &quot;Microsoft YaHei&quot;;">使用循环运行视频剪辑，检测视频中的移动对象，并在每次迭代中使用以下步骤跨视频帧跟踪它们：</span></p>
<div class="orderedlist"><ol style="list-style: decimal;"><li><p>使用预训练的 ACF 车辆检测器获取帧中所有车辆的边界框。</p></li>
<li><p>丢弃置信度分数低于 5% 的边界框，并计算其余边界框的质心。<br/></p></li>
<li><p>使用检测到的边界框的质心作为测量值，并使用当前的 <span style="font-family: monospace;">frameCount </span>作为时间输入，创建一个包含 <code class="literal">objectDetection</code> 对象的单元数组。 </p></li>
<li><p>使用 <span style="font-family: monospace;">tracker </span>函数基于新的检测结果获取确认的轨迹。</p></li>
<li><p>显示每帧的跟踪结果。<br/></p></li>
</ol>
</div>
<p>在创建 <code class="literal">objectDetection</code> 对象的单元数组时，请为每个 <code class="literal">objectDetection</code> 对象指定以下属性：</p>
<div class="itemizedlist"><ul><li><p><code class="literal">MeasurementNoise</code> — 物体检测测量值有噪声。为了对此进行建模，此示例将测量噪声协方差定义为 100。这意味着测量值在 <span class="emphasis" _mstmutation="1" _istranslated="1" style="font-family: &quot;Microsoft YaHei&quot;;"><em _istranslated="1">x</em></span><span style="font-family: &quot;Microsoft YaHei&quot;;"> 和 </span><span class="emphasis" _mstmutation="1" _istranslated="1" style="font-family: &quot;Microsoft YaHei&quot;;"><em _istranslated="1">y </em></span><span style="font-family: &quot;Microsoft YaHei&quot;;">方向上的方差均为 10 像素。</span></p></li>
<li><p><code class="literal">ObjectClassID</code> — 对象类标识符，在本例中指定为 <span style="font-family: monospace;">1 </span>。跟踪器将具有此 ID 的所有后续检测视为已知对象。如果无法将此 ID 的检测分配给现有轨迹，则跟踪器会立即从中确认新轨迹。</p></li>
<li><p><code class="literal">ObjectAttributes</code> — 传递到轨迹显示的检测到的边界框将添加到此参数中。</p></li>
</ul>
</div>
<div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre><span style="color:#228B22">% Measurement noise for vehicle detections </span>
measurementNoise = 100;

frameCount = 1;
<span style="color:#0000FF">while</span> hasFrame(vReader)
    <span style="color:#228B22">% Read new frame and resize it to the YOLO v2 detector input size</span>
    frame = readFrame(vReader);

    <span style="color:#228B22">% Detect vehicles in the frame and retain bounding boxes with greater than 5% confidence score</span>
    [bboxes,scores] = detect(detector,frame);
    bboxes = bboxes(scores&gt;5,:);

    <span style="color:#228B22">% Calculate the centroids of the bounding boxes</span>
    centroids = [bboxes(:,1)+floor(bboxes(:,3)/2) bboxes(:,2)+floor(bboxes(:,4)/2)];

    <span style="color:#228B22">% Formulate the detections as a list of objectDetection objects</span>
    numDetections = size(centroids,1);
    detections = cell(numDetections,1);
    <span style="color:#0000FF">for</span> i = 1:numDetections
        detections{i} = objectDetection(frameCount,centroids(i,:)', <span style="color:#0000FF">...</span>
            MeasurementNoise=measurementNoise, <span style="color:#0000FF">...</span>
            ObjectAttributes=struct(BoundingBox=bboxes(i,:)),ObjectClassID=1);
    <span style="color:#0000FF">end</span>
    
    <span style="color:#228B22">% Update tracks based on detections</span>
    confirmedTracks = tracker(detections,frameCount);

    <span style="color:#228B22">% Display tracking results and increase frame count by 1    </span>
    displayTrackingResults(trackPlayer,confirmedTracks,frame);
    frameCount = frameCount + 1; 
<span style="color:#0000FF">end</span></pre>
</div>
</div>
</div>
<div class="informalfigure"><div id="d124e29178" class="mediaobject"><p><img src="../../examples/driving/win64/MultipleObjectTrackingExample_01.png" alt="{&quot;String&quot;:&quot;Figure Video Player contains an axes object and other objects of type uiflowcontainer, uimenu, uitoolbar. The axes object contains an object of type image.&quot;,&quot;Tex&quot;:[],&quot;LaTex&quot;:[]}" width="700"/></p>
</div>
</div>
<h3 class="title" id="MultipleObjectTrackingExample-4">结论和下一步</h3>
<p>在这个例子中，你创建了一个基于运动的系统，用于检测和跟踪多个移动物体。尝试使用不同的视频来看看是否可以检测和跟踪物体。尝试修改 <code class="literal">multiObjectTracker </code>的参数。</p>
<p>这个例子中的跟踪仅基于运动，假设所有物体以恒定速度直线运动。当物体的运动与这个模型显著偏离时，该示例可能会产生跟踪错误。请注意，在自车换道时，跟踪部分被遮挡的车辆时出现的错误。</p>
<p>你可以通过使用更复杂的运动模型（如恒定加速度或恒定转向）来减少跟踪错误的可能性。你还可以尝试定义不同的跟踪滤波器，如 <code class="literal">trackingEKF</code> or <code class="literal">trackingUKF</code>.</p>
<h3 class="title" id="MultipleObjectTrackingExample-5">Supporting Functions</h3>
<h4 class="title" id="MultipleObjectTrackingExample-6">Define a Kalman Filter<span id="mw_rtc_MultipleObjectTrackingExample_H_373354EB" class="anchor_target"></span></h4>
<p>在这个例子中定义运动的跟踪滤波器时，<code class="literal">helperInitDemoFilter</code> 遵循以下步骤：</p>
<p><strong class="emphasis bold">Step 1: Define the motion model and state</strong></p>
<p>In this example, use a constant velocity model in a 2-D rectangular frame.</p>
<div class="orderedlist"><ol style="list-style: decimal;"><li><p>The state is <code class="literal">[x;vx;y;vy]</code>.</p></li>
<li><p>The state transition model matrix is <code class="literal">A = [1 dt 0 0; 0 1 0 0; 0 0 1 dt; 0 0 0 1]</code>.</p></li>
<li><p>Assume that <code class="literal">dt = 1</code>.</p></li>
</ol>
</div>
<p><strong class="emphasis bold">Step 2: Define the process noise</strong></p>
<p>The process noise represents the parts of the process that are not taken into account in the model. For example, in a constant velocity model, the acceleration is neglected.</p>
<p><strong class="emphasis bold">Step 3: Define the measurement model</strong></p>
<p>In this example, only the position (<code class="literal">[x;y]</code>) is measured. So, the measurement model is <code class="literal">H = [1 0 0 0; 0 0 1 0]</code>.  </p>
<p>Note: To preconfigure these parameters, define the <code class="literal">'MotionModel'</code> property as <code class="literal">'2D Constant Velocity'</code>.</p>
<p><strong class="emphasis bold">Step 4: Initialize the state vector based on the sensor measurement</strong></p>
<p>In this example, because the measurement is <code class="literal">[x;y]</code> and the state is <code class="literal">[x;vx;y;vy]</code>, initializing the state vector is straightforward. Because there is no measurement of the velocity, initialize the <code class="literal">vx</code> and <code class="literal">vy</code> components to 0.</p>
<p><strong class="emphasis bold">Step 5: Define an initial state covariance</strong></p>
<p>In this example, only<span class="emphasis"><em> </em></span>positions are measured directly. Hence define the initial state covariance for position components to be same as the corresponding measurement noise values. Because there are no direct measurments for velocity, define the covariance for velocity components to have a larger value. </p>
<p><strong class="emphasis bold">Step 6: Create the correct filter</strong></p>
<p>In this example, all the models are linear, so use <code class="literal">trackingKF</code> as the tracking filter.</p>
<div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre><span style="color:#0000FF">function</span> filter = helperInitDemoFilter(detection)
    <span style="color:#228B22">% Initialize a Kalman filter for this example.</span>
    
    <span style="color:#228B22">% Define the initial state.</span>
    state = [detection.Measurement(1); 0; detection.Measurement(2); 0];
    
    <span style="color:#228B22">% Define the initial state covariance.</span>
    stateCov = diag([detection.MeasurementNoise(1,1) <span style="color:#0000FF">...</span>
                    detection.MeasurementNoise(1,1)*100 <span style="color:#0000FF">...</span>
                    detection.MeasurementNoise(2,2) <span style="color:#0000FF">...</span>
                    detection.MeasurementNoise(2,2)*100]);
    
    <span style="color:#228B22">% Create the tracking filter.</span>
    filter = trackingKF(<span style="color:#A020F0">'MotionModel'</span>,<span style="color:#A020F0">'2D Constant Velocity'</span>, <span style="color:#0000FF">...</span><span style="color:#228B22">    </span>
        <span style="color:#A020F0">'State'</span>,state, <span style="color:#0000FF">...</span>
        <span style="color:#A020F0">'StateCovariance'</span>,stateCov, <span style="color:#0000FF">...</span><span style="color:#228B22"> </span>
        <span style="color:#A020F0">'MeasurementNoise'</span>,detection.MeasurementNoise);
<span style="color:#0000FF">end</span></pre>
</div>
</div>
</div>
<h4 class="title" id="MultipleObjectTrackingExample-7">Display Tracking Results</h4>
<p>The <code class="literal">displayTrackingResults</code> function draws a bounding box and label ID for each track on the video frame. It then displays the frame in the video player.</p>
<div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre><span style="color:#0000FF">function</span> displayTrackingResults(videoPlayer,confirmedTracks,frame)
    <span style="color:#0000FF">if</span> ~isempty(confirmedTracks)
        <span style="color:#228B22">% Display the objects. If an object has not been detected</span>
        <span style="color:#228B22">% in this frame, display its predicted bounding box.</span>
        numRelTr = numel(confirmedTracks);
        boxes = zeros(numRelTr,4);
        ids = zeros(numRelTr,1, <span style="color:#A020F0">'int32'</span>);
        predictedTrackInds = zeros(numRelTr,1);
        <span style="color:#0000FF">for</span> tr = 1:numRelTr
            <span style="color:#228B22">% Get bounding boxes.</span>
            boxes(tr,:) = confirmedTracks(tr).ObjectAttributes.BoundingBox;

            <span style="color:#228B22">% Get IDs.</span>
            ids(tr) = confirmedTracks(tr).TrackID;

            <span style="color:#0000FF">if</span> confirmedTracks(tr).IsCoasted
                predictedTrackInds(tr) = tr;
            <span style="color:#0000FF">end</span>
        <span style="color:#0000FF">end</span>

        predictedTrackInds = predictedTrackInds(predictedTrackInds &gt; 0);

        <span style="color:#228B22">% Create labels for objects that display the predicted rather</span>
        <span style="color:#228B22">% than the actual location.</span>
        labels = cellstr(int2str(ids));

        isPredicted = cell(size(labels));
        isPredicted(predictedTrackInds) = {<span style="color:#A020F0">' predicted'</span>};
        labels = strcat(labels,isPredicted);

        <span style="color:#228B22">% Draw the objects on the frame.</span>
        frame = insertObjectAnnotation(frame,<span style="color:#A020F0">"rectangle"</span>,boxes,labels);
    <span style="color:#0000FF">end</span>

    <span style="color:#228B22">% Display the mask and the frame.</span>
    videoPlayer.step(frame);
<span style="color:#0000FF">end</span></pre>
</div>
</div>
</div>
</div>
      <h2 id="d124e29285">See Also</h2>
<h3>Objects</h3>
<ul class="list-unstyled margined_10"><li><span itemscope="" itemtype="http://www.mathworks.com/help/schema/MathWorksDocPage/SeeAlso" itemprop="seealso"><a itemprop="url" href="../ref/trackingkf.html"><span itemprop="name"><code class="object">trackingKF</code></span></a></span> | <span itemscope="" itemtype="http://www.mathworks.com/help/schema/MathWorksDocPage/SeeAlso" itemprop="seealso"><a itemprop="url" href="../ref/trackingekf.html"><span itemprop="name"><code class="object">trackingEKF</code></span></a></span> | <span itemscope="" itemtype="http://www.mathworks.com/help/schema/MathWorksDocPage/SeeAlso" itemprop="seealso"><a itemprop="url" href="../ref/trackingukf.html"><span itemprop="name"><code class="object">trackingUKF</code></span></a></span> | <span itemscope="" itemtype="http://www.mathworks.com/help/schema/MathWorksDocPage/SeeAlso" itemprop="seealso"><a itemprop="url" href="../ref/objectdetection.html"><span itemprop="name"><code class="object">objectDetection</code></span></a></span> | <span itemscope="" itemtype="http://www.mathworks.com/help/schema/MathWorksDocPage/SeeAlso" itemprop="seealso"><a itemprop="url" href="../../vision/ref/vision.videoplayer-system-object.html"><span itemprop="name"><code class="sysobj">vision.VideoPlayer</code></span></a></span> | <span itemscope="" itemtype="http://www.mathworks.com/help/schema/MathWorksDocPage/SeeAlso" itemprop="seealso"><a itemprop="url" href="../../matlab/ref/videoreader.html"><span itemprop="name"><code class="object">VideoReader</code></span></a></span> | <span itemscope="" itemtype="http://www.mathworks.com/help/schema/MathWorksDocPage/SeeAlso" itemprop="seealso"><a itemprop="url" href="../ref/multiobjecttracker-system-object.html"><span itemprop="name"><code class="sysobj">multiObjectTracker</code></span></a></span></li>
</ul>
      <h2 id="d124e29313">Related Topics</h2>
<ul><li><a href="track-multiple-vehicles-using-a-camera.html" class="a">Track Multiple Vehicles Using a Camera</a></li>
<li><a href="../../vision/ug/multiple-object-tracking.html" class="a">Multiple Object Tracking</a></li>
<li><a href="../../vision/ug/motion-based-multiple-object-tracking.html" class="a">Motion-Based Multiple Object Tracking</a></li>
</ul>
    </section>
    </div>
<div class="modal fade" id="open-example-dialog" tabindex="-1" role="dialog" aria-labelledby="openExampleDialogLabel" aria-hidden="true"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button><h2 class="h3 modal-title">Open Example</h2>
</div>
<div class="modal-body" id="dialog-body"><p>You have a modified version of this example. Do you want to open this example with your edits?</p>
</div>
<div class="modal-footer"><a id="open-example-dialog-replace" class="btn btn_color_blue companion_btn" data-dismiss="modal">No, open this example and discard my edits</a><a id="open-example-dialog-continue" class="btn btn_color_blue" data-dismiss="modal">Yes</a></div>
</div>
</div>
</div>
<div class="clearfix"></div>
<div align="center" class="feedbackblock" id="mw_docsurvey"><script src="https://www.mathworks.com/help/docsurvey/docfeedback.js"></script>
<script>loadSurveyHidden();</script>
<link rel="stylesheet" href="https://www.mathworks.com/help/docsurvey/release/index-css.css" type="text/css"/>
<script src="https://www.mathworks.com/help/docsurvey/release/bundle.index.js"></script>

<script>initDocSurvey();</script>
</div>
</section>


</div>
</div>
</div>
</div>
<!--close_0960--><footer xmlns="http://www.w3.org/1999/xhtml" id="footer" class="bs-footer">
<div class="container-fluid">
<div class="footer">
<div class="row">
<div class="col-xs-12">
<p class="copyright">© 1994-2022 The MathWorks, Inc.</p>
<ul class="footernav"><li class="footernav_help"><a href="matlab:web(matlab.internal.licenseAgreement)">Terms of Use</a></li>
<li class="footernav_patents"><a href="matlab:web([matlabroot '/patents.txt'])">Patents</a></li>
<li class="footernav_trademarks"><a href="matlab:web([matlabroot '/trademarks.txt'])">Trademarks</a></li>
<li class="footernav_piracy"><a href="matlab:web([docroot '/acknowledgments.html'])">Acknowledgments</a></li>
</ul>
</div>
</div>
</div>
</div>
</footer>
</div>
<!--close row-offcanvas--></div>
<!--close_0970-->
</body>
</html>
<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://www.mathworks.com/help/schema/MathWorksDocPage">
<head>
<meta xmlns="http://www.w3.org/1999/xhtml" charset="utf-8"/>
<meta xmlns="http://www.w3.org/1999/xhtml" name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta xmlns="http://www.w3.org/1999/xhtml" http-equiv="X-UA-Compatible" content="IE=edge"/>
<title>Use HERE HD Live Map Data to Verify Lane Configurations</title>
<script xmlns="http://www.w3.org/1999/xhtml" type="application/ld+json">
      {
      "@context": "http://schema.org",
      "@type": "BreadcrumbList",
      "itemListElement":
      [{
          "@type": "ListItem",
          "position": 1,

          "item": {
          "@id": "../index.html",
          "name": "Automated Driving Toolbox"
}

          } 
        ,
        {
          "@type": "ListItem",
          "position": 2,

          "item": {
          "@id": "../localization-and-mapping.html",
          "name": "Localization and Mapping"
}

          }
        ,
        {
          "@type": "ListItem",
          "position": 3,

          "item": {
          "@id": "../geographic-and-hd-maps.html",
          "name": "Geographic and HD Maps"
}

          }]
      }</script>
<script xmlns="http://www.w3.org/1999/xhtml" type="application/ld+json">
        {
        "@context": "http://schema.org",
        "@type": "ItemList",
          "name": "VisibleBreadcrumbs",

        "itemListElement":
        [
        "geographic-and-hd-maps"
        ],
        "itemListOrder": "http://schema.org/ItemListOrderAscending"
        }
        </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="application/ld+json">
        {
        "@context": "http://schema.org",
        "@type": "DigitalDocument",
          "headline": "Use HERE HD Live Map Data to Verify Lane Configurations",
          "description": "Read and visualize lane configurations for a recorded driving route from the HERE HD Live Map (HDLM) service.",
          "thumbnailURL": "../../examples/driving/win64/UseHEREHDLiveMapDataToVerifyLaneConfigurationsExample_07.png",
          "genre": "Script",
          "isBasedOn": {
          "@type": "Product",
          "name": "MATLAB"

        },
          "identifier": "driving.UseHEREHDLiveMapDataToVerifyLaneConfigurationsExample",
          "name": "UseHEREHDLiveMapDataToVerifyLaneConfigurationsExample",
          "url": "use-here-hd-live-map-data-to-verify-lane-configurations.html"

        }</script>
<script xmlns="http://www.w3.org/1999/xhtml" type="application/ld+json">
        {
        "@context": "http://schema.org",
        "@type": "PropertyValue",
          "name": "open_command",
          "value": "matlab:openExample('driving/UseHEREHDLiveMapDataToVerifyLaneConfigurationsExample')"

        }</script>
<script xmlns="http://www.w3.org/1999/xhtml" type="application/ld+json">
        {
        "@context": "http://schema.org",
        "@type": "ItemList",
          "name": "ExampleSourceFiles",

        "itemListElement":
        [
        "UseHEREHDLiveMapDataToVerifyLaneConfigurationsExample.m",
        "HelperHDLMUI.m",
        "HelperLaneGroupMatcher.m",
        "HelperLinkMatcher.m"
        ],
        "itemListOrder": "http://schema.org/ItemListOrderAscending"
        }
        </script>
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/bootstrap.min.css" rel="stylesheet" type="text/css"/>


  <meta xmlns="http://www.w3.org/1999/xhtml" http-equiv="Content-Script-Type" content="text/javascript"/>
<meta xmlns="http://www.w3.org/1999/xhtml" name="toctype" itemprop="pagetype" content="ug"/>
<meta xmlns="http://www.w3.org/1999/xhtml" name="infotype" itemprop="infotype" content="other"/>

<meta xmlns="http://www.w3.org/1999/xhtml" name="description" itemprop="description" content="Read and visualize lane configurations for a recorded driving route from the HERE HD Live Map (HDLM) service."/>
<meta xmlns="http://www.w3.org/1999/xhtml" content="../../examples/driving/win64/UseHEREHDLiveMapDataToVerifyLaneConfigurationsExample_07.png" itemprop="thumbnailUrl"/>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/jquery/jquery-latest.js"></script>
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/site6.css" rel="stylesheet" type="text/css"/>
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/site6_lg.css" rel="stylesheet" media="screen and (min-width: 1200px)"/>
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/site6_md.css" rel="stylesheet" media="screen and (min-width: 992px) and (max-width: 1199px)"/>
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/site6_sm+xs.css" rel="stylesheet" media="screen and (max-width: 991px)"/>
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/site6_sm.css" rel="stylesheet" media="screen and (min-width: 768px) and (max-width: 991px)"/>
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/site6_xs.css" rel="stylesheet" media="screen and (max-width: 767px)"/>
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/site6_offcanvas_v2.css" rel="stylesheet" type="text/css"/>

<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/l10n.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/docscripts.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/f1help.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/docscripts.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/mw.imageanimation.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/jquery.highlight.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/underscore-min.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/use_platform_screenshots.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/suggest.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/overload.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/helpservices.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/productfilter.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/product_group.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/saxonjs/SaxonJS2.rt.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml">
            window.history.replaceState(window.location.href, null, ""); // Initialize
            window.onload = function() {    
            mystylesheetLocation = "../../includes/shared/scripts/product_group-sef.json";
            mysourceLocation = "../../docset.xml";
            product_help_location = "driving";
            pagetype = "section";
            doccentertype = "product";
            langcode = "";
            getProductFilteredList(mystylesheetLocation, mysourceLocation, product_help_location, pagetype, doccentertype, langcode);  
            }
          </script>




<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/jquery/jquery.mobile.custom.min.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/bootstrap.min.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/global.js"></script>
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/doc_center_base.css" rel="stylesheet" type="text/css"/>
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/doc_center_installed.css" rel="stylesheet" type="text/css"/>
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/doc_center_print.css" rel="stylesheet" type="text/css" media="print"/>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/equationrenderer/release/MathRenderer.js"></script>
</head>
<body id="responsive_offcanvas">
<div xmlns="http://www.w3.org/1999/xhtml" id="doc_header_spacer" class="header"></div>
<div xmlns="http://www.w3.org/1999/xhtml" class="section_header level_3"><div class="container-fluid"><div class="row" id="mobile_search_row"><div class="col-sm-6 col-md-7 has_horizontal_local_nav" id="section_header_title"><div class="section_header_content"><div class="section_header_title"><h1><a href="../../documentation-center.html">Help Center</a></h1>
</div>
</div>
</div>
<div class="col-xs-12 col-sm-6 col-md-5" id="mobile_search"><div class="search_nested_content_container"><form id="docsearch_form" name="docsearch_form" method="get" data-release="R2022b" data-language="en" action="../../templates/searchresults.html"><div class="input-group tokenized_search_field"><label class="sr-only">Search Help</label><input type="text" class="form-control conjoined_search" autocomplete="off" name="qdoc" placeholder="Search Help" id="docsearch"/> <div class="input-group-btn"><button type="submit" name="submitsearch" id="submitsearch" class="btn icon-search btn_search_adjacent btn_search icon_16" tabindex="-1"></button></div>
</div></form>
</div>
<button class="btn icon-remove btn_search pull-right icon_32 visible-xs" data-toggle="collapse" href="#mobile_search" aria-expanded="false" aria-controls="mobile_search"></button></div>
<div class="visible-xs" id="search_actuator"><button class="btn icon-search btn_search pull-right icon_16" data-toggle="collapse" href="#mobile_search" aria-expanded="false" aria-controls="mobile_search"></button></div>
</div>
</div>
</div>
<div class="row-offcanvas row-offcanvas-left">
<div xmlns="http://www.w3.org/1999/xhtml" class="sidebar-offcanvas" id="sidebar">
<nav class="offcanvas_nav" role="navigation">
<div class="offcanvas_actuator" data-toggle="offcanvas" data-target="#sidebar" id="nav_toggle"><button type="button" class="btn"><span class="sr-only">Off-Canvas Navigation Menu Toggle
                  Off-Canvas Navigation Menu Toggle</span><span class="icon-menu"></span></button><span class="offcanvas_actuator_label" id="translation_icon-menu" tabindex="-1" aria-hidden="true"></span></div><div class="nav_list_wrapper" id="nav_list_wrapper"><nav class="offcanvas_nav" role="navigation"><ul class="nav_breadcrumb" id="ul_left_nav_ancestors"><li itemscope="" itemtype="http://www.data-vocabulary.org/Breadcrumb" itemprop="breadcrumb"><a href="../../documentation-center.html?s_tid=CRUX_lftnav" itemprop="url"><span itemprop="title">Documentation Home</span></a></li>
</ul><ul class="nav_breadcrumb" id="ul_left_nav_productgroups"><li itemscope="" itemtype="http://www.data-vocabulary.org/Breadcrumb" itemprop="breadcrumb"><a href="../../overview/robotics-and-autonomous-systems.html" itemprop="url"><span itemprop="title">Robotics and Autonomous Systems</span></a></li>
<li itemscope="" itemtype="http://www.data-vocabulary.org/Breadcrumb" itemprop="breadcrumb"><a href="../../overview/automotive.html" itemprop="url"><span itemprop="title">Automotive</span></a></li>
</ul>
<ul class="nav_disambiguation"><li><a href="../index.html?s_tid=CRUX_lftnav">Automated Driving Toolbox</a>
</li>
<li itemscope="" itemtype="http://www.data-vocabulary.org/Breadcrumb" itemprop="breadcrumb"><a href="../localization-and-mapping.html?s_tid=CRUX_lftnav" itemprop="url"><span itemprop="title">Localization and Mapping</span></a></li>
<li itemscope="" itemtype="http://www.data-vocabulary.org/Breadcrumb" itemprop="breadcrumb"><a href="../geographic-and-hd-maps.html?s_tid=CRUX_lftnav" itemprop="url"><span itemprop="title">Geographic and HD Maps</span></a></li>
</ul><ul class="nav_scrollspy nav">
<li class="nav_scrollspy_function"><a href="#responsive_offcanvas">Use HERE HD Live Map Data to Verify Lane Configurations</a></li>
<li class="nav_scrollspy_title" id="SSPY810-section">On this page</li>
<!--ADD_REFENTRY_TITLE_HERE 11--><li><a href="#d124e43864" class="intrnllnk">Overview</a></li>
<li><a href="#d124e43900" class="intrnllnk">Load and Display Camera and GPS Data</a></li>
<li><a href="#d124e43925" class="intrnllnk">Match Recorded Vehicle Position to a Road</a></li>
<li><a href="#d124e43982" class="intrnllnk">Retrieve Speed Limit Along a Matched Road</a></li>
<li><a href="#d124e43999" class="intrnllnk">Match Recorded Position to a Lane Group</a></li>
<li><a href="#d124e44064" class="intrnllnk">Retrieve Lane Configurations for a Matched Lane Group</a></li>
<li><a href="#d124e44078" class="intrnllnk">Visualize and Verify Recorded Drive with HERE HDLM Data</a></li>
<li><a href="#d124e44095" class="intrnllnk">Conclusion</a></li>
<li><a href="#d124e44108" class="intrnllnk">Supporting Functions</a></li>
<li><a href="#d124e44146" class="intrnllnk">See Also</a></li>
<li><a href="#d124e44158" class="intrnllnk">Related Topics</a></li>
</ul>
</nav>
</div></nav>
<script src="../../includes/product/scripts/offcanvas_v2.js"></script>
</div>
<!--END.CLASS sidebar-offcanvas--><div class="offcanvas_content_container">
<div xmlns="http://www.w3.org/1999/xhtml" class="sticky_header_container"><div class="horizontal_nav"><div class="horizontal_nav_container"><div class="offcanvas_horizontal_nav"><div class="container-fluid"><div class="row"><div class="col-sm-12 hidden-xs"><nav class="navbar navbar-default" role="navigation" id="subnav"><div><ul class="nav navbar-nav crux_browse"><li id="crux_nav_documentation" class="crux_resource active"><a>Documentation</a></li>
<li id="crux_nav_example" class="crux_resource"><a href="../examples.html?category=geographic-and-hd-maps&amp;s_tid=CRUX_topnav">Examples</a></li>
<li id="crux_nav_function" class="crux_resource"><a href="../referencelist.html?type=function&amp;category=geographic-and-hd-maps&amp;s_tid=CRUX_topnav">Functions</a></li>
<li id="crux_nav_block" class="crux_resource"><a href="../referencelist.html?type=block&amp;category=geographic-and-hd-maps&amp;s_tid=CRUX_topnav">Blocks</a></li>
<li id="crux_nav_app" class="crux_resource"><a href="../referencelist.html?type=app&amp;category=geographic-and-hd-maps&amp;s_tid=CRUX_topnav">Apps</a></li>
<li id="crux_nav_scene" class="crux_resource"><a href="../referencelist.html?type=scene&amp;category=geographic-and-hd-maps&amp;s_tid=CRUX_topnav">Scenes</a></li>
</ul>
</div></nav>
</div>
<div class="visible-xs"><div class="container-fluid"><div class="row"><div class="col-xs-9"><div class="mobile_crux_nav_trigger"><div class="btn-group"><button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Resources<span class="icon-arrow-down icon_16"></span></button><ul class="dropdown-menu"><li id="crux_nav_mobile_documentation" class="crux_resource active"><a>Documentation</a></li>
<li id="crux_nav_mobile_example" class="crux_resource"><a href="../examples.html?category=geographic-and-hd-maps&amp;s_tid=CRUX_topnav">Examples</a></li>
<li id="crux_nav_mobile_function" class="crux_resource"><a href="../referencelist.html?type=function&amp;category=geographic-and-hd-maps&amp;s_tid=CRUX_topnav">Functions</a></li>
<li id="crux_nav_mobile_block" class="crux_resource"><a href="../referencelist.html?type=block&amp;category=geographic-and-hd-maps&amp;s_tid=CRUX_topnav">Blocks</a></li>
<li id="crux_nav_mobile_app" class="crux_resource"><a href="../referencelist.html?type=app&amp;category=geographic-and-hd-maps&amp;s_tid=CRUX_topnav">Apps</a></li>
<li id="crux_nav_mobile_scene" class="crux_resource"><a href="../referencelist.html?type=scene&amp;category=geographic-and-hd-maps&amp;s_tid=CRUX_topnav">Scenes</a></li>
</ul>
</div>
</div>
</div>
<div class="col-xs-3"><div class="translate_placeholder"></div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="content_container" id="content_container" itemprop="content">
<div class="container-fluid">
<div class="row">
<div class="col-xs-12">

<div xmlns="http://www.w3.org/1999/xhtml" id="product_info_alert"></div>
<section xmlns="http://www.w3.org/1999/xhtml" id="doc_center_content" lang="en" data-language="en"><div id="pgtype-topic">
<section itemprop="content"><h1 class="r2022b" itemprop="title content" id="mw_d1b397d5-96c4-49df-8bf5-4bd11571c27d">使用HERE HD Live Map数据来验证车道配置</h1>
<div class="examples_short_list hidden_ios_android"><div data-pane="metadata" class="panel metadata_container panel-default"><div class="panel-body metadata_content"><a class="btn btn_secondary btn-block" href="matlab:openExample('driving/UseHEREHDLiveMapDataToVerifyLaneConfigurationsExample')" data-ex-genre="Script">Open Script</a></div>
</div>
</div>
<div itemscope="" itemtype="http://www.mathworks.com/help/schema/MathWorksDocPage/Example" itemprop="example" class="em_example"><meta itemprop="exampleid" content="driving-UseHEREHDLiveMapDataToVerifyLaneConfigurationsExample"/>
<meta itemprop="exampletitle" content="Use HERE HD Live Map Data to Verify Lane Configurations"/>
</div>
<span id="UseHEREHDLiveMapDataToVerifyLaneConfigurationsExample" class="anchor_target"></span>

<p class="shortdesc">这个示例展示了如何从HERE HD Live Map（HERE HDLM）服务中读取和可视化记录的驾驶路线的车道配置。这种可视化可以用来验证车载传感器（如单目相机）的感知系统检测到的车道配置。</p>

<p>在这个示例中，您将学习如何访问HDLM服务中的瓦片图层，并识别相关的道路级和车道级拓扑、几何和属性信息。</p>

<p>为了读取数据，您需要使用一个 <code class="literal"><a href="../ref/herehdlmreader.html" data-docid="driving_ref#mw_1b07178b-8143-4b99-81ce-ee194738f9e4" class="a"><code class="olink">hereHDLMReader</code></a></code> 对象。使用HERE HD Live Map服务需要有效的HERE HDLM凭据。您需要与HERE签订单独的协议，以获得访问HDLM服务和获取所需凭据 (access_key_id 和 access_key_secret) 的权限。</p>

<div class="procedure"><h3 class="title" id="d124e43864">概述<span id="UseHEREHDLiveMapDataToVerifyLaneConfigurationsExample-1" class="anchor_target"></span></h3>
<p>高精度（HD）地图是专为自动驾驶应用而开发的地图服务。这些地图具有精确的几何形状（在赤道附近的分辨率可达1厘米），使它们适用于超越传统道路地图的自动驾驶工作流程，包括车道级别的验证、定位和路径规划。这个示例展示了如何使用HD地图数据中的车道级别信息来验证车道检测系统的性能。</p>
<p>高精度（HD）地图数据的准确性使其成为验证车载传感器感知系统的真实数据的来源。这种高准确性可以更快、更准确地验证已部署的算法。</p>
<p>HERE HD Live Map (HERE HDLM) 是HERE Technologies开发的基于云的高精度地图服务，用于支持高度自动化驾驶。该数据由分块映射层组成，提供对道路网络准确的几何形状和强大属性的访问。这些层被分组为以下模型：</p>
<div class="itemizedlist"><ul><li><p><strong class="emphasis bold">Road Centerline Model:</strong> 提供道路拓扑（以图形中的节点和链接指定），形状几何和其他道路级属性。</p></li>
<li><p><strong class="emphasis bold">HD Lane Model:</strong> 提供车道拓扑（作为车道组和车道组连接器），高精度几何和车道级属性。</p></li>
<li><p><strong class="emphasis bold">HD Localization Model:</strong> 提供支持车辆定位策略的功能。</p></li>
</ul>
</div>
<p>要了解HERE HDLM层的概述，请参阅 <a href="here-hd-live-map-layers.html" data-docid="driving_ug#mw_4b697ed4-ad52-4319-ace2-03999280b820" class="a">HERE HD Live Map Layers</a>。</p>
<p>摄像头在自动驾驶中用于收集车辆周围道路拓扑的语义信息。车道边界检测、车道类型分类和道路标志检测算法构成了这种摄像头处理流程的核心。您可以使用HERE HDLM服务，结合安装在车辆上的高精度GPS，评估这些算法的准确性并验证它们的性能。</p>
<p>在这个例子中，您将学习以下内容：</p>
<div class="orderedlist"><ol style="list-style: decimal;"><li><p>从HERE HDLM服务中读取记录的GPS序列的道路和车道信息。</p></li>
<li><p>应用一种启发式的路径匹配方法来处理记录的GPS数据。由于GPS数据通常不够精确，因此需要解决将记录的地理坐标匹配到道路网络表示的问题</p></li>
<li><p>识别与车辆相关的环境属性。一旦成功将车辆定位在地图上的上下文中，您可以使用与车辆相关的道路和车道属性来验证车辆搭载的摄像头传感器记录的数据。</p></li>
</ol>
</div>
<h3 class="title" id="d124e43900">加载并显示摄像头和GPS数据<span id="UseHEREHDLiveMapDataToVerifyLaneConfigurationsExample-3" class="anchor_target"></span></h3>
<p>首先，从记录的驾驶数据中加载数据。在这个例子中，记录的数据来自Udacity®自动驾驶车队收集的驾驶数据集。这些数据包括由前置单目摄像头捕获的视频以及由GPS记录的车辆位置和速度信息。</p>
<p>加载 <code class="literal">centerCamera.avi</code> 摄像头视频数据和相应的视频时间戳。</p>
<div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>recordedData = fullfile(toolboxdir(<span style="color:#A020F0">'driving'</span>), <span style="color:#A020F0">'drivingdata'</span>, <span style="color:#0000FF">...</span>
    <span style="color:#A020F0">'udacity'</span>, <span style="color:#A020F0">'drive_segment_09_29_16'</span>);
[videoReader, videoTime] = helperLoadCameraData(fullfile(recordedData));

<span style="color:#228B22">% Show the first frame of the camera data</span>
imageFrame = readFrame(videoReader);
imshow(imageFrame, <span style="color:#A020F0">'Border'</span>, <span style="color:#A020F0">'tight'</span>);
</pre>
</div>
</div>
</div>
<div class="informalfigure"><div id="d124e43912" class="mediaobject"><p><img src="../../examples/driving/win64/UseHEREHDLiveMapDataToVerifyLaneConfigurationsExample_01.png"/></p>
</div>
</div>
<p>从 <code class="literal">gpsSequence.mat</code> MAT文件中加载GPS数据。</p>
<div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>data = load(fullfile(recordedData, <span style="color:#A020F0">'gpsSequence.mat'</span>));
gpsData = data.gpsTT;

<span style="color:#228B22">% Plot the full route and the first position recorded from the GPS</span>
gpsPlayer = geoplayer(gpsData.Latitude(1), gpsData.Longitude(1), 18);
plotRoute(gpsPlayer, gpsData.Latitude, gpsData.Longitude);
plotPosition(gpsPlayer, gpsData.Latitude(1), gpsData.Longitude(1));
</pre>
</div>
</div>
</div>
<div class="informalfigure"><div id="d124e43922" class="mediaobject"><p><img src="../../examples/driving/win64/UseHEREHDLiveMapDataToVerifyLaneConfigurationsExample_02.png"/></p>
</div>
</div>
<h3 class="title" id="d124e43925">将记录的车辆位置与道路匹配<span id="UseHEREHDLiveMapDataToVerifyLaneConfigurationsExample-5" class="anchor_target"></span></h3>
<p>创建一个读取器，用于读取覆盖驾驶中所有记录的GPS位置的HERE HD Live Map瓦片。如果您之前没有设置HERE HDLM凭证，将会弹出一个对话框提示您输入凭证信息。请输入您从HERE Technologies获取的<strong class="emphasis bold">Access Key ID</strong> 和 <strong class="emphasis bold">Access Key Secret</strong>，然后点击 <strong class="emphasis bold">OK</strong>。</p>
<div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>reader = hereHDLMReader(gpsData.Latitude, gpsData.Longitude);
</pre>
</div>
</div>
</div>
<p>从 <code class="literal">TopologyGeometry</code> 图层读取并绘制道路拓扑数据。该图层表示道路网络的配置。网络的节点对应于交叉口和死胡同。节点之间的链接表示连接街道的形状，以折线表示。这些要素的连通性和几何信息包含在 <code class="literal">LinksStartingInTile</code> 和 <code class="literal">NodesInTile</code> 字段中。</p>
<div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>topologyLayer = read(reader, <span style="color:#A020F0">'TopologyGeometry'</span>)

figure(<span style="color:#A020F0">'Name'</span>, <span style="color:#A020F0">'TopologyGeometry'</span>);
topologyAxes = plot(topologyLayer);
hold(topologyAxes, <span style="color:#A020F0">'on'</span>);
geoplot(topologyAxes, gpsData.Latitude, gpsData.Longitude, <span style="color:#0000FF">...</span>
    <span style="color:#A020F0">'bo-'</span>, <span style="color:#A020F0">'DisplayName'</span>, <span style="color:#A020F0">'Route'</span>);
</pre>
</div>
</div>
</div>
<div class="code_responsive"><div class="programlisting"><div class="codeoutput"><pre>topologyLayer = 
  TopologyGeometry with properties:

   Data:
                    HereTileId: 309106790
          IntersectingLinkRefs: [44×1 struct]
           LinksStartingInTile: [895×1 struct]
                   NodesInTile: [651×1 struct]
    TileCenterHere2dCoordinate: [37.3865 -122.1130]
   Metadata:
                       Catalog: 'hrn:here:data::olp-here-had:here-hdlm-protobuf-na-2'
                CatalogVersion: 4601
  Use plot to visualize TopologyGeometry data.
</pre>
</div>
</div>
</div>
<div class="informalfigure"><div id="d124e43955" class="mediaobject"><p><img src="../../examples/driving/win64/UseHEREHDLiveMapDataToVerifyLaneConfigurationsExample_03.png"/></p>
</div>
</div>
<p>绘图功能包含在 <code class="literal">helperPlotLayer</code> 函数中，该函数使用相同的地理坐标轴可视化HD Live Map图层上的可用数据和记录的驾驶数据。该函数在示例的末尾定义，并将用于绘制后续的图层。</p>
<p>在驾驶过程中记录了一个GPS位置后，可以使用路线匹配算法确定该位置对应于网络上的哪条道路。该示例使用一种启发式路线匹配算法，该算法在空间上考虑到最近的链接与记录的地理点的关系。该算法利用车辆的行驶方向确定最有可能的链接。这种路线匹配方法不考虑道路连通性、车辆访问或具有高位置误差的GPS数据。因此，该方法可能不适用于所有情况。</p>
<p><code class="literal">helperGetGeometry</code> 函数从给定的拓扑图层中提取几何信息，并将该信息与相应的链接一起返回到一个表中。</p>
<div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>topologyTable = helperGetGeometry(topologyLayer.LinksStartingInTile, <span style="color:#0000FF">...</span>
    {<span style="color:#A020F0">'LinkId'</span>, <span style="color:#A020F0">'Geometry.Here2dCoordinateDiffs'</span>});
topologyTable.Properties.VariableNames = {<span style="color:#A020F0">'LinkId'</span>, <span style="color:#A020F0">'Geometry'</span>};
</pre>
</div>
</div>
</div>
<p><code class="literal"><a href="matlab:openExample('driving/UseHEREHDLiveMapDataToVerifyLaneConfigurationsExample','supportingFile','HelperLinkMatcher.m')" target="_blank">HelperLinkMatcher</a></code> 类创建一个链接匹配器，其中包含所需地图瓦片中每个链接的形状几何信息。该类使用基本的空间分析将记录的位置与道路链接的形状坐标进行匹配。</p>
<div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>linkMatcher = HelperLinkMatcher(topologyTable);

<span style="color:#228B22">% Match first point of the recorded route to the most probable link</span>
[linkId, linkLat, linkLon] = match(linkMatcher, gpsData.Latitude(1), <span style="color:#0000FF">...</span>
    gpsData.Longitude(1), gpsData.Velocity(1,1:2));

<span style="color:#228B22">% Plot the shape geometry of the link</span>
geoplot(gpsPlayer.Axes, linkLat, linkLon, <span style="color:#A020F0">'r.-'</span>);
</pre>
</div>
</div>
</div>
<div class="informalfigure"><div id="d124e43979" class="mediaobject"><p><img src="../../examples/driving/win64/UseHEREHDLiveMapDataToVerifyLaneConfigurationsExample_04.png"/></p>
</div>
</div>
<h3 class="title" id="d124e43982">获取匹配道路上的限速信息<span id="UseHEREHDLiveMapDataToVerifyLaneConfigurationsExample-9" class="anchor_target"></span></h3>
<p>将赋予给某条道路上所有车道的共同特征归属于描述该道路的链接元素。其中一个属性是速度限制，用于描述在该链接上行驶的车辆的最大合法速度。一旦将某个地理坐标与链接匹配，您就可以确定沿该链接的速度限制。由于诸如速度限制之类的特征在链接的长度上经常发生变化，因此这些属性是针对链接的特定范围进行确定的。</p>
<p><code class="literal">SpeedAttributes</code> 图层包含有关链接上预期车辆速度的信息，包括发布的速度限制。</p>
<div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>speedLayer = read(reader, <span style="color:#A020F0">'SpeedAttributes'</span>);
</pre>
</div>
</div>
</div>
<p><code class="literal">helperGetSpeedLimits</code> 函数提取链接的相关长度和方向的速度限制数据。与提取链接的几何信息类似，特别捕获速度限制数据需要专门的代码。</p>
<div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>speedTable = helperGetSpeedLimits(speedLayer);

<span style="color:#228B22">% Find the speed limit entry for the matched link</span>
speed = speedTable(speedTable.LinkId == linkId, :);
</pre>
</div>
</div>
</div>
<h3 class="title" id="d124e43999">将记录的位置与车道组进行匹配<span id="UseHEREHDLiveMapDataToVerifyLaneConfigurationsExample-11" class="anchor_target"></span></h3>
<p>HD Lane Model包含道路的车道级几何和属性，提供支持自动驾驶应用所需的详细信息。与道路中心线模型类似，HD Lane Model也遵循使用拓扑描述车道级道路网络的模式。然后，车道组的特征被归属于该拓扑的元素。在HD Lane Model中，主要的拓扑元素是车道组。</p>
<p>从 <code class="literal">LaneTopology</code> 图层中读取和绘制车道拓扑数据。该图层将车道拓扑表示为车道组和车道组连接器。车道组表示链接（道路段）内的一组车道。车道组连接器将单个车道组连接到彼此。这些特征的连通性和几何信息分别包含在 <code class="literal">LaneGroupsStartingInTile</code> 和 <code class="literal">LaneGroupConnectorsInTile</code> 字段中，用于车道组和车道组连接器。</p>
<div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>laneTopologyLayer = read(reader, <span style="color:#A020F0">'LaneTopology'</span>)
laneAxes = helperPlotLayer(laneTopologyLayer, <span style="color:#0000FF">...</span>
    gpsData.Latitude, gpsData.Longitude);
geolimits(laneAxes, [37.3823, 37.3838], [-122.1151, -122.1128]);
</pre>
</div>
</div>
</div>
<div class="code_responsive"><div class="programlisting"><div class="codeoutput"><pre>laneTopologyLayer = 
  LaneTopology with properties:

   Data:
                    HereTileId: 309106790
     IntersectingLaneGroupRefs: [56×1 struct]
     LaneGroupConnectorsInTile: [1174×1 struct]
      LaneGroupsStartingInTile: [1783×1 struct]
    TileCenterHere2dCoordinate: [37.3865 -122.1130]
   Metadata:
                       Catalog: 'hrn:here:data::olp-here-had:here-hdlm-protobuf-na-2'
                CatalogVersion: 4601
  Use plot to visualize LaneTopology data.
</pre>
</div>
</div>
</div>
<div class="informalfigure"><div id="d124e44017" class="mediaobject"><p><img src="../../examples/driving/win64/UseHEREHDLiveMapDataToVerifyLaneConfigurationsExample_05.png"/></p>
</div>
</div>
<p>车道组代表多个车道。因此，该元素的几何形状由车道组的左右边界所确定的多边形形状给出。通过使用 <code class="literal">helperGetGeometry</code> 函数，可以从车道边界获取这个车道的几何形状。</p>
<div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>laneGroupFields = {<span style="color:#A020F0">'LaneGroupId'</span>, <span style="color:#0000FF">...</span>
    <span style="color:#A020F0">'BoundaryGeometry.LeftBoundary.Here2dCoordinateDiffs'</span>, <span style="color:#0000FF">...</span>
    <span style="color:#A020F0">'BoundaryGeometry.RightBoundary.Here2dCoordinateDiffs'</span>};
laneTopologyTable = helperGetGeometry(laneTopologyLayer.LaneGroupsStartingInTile, <span style="color:#0000FF">...</span>
    laneGroupFields);
laneTopologyTable.Properties.VariableNames = {<span style="color:#A020F0">'LaneGroupId'</span>, <span style="color:#0000FF">...</span>
    <span style="color:#A020F0">'LeftGeometry'</span>, <span style="color:#A020F0">'RightGeometry'</span>};
</pre>
</div>
</div>
</div>
<p>针对开发一个匹配算法来确定最可能的行驶路径链接，将给定的GPS数据与最可能的车道组进行匹配可以采用多种方法。这里描述的方法使用了两个图层：<code class="literal">LaneRoadReferences</code> 和 <code class="literal">LaneTopology</code>。</p>
<div class="itemizedlist"><ul><li><p><code class="literal">LaneRoadReferences</code> 图层使您能够将道路中心线模型上的位置（由链接给出）转换为高精度车道模型上的相应位置（由车道组给出）。由于链接已经被确定，您可以将车道组匹配的候选项筛选为在该图块中可用的所有车道组的较小子集。</p></li>
<li><p><code class="literal">LaneTopology</code> 图层提供几何数据，可以用来考虑存在于每个候选车道组边界内的空间数据。与将GPS数据与链接进行空间匹配一样，这种方法容易出现错误，并且受到记录的GPS数据准确性的影响。除了匹配车道组之外，您还需要将车辆的方向向量与车道组的方向相匹配。这一步是必要的，因为车道的属性是相对于拓扑方向定义的。</p></li>
</ul>
</div>
<p>使用 <code class="literal">helperGetReferences</code> 函数生成一个表格，其中列出了至少在某个链接长度上存在的所有车道组。</p>
<div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>referenceLayer = read(reader, <span style="color:#A020F0">'LaneRoadReferences'</span>);
referenceTable = helperGetReferences(referenceLayer);
</pre>
</div>
</div>
</div>
<p>创建一个车道组匹配器，其中包含所需地图瓦片中每个车道组的边界几何形状。<code class="literal"><a href="matlab:openExample('driving/UseHEREHDLiveMapDataToVerifyLaneConfigurationsExample','supportingFile','HelperLaneGroupMatcher.m')" target="_blank">HelperLaneGroupMatcher</a></code> 类创建一个车道组匹配器，其中包含所需地图瓦片中每个车道组的边界形状几何。它还包含一个链接到车道组的参考表。与 <code class="literal">HelperLinkMatcher</code> 类一样，该类使用简单的空间分析方法来确定给定的记录坐标是否存在于车道组的边界内。</p>
<div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>laneGroupMatcher = HelperLaneGroupMatcher(referenceTable, laneTopologyTable);

<span style="color:#228B22">% Match the lane group and relative direction</span>
[laneGroupId, isForward, boundGeometry] = match(laneGroupMatcher, linkId, <span style="color:#0000FF">...</span>
    gpsData.Latitude(1), gpsData.Longitude(1), gpsData.Velocity(1,1:2));

<span style="color:#228B22">% Plot the boundary geometry of the lane group</span>
geoplot(gpsPlayer.Axes, boundGeometry(:,1), boundGeometry(:,2), <span style="color:#A020F0">'m.-'</span>);
</pre>
</div>
</div>
</div>
<div class="informalfigure"><div id="d124e44061" class="mediaobject"><p><img src="../../examples/driving/win64/UseHEREHDLiveMapDataToVerifyLaneConfigurationsExample_06.png"/></p>
</div>
</div>
<h3 class="title" id="d124e44064">获取匹配的车道组的车道配置<span id="UseHEREHDLiveMapDataToVerifyLaneConfigurationsExample-15" class="anchor_target"></span></h3>
<p>与通过标识符将速度属性映射到链接一样，车道属性也通过使用车道组ID将特征分配给车道组。<code class="literal">LaneAttributes</code> 图层包含关于车道组的信息，包括车道组中每个车道的类型和车道边界的特征。</p>
<p>使用 <code class="literal">helperGetLaneAttributes</code> 函数提取瓦片中每个车道组的不同车道类型和车道边界标记。</p>
<div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>laneAttributesLayer = read(reader, <span style="color:#A020F0">'LaneAttributes'</span>);
laneAttributesTable = helperGetLaneAttributes(laneAttributesLayer);

<span style="color:#228B22">% Find the lane attribute entry for the matched lane group</span>
laneAttribute = laneAttributesTable.LaneGroupId == laneGroupId;
</pre>
</div>
</div>
</div>
<h3 class="title" id="d124e44078">使用HERE HDLM数据可视化和验证记录的行驶路线<span id="UseHEREHDLiveMapDataToVerifyLaneConfigurationsExample-16" class="anchor_target"></span></h3>
<p>生成的匹配算法和表格可以扩展到一系列记录的GPS坐标，以识别道路和车道属性。对于每个时间步长，车辆的位置将与道路上的链接和车道组进行匹配。此外，还会显示速度限制和车道配置，并显示相应的摄像头图像。</p>
<p><code class="literal"><a href="matlab:openExample('driving/UseHEREHDLiveMapDataToVerifyLaneConfigurationsExample','supportingFile','HelperHDLMUI.m')" target="_blank">HelperHDLMUI</a></code> 类创建了一个工具，用于从记录的行驶中流式传输视频和GPS数据，并在每个记录的车辆位置显示所选HERE HD Live Map图层的相关信息。</p>
<div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>hdlmUI = HelperHDLMUI(gpsData.Latitude(1), gpsData.Longitude(1));

<span style="color:#228B22">% Synchronize the camera and GPS data into a common timetable</span>
synchronizedData = synchronize(videoTime, gpsData);
videoReader.CurrentTime = 0;
maxDisplayRate = videoReader.FrameRate * 5;

<span style="color:#228B22">% Initialize some variables to maintain history</span>
prevLinkId      = 0;
prevLaneGroupId = 0;

<span style="color:#0000FF">for</span> idx = 1 : height(synchronizedData)

    timeStamp = synchronizedData.Time(idx);

    <span style="color:#228B22">% Check if the current timestamp has GPS data</span>
    hasGPSFrame = ~(ismissing(synchronizedData.Latitude(idx)) || <span style="color:#0000FF">...</span>
        ismissing(synchronizedData.Longitude(idx)));

    <span style="color:#0000FF">if</span> hasGPSFrame
        latitude  = synchronizedData.Latitude(idx);
        longitude = synchronizedData.Longitude(idx);
        velocity  = synchronizedData.Velocity(idx, 1:2);

        <span style="color:#228B22">% Match GPS position to link</span>
        [linkId, linkLat, linkLon] = match(linkMatcher, <span style="color:#0000FF">...</span>
            latitude, longitude, velocity);

        <span style="color:#0000FF">if</span> linkId ~= prevLinkId
            <span style="color:#228B22">% Update link</span>
            updateLink(hdlmUI, linkLat, linkLon);
            prevLinkId = linkId;

            <span style="color:#228B22">% Update speed limit</span>
            speed = speedTable(speedTable.LinkId == linkId, :);
            updateSpeed(hdlmUI, speed.Value);
        <span style="color:#0000FF">end</span>

        <span style="color:#228B22">% Match GPS position to lane group</span>
        [laneGroupId, isForward, boundGeometry] = match(laneGroupMatcher, linkId, <span style="color:#0000FF">...</span>
            latitude, longitude, velocity);

        <span style="color:#0000FF">if</span> laneGroupId ~= prevLaneGroupId
            <span style="color:#228B22">% Update lane group</span>
            updateLaneGroup(hdlmUI, boundGeometry);
            prevLaneGroupId = laneGroupId;

            <span style="color:#228B22">% Update lane types and boundary markings</span>
            laneAttribute = laneAttributesTable.LaneGroupId == laneGroupId;
            plotLanes(hdlmUI, laneAttributesTable.Lanes{laneAttribute}, <span style="color:#0000FF">...</span>
                laneAttributesTable.LaneBoundaries{laneAttribute}, isForward);
        <span style="color:#0000FF">end</span>

        updatePosition(hdlmUI, latitude, longitude);
    <span style="color:#0000FF">else</span>
        <span style="color:#228B22">% Read frame of the video</span>
        imageFrame = readFrame(videoReader);
    <span style="color:#0000FF">end</span>

    updateImage(hdlmUI, imageFrame);
    updateTime(hdlmUI, timeStamp);
    pause(1/maxDisplayRate);
<span style="color:#0000FF">end</span>
</pre>
</div>
</div>
</div>
<div class="informalfigure"><div id="d124e44092" class="mediaobject"><p><img src="../../examples/driving/win64/UseHEREHDLiveMapDataToVerifyLaneConfigurationsExample_07.png"/></p>
</div>
</div>
<h3 class="title" id="d124e44095">结论<span id="UseHEREHDLiveMapDataToVerifyLaneConfigurationsExample-17" class="anchor_target"></span></h3>
<p>在这个例子中，你探讨了以下内容：</p>
<div class="orderedlist"><ol style="list-style: decimal;"><li><p>从HERE HD Live Map服务中获取给定GPS序列的高清地图数据，并将该数据导入MATLAB。</p></li>
<li><p>将记录的GPS数据与导入的道路网络数据进行匹配，以找到每个地理坐标对应的相关链接和车道组。</p></li>
<li><p>查询匹配的链接和车道组的属性，如限速和车道类型，以开发一个工具，用于通过记录的摄像头数据对道路的特征进行可视化验证。</p></li>
</ol>
</div>
<p>这个例子中讨论的技术可以进一步扩展，以支持感知算法的自动验证。</p>
<h3 class="title" id="d124e44108">Supporting Functions支持函数<span id="UseHEREHDLiveMapDataToVerifyLaneConfigurationsExample-18" class="anchor_target"></span></h3>
<p><code class="literal">helperPlotLayer</code> 函数在地理图上绘制图层数据和路线。</p>
<div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre><span style="color:#0000FF">function</span> gx = helperPlotLayer(layer, latitude, longitude)
<span style="color:#228B22">%helperPlotLayer Create geographic plot with layer data and route</span>
<span style="color:#228B22">%   gx = helperPlotLayer(layer, latitude, longitude) creates a geographic</span>
<span style="color:#228B22">%   axes plot with the plottable HDLM layer and the route given by latitude</span>
<span style="color:#228B22">%   and longitude on a new figure.</span>

figure;

<span style="color:#228B22">% Plot layer</span>
gx = plot(layer);

<span style="color:#228B22">% Enable adding data to the plot</span>
hold(gx, <span style="color:#A020F0">'on'</span>);

<span style="color:#228B22">% Plot latitude, longitude data</span>
geoplot(gx, latitude, longitude, <span style="color:#A020F0">'bo-'</span>, <span style="color:#A020F0">'DisplayName'</span>, <span style="color:#A020F0">'Route'</span>);
hold(gx, <span style="color:#A020F0">'off'</span>);
<span style="color:#0000FF">end</span>
</pre>
</div>
</div>
</div>
<p><code class="literal">helperGetGeometry</code> 函数从图层中提取拓扑元素的几何信息，并以表格形式返回。</p>
<div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre><span style="color:#0000FF">function</span> geometryTable = helperGetGeometry(layer, fields)
<span style="color:#228B22">%helperGetGeometry Create a table with geometry for topology elements</span>
<span style="color:#228B22">%   geometryTable = helperGetGeometry(layer, fields) returns a table</span>
<span style="color:#228B22">%   formatted with the specified geometry fields of the TopologyGeometry</span>
<span style="color:#228B22">%   and LaneTopology layers.</span>

<span style="color:#228B22">% Pre-allocate struct</span>
S = repmat(struct, size(layer));

<span style="color:#0000FF">for</span> field = fields
    C = strsplit(field{:}, <span style="color:#A020F0">'.'</span>);
    <span style="color:#0000FF">for</span> idx = 1:numel(layer)
        fieldname = strjoin(C, <span style="color:#A020F0">''</span>);
        S(idx).(fieldname) = getfield(layer, {idx}, C{:});
    <span style="color:#0000FF">end</span>
<span style="color:#0000FF">end</span>

geometryTable = struct2table(S);
<span style="color:#0000FF">end</span>
</pre>
</div>
</div>
</div>
<p><code class="literal">helperGetSpeedLimits</code> 函数从图层中提取速度限制数据，并以表格形式返回。</p>
<div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre><span style="color:#0000FF">function</span> speedTable = helperGetSpeedLimits(layer)
<span style="color:#228B22">%helperGetSpeedLimits Create a data table with speed limits</span>
<span style="color:#228B22">%   speedTable = helperGetSpeedLimits(layer) returns a table formatted with</span>
<span style="color:#228B22">%   the speed limit start, end, direction, and value along a specified link</span>
<span style="color:#228B22">%   as given by the SpeedAttributes layer object specified by layer.</span>

speed = struct(<span style="color:#0000FF">...</span>
    <span style="color:#A020F0">'LinkId'</span>,       {}, <span style="color:#0000FF">...</span>
    <span style="color:#A020F0">'Start'</span>,        {}, <span style="color:#0000FF">...</span>
    <span style="color:#A020F0">'End'</span>,          {}, <span style="color:#0000FF">...</span>
    <span style="color:#A020F0">'Direction'</span>,    {}, <span style="color:#0000FF">...</span>
    <span style="color:#A020F0">'Value'</span>,        {});

<span style="color:#0000FF">for</span> idx = 1 : numel(layer.LinkAttribution)

    <span style="color:#228B22">% Assign the link ID</span>
    link            = layer.LinkAttribution(idx);
    attributions    = link.ParametricAttribution;

    <span style="color:#228B22">% Examine each attribute assigned to the link</span>
    <span style="color:#0000FF">for</span> attrIndex = 1 : numel(attributions)

        linkAttr = vertcat(attributions.LinkParametricAttribution);

        <span style="color:#228B22">% For each attribute, check if the speed limit information is</span>
        <span style="color:#228B22">% listed. If speed limit is provided, make an entry.</span>
        <span style="color:#0000FF">for</span> linkAttrIndex = 1 : numel(linkAttr)

            <span style="color:#0000FF">if</span> ~isempty(linkAttr(linkAttrIndex).SpeedLimit)

                <span style="color:#228B22">% Assign speed limit to specified link</span>
                speedLimit = struct;
                speedLimit.LinkId       = link.LinkLocalRef;
                speedLimit.Start        = attributions(attrIndex).AppliesToRange.RangeOffsetFromStart;
                speedLimit.End          = attributions(attrIndex).AppliesToRange.RangeOffsetFromEnd;
                speedLimit.Direction    = attributions(attrIndex).AppliesToDirection;
                speedLimit.Value        = linkAttr(linkAttrIndex).SpeedLimit.Value;

                <span style="color:#228B22">% Convert KPH to MPH</span>
                <span style="color:#0000FF">if</span> strcmpi(linkAttr(linkAttrIndex).SpeedLimit.Unit, <span style="color:#A020F0">'KILOMETERS_PER_HOUR'</span>)
                    speedLimit.Value = speedLimit.Value / 1.609;
                <span style="color:#0000FF">end</span>

                <span style="color:#0000FF">if</span> strcmpi(speedLimit.Direction, <span style="color:#A020F0">'BOTH'</span>)
                    speed = [speed; speedLimit]; <span style="color:#228B22">%#ok&lt;AGROW&gt;</span>
                <span style="color:#0000FF">end</span>
            <span style="color:#0000FF">end</span>
        <span style="color:#0000FF">end</span>

    <span style="color:#0000FF">end</span>
<span style="color:#0000FF">end</span>

speedTable = struct2table(speed);
<span style="color:#0000FF">end</span>
</pre>
</div>
</div>
</div>
<p><code class="literal">helperGetReferences</code> 函数从图层对象中提取车道道路参考信息，并以表格形式返回。</p>
<div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre><span style="color:#0000FF">function</span> laneRoadReferenceTable = helperGetReferences(layer)
<span style="color:#228B22">%helperGetReferences Create a data table with lane road references</span>
<span style="color:#228B22">%   laneRoadReferenceTable = helperGetReferences(layer) returns a table</span>
<span style="color:#228B22">%   formatted with a list of all lane groups existing on a specified link</span>
<span style="color:#228B22">%   as given by the LaneRoadReferences layer object specified by layer.</span>

numLinks = numel(layer.LinkLaneGroupReferences);
reference = repmat(struct(<span style="color:#A020F0">'LinkId'</span>, {}, <span style="color:#A020F0">'LaneGroupId'</span>, {}), numLinks, 1);

<span style="color:#228B22">% Get references from links to lane groups</span>
<span style="color:#0000FF">for</span> idx = 1 : numLinks
    link = layer.LinkLaneGroupReferences(idx);
    laneGroups = vertcat(link.LaneGroupReferences.LaneGroupRef);

    reference(idx).LinkId = link.LinkLocalRef;
    reference(idx).LaneGroupId = [laneGroups(:).LaneGroupId]';
<span style="color:#0000FF">end</span>

laneRoadReferenceTable = struct2table(reference);
<span style="color:#0000FF">end</span>
</pre>
</div>
</div>
</div>
<p><code class="literal">helperGetLaneAttributes</code> 函数从图层对象中提取车道属性，并以表格形式返回。</p>
<div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre><span style="color:#0000FF">function</span> laneAttributesTable = helperGetLaneAttributes(layer)
<span style="color:#228B22">%helperGetLaneAttributes Create a table with lane and boundary types</span>
<span style="color:#228B22">%   laneAttributesTable = helperGetLaneAttributes(layer) returns a table</span>
<span style="color:#228B22">%   formatted with the lane types and the lane boundary markings for each</span>
<span style="color:#228B22">%   lane group in the LaneAttributes layer object specified by layer.</span>

<span style="color:#0000FF">for</span> laneGroupAttrIndex = 1 : numel(layer.LaneGroupAttribution)
    laneGroup = layer.LaneGroupAttribution(laneGroupAttrIndex);
    attributes(laneGroupAttrIndex).LaneGroupId = laneGroup.LaneGroupRef; <span style="color:#228B22">%#ok</span>

    <span style="color:#228B22">% Get lane types for each lane group</span>
    <span style="color:#0000FF">for</span> laneAttrIndex = 1 : numel(laneGroup.LaneAttribution)

        lane = laneGroup.LaneAttribution(laneAttrIndex);

        laneAttr = vertcat(lane.ParametricAttribution);
        laneAttr = vertcat(laneAttr.LaneParametricAttribution);

        <span style="color:#0000FF">for</span> idx = 1 : numel(laneAttr)
            <span style="color:#0000FF">if</span> ~isempty(laneAttr(idx).LaneType)
                attributes(laneGroupAttrIndex).Lanes{lane.LaneNumber} = <span style="color:#0000FF">...</span>
                    laneAttr(idx).LaneType;
            <span style="color:#0000FF">end</span>
        <span style="color:#0000FF">end</span>
    <span style="color:#0000FF">end</span>

    <span style="color:#228B22">% Get lane boundaries for each lane group</span>
    <span style="color:#0000FF">for</span> laneBoundaryIndex = 1 : numel(laneGroup.LaneBoundaryAttribution)
        laneBoundary = laneGroup.LaneBoundaryAttribution(laneBoundaryIndex);
        boundaries   = vertcat(laneBoundary.ParametricAttribution.LaneBoundaryParametricAttribution);

        attributes(laneGroupAttrIndex).LaneBoundaries{laneBoundary.LaneBoundaryNumber} = <span style="color:#0000FF">...</span>
            boundaries.LaneBoundaryMarking;
    <span style="color:#0000FF">end</span>

<span style="color:#0000FF">end</span>

laneAttributesTable = struct2table(attributes);
<span style="color:#0000FF">end</span>
</pre>
</div>
</div>
</div>
<p><code class="literal">helperLoadCameraData</code> 函数从文件夹中加载视频读取器和时间戳。</p>
<div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre><span style="color:#0000FF">function</span> [videoReader, videoTime] = helperLoadCameraData(dirName)
<span style="color:#228B22">%helperLoadCameraData Load camera images from folder in a timetable</span>
<span style="color:#228B22">%   [videoReader, videoTime] = helperLoadCameraData(dirName) loads a video</span>
<span style="color:#228B22">%   from the folder dirName. Timestamps for the video are read from a</span>
<span style="color:#228B22">%   MAT-file in the folder named timeStamps.mat.</span>

<span style="color:#0000FF">if</span> ~isfolder(dirName)
    error(<span style="color:#A020F0">'Expected dirName to be a path to a folder.'</span>)
<span style="color:#0000FF">end</span>

matFileName = fullfile(dirName, <span style="color:#A020F0">'centerCameraTime.mat'</span>);
<span style="color:#0000FF">if</span> exist(matFileName, <span style="color:#A020F0">'file'</span>) ~= 2
    error(<span style="color:#A020F0">'Expected dirName to have a MAT-file named centerCameraTime.mat containing timestamps.'</span>)
<span style="color:#0000FF">end</span>

<span style="color:#228B22">% Load the MAT-file with timestamps</span>
ts = load(matFileName);
fieldNames = fields(ts);
Time = ts.(fieldNames{1});

videoFileName = fullfile(dirName, <span style="color:#A020F0">'centerCamera.avi'</span>);
<span style="color:#0000FF">if</span> exist(matFileName, <span style="color:#A020F0">'file'</span>) ~= 2
    error(<span style="color:#A020F0">'Expected dirName to have a video file named centerCamera.avi.'</span>)
<span style="color:#0000FF">end</span>

<span style="color:#228B22">% Load the video file</span>
videoTime = timetable(Time);
videoReader = VideoReader(videoFileName);
<span style="color:#0000FF">end</span>
</pre>
</div>
</div>
</div>
</div>
      <h2 id="d124e44146">See Also</h2>
<p><span itemscope="" itemtype="http://www.mathworks.com/help/schema/MathWorksDocPage/SeeAlso" itemprop="seealso"><a itemprop="url" href="../ref/herehdlmreader.html"><span itemprop="name"><code class="object">hereHDLMReader</code></span></a></span> | <span itemscope="" itemtype="http://www.mathworks.com/help/schema/MathWorksDocPage/SeeAlso" itemprop="seealso"><a itemprop="url" href="../ref/herehdlmreader.read.html"><span itemprop="name"><code class="function">read</code></span></a></span> | <span itemscope="" itemtype="http://www.mathworks.com/help/schema/MathWorksDocPage/SeeAlso" itemprop="seealso"><a itemprop="url" href="../ref/driving.heremaps.lanetopology.plot.html"><span itemprop="name"><code class="function">plot</code></span></a></span></p>
      <h2 id="d124e44158">Related Topics</h2>
<ul><li><a href="here-hd-live-map-layers.html" class="a">HERE HD Live Map Layers</a></li>
<li><a href="read-and-visualize-here-hd-live-map-data.html" class="a">Read and Visualize HERE HD Live Map Data</a></li>
<li><a href="import-here-hd-live-map-roads-into-driving-scenario.html" class="a">Import HERE HD Live Map Roads into Driving Scenario</a></li>
</ul>
    </section>
    </div>
<div class="modal fade" id="open-example-dialog" tabindex="-1" role="dialog" aria-labelledby="openExampleDialogLabel" aria-hidden="true"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button><h2 class="h3 modal-title">Open Example</h2>
</div>
<div class="modal-body" id="dialog-body"><p>You have a modified version of this example. Do you want to open this example with your edits?</p>
</div>
<div class="modal-footer"><a id="open-example-dialog-replace" class="btn btn_color_blue companion_btn" data-dismiss="modal">No, open this example and discard my edits</a><a id="open-example-dialog-continue" class="btn btn_color_blue" data-dismiss="modal">Yes</a></div>
</div>
</div>
</div>
<div class="clearfix"></div>
<div align="center" class="feedbackblock" id="mw_docsurvey"><script src="https://www.mathworks.com/help/docsurvey/docfeedback.js"></script>
<script>loadSurveyHidden();</script>
<link rel="stylesheet" href="https://www.mathworks.com/help/docsurvey/release/index-css.css" type="text/css"/>
<script src="https://www.mathworks.com/help/docsurvey/release/bundle.index.js"></script>

<script>initDocSurvey();</script>
</div>
</section>


</div>
</div>
</div>
</div>
<!--close_0960--><footer xmlns="http://www.w3.org/1999/xhtml" id="footer" class="bs-footer">
<div class="container-fluid">
<div class="footer">
<div class="row">
<div class="col-xs-12">
<p class="copyright">© 1994-2022 The MathWorks, Inc.</p>
<ul class="footernav"><li class="footernav_help"><a href="matlab:web(matlab.internal.licenseAgreement)">Terms of Use</a></li>
<li class="footernav_patents"><a href="matlab:web([matlabroot '/patents.txt'])">Patents</a></li>
<li class="footernav_trademarks"><a href="matlab:web([matlabroot '/trademarks.txt'])">Trademarks</a></li>
<li class="footernav_piracy"><a href="matlab:web([docroot '/acknowledgments.html'])">Acknowledgments</a></li>
</ul>
</div>
</div>
</div>
</div>
</footer>
</div>
<!--close row-offcanvas--></div>
<!--close_0970-->
</body>
</html>
<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://www.mathworks.com/help/schema/MathWorksDocPage">
<head>
<meta xmlns="http://www.w3.org/1999/xhtml" charset="utf-8"/>
<meta xmlns="http://www.w3.org/1999/xhtml" name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta xmlns="http://www.w3.org/1999/xhtml" http-equiv="X-UA-Compatible" content="IE=edge"/>
<title>Annotate Video Using Detections in Vehicle Coordinates</title>
<script xmlns="http://www.w3.org/1999/xhtml" type="application/ld+json">
      {
      "@context": "http://schema.org",
      "@type": "BreadcrumbList",
      "itemListElement":
      [{
          "@type": "ListItem",
          "position": 1,

          "item": {
          "@id": "../index.html",
          "name": "Automated Driving Toolbox"
}

          } 
        ,
        {
          "@type": "ListItem",
          "position": 2,

          "item": {
          "@id": "../detection-and-tracking.html",
          "name": "Detection and Tracking"
}

          }
        ,
        {
          "@type": "ListItem",
          "position": 3,

          "item": {
          "@id": "../camera-sensor-configuration.html",
          "name": "Camera Sensor Configuration"
}

          }]
      }</script>
<script xmlns="http://www.w3.org/1999/xhtml" type="application/ld+json">
        {
        "@context": "http://schema.org",
        "@type": "ItemList",
          "name": "VisibleBreadcrumbs",

        "itemListElement":
        [
        "camera-sensor-configuration"
        ],
        "itemListOrder": "http://schema.org/ItemListOrderAscending"
        }
        </script>
<script xmlns="http://www.w3.org/1999/xhtml" type="application/ld+json">
        {
        "@context": "http://schema.org",
        "@type": "DigitalDocument",
          "headline": "Annotate Video Using Detections in Vehicle Coordinates",
          "description": "Configure and use a monocular camera object to display information provided in vehicle coordinates on a video display.",
          "thumbnailURL": "../../examples/driving/win64/AnnotateVideoUsingDetectionsInVehicleCoordiantesExample_02.png",
          "genre": "Live Script",
          "isBasedOn": {
          "@type": "Product",
          "name": "MATLAB"

        },
          "identifier": "driving.AnnotateVideoUsingDetectionsInVehicleCoordiantesExample",
          "name": "AnnotateVideoUsingDetectionsInVehicleCoordiantesExample",
          "url": "annotate-video-using-detections-in-vehicle-coordinates.html"

        }</script>
<script xmlns="http://www.w3.org/1999/xhtml" type="application/ld+json">
        {
        "@context": "http://schema.org",
        "@type": "PropertyValue",
          "name": "open_command",
          "value": "matlab:openExample('driving/AnnotateVideoUsingDetectionsInVehicleCoordiantesExample')"

        }</script>
<script xmlns="http://www.w3.org/1999/xhtml" type="application/ld+json">
        {
        "@context": "http://schema.org",
        "@type": "ItemList",
          "name": "ExampleSourceFiles",

        "itemListElement":
        [
        "AnnotateVideoUsingDetectionsInVehicleCoordiantesExample.mlx"
        ],
        "itemListOrder": "http://schema.org/ItemListOrderAscending"
        }
        </script>
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/bootstrap.min.css" rel="stylesheet" type="text/css"/>


  <meta xmlns="http://www.w3.org/1999/xhtml" http-equiv="Content-Script-Type" content="text/javascript"/>
<meta xmlns="http://www.w3.org/1999/xhtml" name="toctype" itemprop="pagetype" content="ug"/>
<meta xmlns="http://www.w3.org/1999/xhtml" name="infotype" itemprop="infotype" content="other"/>

<meta xmlns="http://www.w3.org/1999/xhtml" name="description" itemprop="description" content="Configure and use a monocular camera object to display information provided in vehicle coordinates on a video display."/>
<meta xmlns="http://www.w3.org/1999/xhtml" content="../../examples/driving/win64/AnnotateVideoUsingDetectionsInVehicleCoordiantesExample_02.png" itemprop="thumbnailUrl"/>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/jquery/jquery-latest.js"></script>
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/site6.css" rel="stylesheet" type="text/css"/>
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/site6_lg.css" rel="stylesheet" media="screen and (min-width: 1200px)"/>
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/site6_md.css" rel="stylesheet" media="screen and (min-width: 992px) and (max-width: 1199px)"/>
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/site6_sm+xs.css" rel="stylesheet" media="screen and (max-width: 991px)"/>
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/site6_sm.css" rel="stylesheet" media="screen and (min-width: 768px) and (max-width: 991px)"/>
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/site6_xs.css" rel="stylesheet" media="screen and (max-width: 767px)"/>
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/site6_offcanvas_v2.css" rel="stylesheet" type="text/css"/>

<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/l10n.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/docscripts.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/f1help.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/docscripts.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/mw.imageanimation.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/jquery.highlight.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/underscore-min.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/use_platform_screenshots.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/suggest.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/overload.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/helpservices.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/productfilter.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/product_group.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/scripts/saxonjs/SaxonJS2.rt.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml">
            window.history.replaceState(window.location.href, null, ""); // Initialize
            window.onload = function() {    
            mystylesheetLocation = "../../includes/shared/scripts/product_group-sef.json";
            mysourceLocation = "../../docset.xml";
            product_help_location = "driving";
            pagetype = "section";
            doccentertype = "product";
            langcode = "";
            getProductFilteredList(mystylesheetLocation, mysourceLocation, product_help_location, pagetype, doccentertype, langcode);  
            }
          </script>




<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/jquery/jquery.mobile.custom.min.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/bootstrap.min.js"></script>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/product/scripts/global.js"></script>
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/doc_center_base.css" rel="stylesheet" type="text/css"/>
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/doc_center_installed.css" rel="stylesheet" type="text/css"/>
<link xmlns="http://www.w3.org/1999/xhtml" href="../../includes/product/css/doc_center_print.css" rel="stylesheet" type="text/css" media="print"/>
<script xmlns="http://www.w3.org/1999/xhtml" src="../../includes/shared/equationrenderer/release/MathRenderer.js"></script>
</head>
<body id="responsive_offcanvas">
<div xmlns="http://www.w3.org/1999/xhtml" id="doc_header_spacer" class="header"></div>
<div xmlns="http://www.w3.org/1999/xhtml" class="section_header level_3"><div class="container-fluid"><div class="row" id="mobile_search_row"><div class="col-sm-6 col-md-7 has_horizontal_local_nav" id="section_header_title"><div class="section_header_content"><div class="section_header_title"><h1><a href="../../documentation-center.html">Help Center</a></h1>
</div>
</div>
</div>
<div class="col-xs-12 col-sm-6 col-md-5" id="mobile_search"><div class="search_nested_content_container"><form id="docsearch_form" name="docsearch_form" method="get" data-release="R2022b" data-language="en" action="../../templates/searchresults.html"><div class="input-group tokenized_search_field"><label class="sr-only">Search Help</label><input type="text" class="form-control conjoined_search" autocomplete="off" name="qdoc" placeholder="Search Help" id="docsearch"/> <div class="input-group-btn"><button type="submit" name="submitsearch" id="submitsearch" class="btn icon-search btn_search_adjacent btn_search icon_16" tabindex="-1"></button></div>
</div></form>
</div>
<button class="btn icon-remove btn_search pull-right icon_32 visible-xs" data-toggle="collapse" href="#mobile_search" aria-expanded="false" aria-controls="mobile_search"></button></div>
<div class="visible-xs" id="search_actuator"><button class="btn icon-search btn_search pull-right icon_16" data-toggle="collapse" href="#mobile_search" aria-expanded="false" aria-controls="mobile_search"></button></div>
</div>
</div>
</div>
<div class="row-offcanvas row-offcanvas-left">
<div xmlns="http://www.w3.org/1999/xhtml" class="sidebar-offcanvas" id="sidebar">
<nav class="offcanvas_nav" role="navigation">
<div class="offcanvas_actuator" data-toggle="offcanvas" data-target="#sidebar" id="nav_toggle"><button type="button" class="btn"><span class="sr-only">Off-Canvas Navigation Menu Toggle
                  Off-Canvas Navigation Menu Toggle</span><span class="icon-menu"></span></button><span class="offcanvas_actuator_label" id="translation_icon-menu" tabindex="-1" aria-hidden="true"></span></div><div class="nav_list_wrapper" id="nav_list_wrapper"><nav class="offcanvas_nav" role="navigation"><ul class="nav_breadcrumb" id="ul_left_nav_ancestors"><li itemscope="" itemtype="http://www.data-vocabulary.org/Breadcrumb" itemprop="breadcrumb"><a href="../../documentation-center.html?s_tid=CRUX_lftnav" itemprop="url"><span itemprop="title">Documentation Home</span></a></li>
</ul><ul class="nav_breadcrumb" id="ul_left_nav_productgroups"><li itemscope="" itemtype="http://www.data-vocabulary.org/Breadcrumb" itemprop="breadcrumb"><a href="../../overview/robotics-and-autonomous-systems.html" itemprop="url"><span itemprop="title">Robotics and Autonomous Systems</span></a></li>
<li itemscope="" itemtype="http://www.data-vocabulary.org/Breadcrumb" itemprop="breadcrumb"><a href="../../overview/automotive.html" itemprop="url"><span itemprop="title">Automotive</span></a></li>
</ul>
<ul class="nav_disambiguation"><li><a href="../index.html?s_tid=CRUX_lftnav">Automated Driving Toolbox</a>
</li>
<li itemscope="" itemtype="http://www.data-vocabulary.org/Breadcrumb" itemprop="breadcrumb"><a href="../detection-and-tracking.html?s_tid=CRUX_lftnav" itemprop="url"><span itemprop="title">Detection and Tracking</span></a></li>
<li itemscope="" itemtype="http://www.data-vocabulary.org/Breadcrumb" itemprop="breadcrumb"><a href="../camera-sensor-configuration.html?s_tid=CRUX_lftnav" itemprop="url"><span itemprop="title">Camera Sensor Configuration</span></a></li>
</ul><ul class="nav_scrollspy nav">
<li class="nav_scrollspy_function"><a href="#responsive_offcanvas">Annotate Video Using Detections in Vehicle Coordinates</a></li>
<li class="nav_scrollspy_title" id="SSPY810-section">On this page</li>
<!--ADD_REFENTRY_TITLE_HERE 11--><li><a href="#AnnotateVideoUsingDetectionsInVehicleCoordiantesExample-1" class="intrnllnk">Overview</a></li>
<li><a href="#AnnotateVideoUsingDetectionsInVehicleCoordiantesExample-2" class="intrnllnk">Display a Frame with Video Annotations</a></li>
<li><a href="#AnnotateVideoUsingDetectionsInVehicleCoordiantesExample-3" class="intrnllnk">Display a Clip with Video Annotations</a></li>
<li><a href="#AnnotateVideoUsingDetectionsInVehicleCoordiantesExample-4" class="intrnllnk">Create the Mono Camera for On-Video Display</a></li>
<li><a href="#AnnotateVideoUsingDetectionsInVehicleCoordiantesExample-5" class="intrnllnk">Using the Mono Camera Object to Update the Display</a></li>
<li><a href="#AnnotateVideoUsingDetectionsInVehicleCoordiantesExample-6" class="intrnllnk">Summary</a></li>
<li><a href="#AnnotateVideoUsingDetectionsInVehicleCoordiantesExample-7" class="intrnllnk">Supporting Functions</a></li>
<li><a href="#d124e22496" class="intrnllnk">See Also</a></li>
<li><a href="#d124e22526" class="intrnllnk">Related Topics</a></li>
</ul>
</nav>
</div></nav>
<script src="../../includes/product/scripts/offcanvas_v2.js"></script>
</div>
<!--END.CLASS sidebar-offcanvas--><div class="offcanvas_content_container">
<div xmlns="http://www.w3.org/1999/xhtml" class="sticky_header_container"><div class="horizontal_nav"><div class="horizontal_nav_container"><div class="offcanvas_horizontal_nav"><div class="container-fluid"><div class="row"><div class="col-sm-12 hidden-xs"><nav class="navbar navbar-default" role="navigation" id="subnav"><div><ul class="nav navbar-nav crux_browse"><li id="crux_nav_documentation" class="crux_resource active"><a>Documentation</a></li>
<li id="crux_nav_example" class="crux_resource"><a href="../examples.html?category=camera-sensor-configuration&amp;s_tid=CRUX_topnav">Examples</a></li>
<li id="crux_nav_function" class="crux_resource"><a href="../referencelist.html?type=function&amp;category=camera-sensor-configuration&amp;s_tid=CRUX_topnav">Functions</a></li>
<li id="crux_nav_block" class="crux_resource"><a href="../referencelist.html?type=block&amp;category=camera-sensor-configuration&amp;s_tid=CRUX_topnav">Blocks</a></li>
<li id="crux_nav_app" class="crux_resource"><a href="../referencelist.html?type=app&amp;category=camera-sensor-configuration&amp;s_tid=CRUX_topnav">Apps</a></li>
<li id="crux_nav_scene" class="crux_resource"><a href="../referencelist.html?type=scene&amp;category=camera-sensor-configuration&amp;s_tid=CRUX_topnav">Scenes</a></li>
</ul>
</div></nav>
</div>
<div class="visible-xs"><div class="container-fluid"><div class="row"><div class="col-xs-9"><div class="mobile_crux_nav_trigger"><div class="btn-group"><button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Resources<span class="icon-arrow-down icon_16"></span></button><ul class="dropdown-menu"><li id="crux_nav_mobile_documentation" class="crux_resource active"><a>Documentation</a></li>
<li id="crux_nav_mobile_example" class="crux_resource"><a href="../examples.html?category=camera-sensor-configuration&amp;s_tid=CRUX_topnav">Examples</a></li>
<li id="crux_nav_mobile_function" class="crux_resource"><a href="../referencelist.html?type=function&amp;category=camera-sensor-configuration&amp;s_tid=CRUX_topnav">Functions</a></li>
<li id="crux_nav_mobile_block" class="crux_resource"><a href="../referencelist.html?type=block&amp;category=camera-sensor-configuration&amp;s_tid=CRUX_topnav">Blocks</a></li>
<li id="crux_nav_mobile_app" class="crux_resource"><a href="../referencelist.html?type=app&amp;category=camera-sensor-configuration&amp;s_tid=CRUX_topnav">Apps</a></li>
<li id="crux_nav_mobile_scene" class="crux_resource"><a href="../referencelist.html?type=scene&amp;category=camera-sensor-configuration&amp;s_tid=CRUX_topnav">Scenes</a></li>
</ul>
</div>
</div>
</div>
<div class="col-xs-3"><div class="translate_placeholder"></div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="content_container" id="content_container" itemprop="content">
<div class="container-fluid">
<div class="row">
<div class="col-xs-12">

<div xmlns="http://www.w3.org/1999/xhtml" id="product_info_alert"></div>
<section xmlns="http://www.w3.org/1999/xhtml" id="doc_center_content" lang="en" data-language="en"><div id="pgtype-topic">
<section itemprop="content"><h1 class="r2022b" itemprop="title content" id="mw_8e648db8-f7b8-449e-a475-e82768322dd8">使用车辆坐标中的检测对视频进行注释</h1>
<div class="examples_short_list hidden_ios_android"><div data-pane="metadata" class="panel metadata_container panel-default"><div class="panel-body metadata_content"><a class="btn btn_secondary btn-block" href="matlab:openExample('driving/AnnotateVideoUsingDetectionsInVehicleCoordiantesExample')" data-ex-genre="Live Script">Open Live Script</a></div>
</div>
</div>
<div itemscope="" itemtype="http://www.mathworks.com/help/schema/MathWorksDocPage/Example" itemprop="example" class="em_example"><meta itemprop="exampleid" content="driving-AnnotateVideoUsingDetectionsInVehicleCoordiantesExample"/>
<meta itemprop="exampletitle" content="Annotate Video Using Detections in Vehicle Coordinates"/>
</div>
<span id="AnnotateVideoUsingDetectionsInVehicleCoordiantesExample" class="anchor_target"></span><p class="shortdesc">配置并使用 <code class="literal">monoCamera </code>对象在视频显示器上显示车辆坐标中提供的信息。</p>
<div class="procedure"><h3 class="title" id="AnnotateVideoUsingDetectionsInVehicleCoordiantesExample-1">概述</h3>
<p><span style="font-family: &quot;Microsoft YaHei&quot;;">在录制的视频上显示车辆坐标中记录的数据是地面实况标注和分析跟踪结果不可或缺的一部分。使用二维鸟瞰图可以帮助您了解整体环境，但有时很难将视频与鸟瞰图显示相关联。特别是，当使用第三方传感器时，此问题会变得更糟，因为您无法访问传感器捕获的原始视频，并且需要使用由单独相机捕获的视频。</span></p>
<p><span style="font-family: &quot;Microsoft YaHei&quot;;">自动驾驶工具箱™提供了</span> <code class="literal"></code><a href="../ref/monocamera.html" data-docid="driving_ref#bvgu10o-1" class="a"><code class="olink">monoCamera</code></a> <span style="font-family: &quot;Microsoft YaHei&quot;;">对象，便于车辆坐标和图像坐标之间的转换。此示例读取安装在测试车辆上的视频传感器记录的数据。然后，它显示由安装在同一辆车上的单独摄像机捕获的视频中的数据。数据和视频以以下速率记录：</span></p>
<div class="itemizedlist"><ul><li><p>上报车道信息：每秒20次</p></li>
<li><p>报告的视觉对象：每秒10次</p></li>
<li><p>视频帧率：每秒20帧</p></li>
</ul>
</div>
<h3 class="title" id="AnnotateVideoUsingDetectionsInVehicleCoordiantesExample-2">显示带有视频注释的帧</h3>
<p>所选帧对应于视频剪辑的 5.9 秒，此时视频上显示多个对象。</p>
<div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre><span style="color:#228B22">% Set up video reader and player</span>
videoFile      = <span style="color:#A020F0">'01_city_c2s_fcw_10s.mp4'</span>;
videoReader = VideoReader(videoFile);
videoPlayer = vision.DeployableVideoPlayer;

<span style="color:#228B22">% Jump to the desired frame</span>
time = 5.9;
videoReader.CurrentTime = time;
frameWithoutAnnotations = readFrame(videoReader);

imshow(frameWithoutAnnotations); 
title(<span style="color:#A020F0">'Original Video Frame'</span>)</pre>
</div>
</div>
</div>
<div class="informalfigure"><div id="d124e22303" class="mediaobject"><p><img src="../../examples/driving/win64/AnnotateVideoUsingDetectionsInVehicleCoordiantesExample_01.png" alt="Figure contains an axes object. The axes object with title Original Video Frame contains an object of type image." width="772"/></p>
</div>
</div>
<p>获取相应的记录数据。</p>
<div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre>recordingFile  = <span style="color:#A020F0">'01_city_c2s_fcw_10s_sensor.mat'</span>;
[visionObjects, laneReports, timeStep, numSteps] = readDetectionsFile(recordingFile);
currentStep = round(time / timeStep) + 1;
videoDetections = processDetections(visionObjects(currentStep));
laneBoundaries = processLanes(laneReports(currentStep));

<span style="color:#228B22">% Set up the monoCamera object for on-video display</span>
sensor = setupMonoCamera(videoReader);

frameWithAnnotations = updateDisplay(frameWithoutAnnotations, sensor, videoDetections, laneBoundaries);

imshow(frameWithAnnotations); 
title(<span style="color:#A020F0">'Annotated Video Frame'</span>)</pre>
</div>
</div>
</div>
<div class="informalfigure"><div id="d124e22311" class="mediaobject"><p><img src="../../examples/driving/win64/AnnotateVideoUsingDetectionsInVehicleCoordiantesExample_02.png" alt="Figure contains an axes object. The axes object with title Annotated Video Frame contains an object of type image." width="772"/></p>
</div>
</div>
<h3 class="title" id="AnnotateVideoUsingDetectionsInVehicleCoordiantesExample-3">显示带有视频注释的剪辑</h3>
<p>要显示带有注释的视频剪辑，只需逐帧重复注释即可。视频显示，汽车略微上下俯仰，这改变了俯仰角度。没有尝试补偿这种俯仰运动。因此，在某些帧上，从车辆坐标到图像坐标的转换有点不准确。</p>
<div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre><span style="color:#228B22">% Reset the time back to zero</span>
currentStep = 0;                <span style="color:#228B22">% Reset the recorded data timestep</span>
videoReader.CurrentTime = 0;    <span style="color:#228B22">% Reset the video reader time</span>
<span style="color:#0000FF">while</span> currentStep &lt; numSteps &amp;&amp; hasFrame(videoReader)
    <span style="color:#228B22">% Update scenario counters</span>
    currentStep = currentStep + 1;
    
    <span style="color:#228B22">% Get the current time</span>
    tic
    
    <span style="color:#228B22">% Prepare the detections to the tracker</span>
    videoDetections = processDetections(visionObjects(currentStep), videoDetections);

    <span style="color:#228B22">% Process lanes</span>
    laneBoundaries = processLanes(laneReports(currentStep));
    
    <span style="color:#228B22">% Update video frame with annotations from the reported objects</span>
    frameWithoutAnnotations = readFrame(videoReader);
    frameWithAnnotations = updateDisplay(frameWithoutAnnotations, sensor, videoDetections, laneBoundaries);
    
    <span style="color:#228B22">% The recorded data was obtained at a rate of 20 frames per second.</span>
    <span style="color:#228B22">% Pause for 50 milliseconds for a more realistic display rate. If you</span>
    <span style="color:#228B22">% process data and form tracks in this loop, you do not need this</span>
    <span style="color:#228B22">% pause.</span>
    pause(0.05 - toc);
    
    <span style="color:#228B22">% Display annotated frame</span>
    videoPlayer(frameWithAnnotations);    
<span style="color:#0000FF">end</span></pre>
</div>
</div>
</div>
<h3 class="title" id="AnnotateVideoUsingDetectionsInVehicleCoordiantesExample-4">创建用于视频显示的单色摄像头</h3>
<p><code class="literal">setupMonoCamera</code> 函数返回一个 <code class="literal">monoCamera</code> 传感器对象，用于将车辆坐标中的位置转换为图像坐标。</p>
<p>了解相机的固有和外在校准参数对于像素和车辆坐标之间的精确转换至关重要。</p>
<p>首先定义相机内部参数。此函数中的参数是根据相机型号估计的。要获取相机的参数，请使用 <a href="../../vision/ref/cameracalibrator-app.html" data-docid="vision_ref#burd_hd-1" class="a">Camera Calibrator</a> 应用程序。</p>
<p>由于此示例中的数据几乎没有失真，因此此函数忽略镜头畸变系数。参数接下来存储在 <code class="literal">cameraIntrinsics</code> 对象中.</p>
<p>接下来，定义相机外联函数。摄像头外在因素与摄像头安装在汽车上的方式有关。安装包括以下属性：</p>
<div class="itemizedlist"><ul><li><p>Height: 离地面安装高度，以米为单位。</p></li>
<li><p>Pitch: 摄像机的俯仰度，以度为单位，其中正正值的角度低于地平线并朝向地面。在大多数情况下，摄像机的倾斜度略低于地平线。</p></li>
<li><p>Roll: 相机绕其轴滚动。例如，如果视频倒置，请使用 roll = 180。</p></li>
<li><p>Yaw: 相机侧向的角度，其中正方向是正 <span class="emphasis" _istranslated="1"><em _istranslated="1">y</em></span> 轴的方向（向左）。例如，前置摄像头的偏航角为 0 度，后置摄像头的偏航角为 180 度。</p></li>
</ul>
</div>
<div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre><span style="color:#0000FF">function</span> sensor = setupMonoCamera(vidReader)
<span style="color:#228B22">% Define the camera intrinsics from the video information</span>
focalLength    = [1260 1100];                    <span style="color:#228B22">% [fx, fy]              % pixels</span>
principalPoint = [360 245];                      <span style="color:#228B22">% [cx, cy]              % pixels</span>
imageSize = [vidReader.height, vidReader.width]; <span style="color:#228B22">% [numRows, numColumns] % pixels</span>
intrinsics = cameraIntrinsics(focalLength, principalPoint, imageSize);

<span style="color:#228B22">% Define the camera mounting (camera extrinsics)</span>
mountingHeight = 1.45;   <span style="color:#228B22">% height in meters from the ground</span>
mountingPitch  = 1.25;   <span style="color:#228B22">% pitch of the camera in degrees</span>
mountingRoll   = 0.15;   <span style="color:#228B22">% roll of the camera in degrees</span>
mountingYaw    = 0;      <span style="color:#228B22">% yaw of the camera in degrees</span>
sensor = monoCamera(intrinsics, mountingHeight, <span style="color:#0000FF">...</span>
    <span style="color:#A020F0">'Pitch'</span>, mountingPitch, <span style="color:#0000FF">...</span>
    <span style="color:#A020F0">'Roll'</span>,  mountingRoll, <span style="color:#0000FF">...</span>
    <span style="color:#A020F0">'Yaw'</span>,   mountingYaw);
<span style="color:#0000FF">end</span></pre>
</div>
</div>
</div>
<h3 class="title" id="AnnotateVideoUsingDetectionsInVehicleCoordiantesExample-5">使用单色相机对象更新显示</h3>
<p><code class="literal">updateDisplay</code> 函数在视频帧顶部显示所有对象注释。</p>
<p>显示更新包括以下步骤：</p>
<div class="orderedlist"><ol style="list-style: decimal;"><li><p>使用 <code class="literal">monoCamera</code> 传感器将报告的检测结果转换为边界框并批注帧。</p></li>
<li><p>使用 <code class="literal">parabolicLaneBoundary</code> 对象的 <code class="literal">insertLaneBoundary</code> 方法插入车道注释。</p></li>
</ol>
</div>
<div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre><span style="color:#0000FF">function</span> frame = updateDisplay(frame, sensor, videoDetections, laneBoundaries)

<span style="color:#228B22">% Allocate memory for bounding boxes</span>
bboxes = zeros(numel(videoDetections), 4);

<span style="color:#228B22">% Create the bounding boxes</span>
<span style="color:#0000FF">for</span> i = 1:numel(videoDetections)
    <span style="color:#228B22">% Use monoCamera sensor to convert the position in vehicle coordinates </span>
    <span style="color:#228B22">% to the position in image coordinates. </span>
    <span style="color:#228B22">% Notes: </span>
    <span style="color:#228B22">%   1. The width of the object is reported and is used to calculate the</span>
    <span style="color:#228B22">%      size of the bounding box around the object (half width on each</span>
    <span style="color:#228B22">%      side). The height of the object is not reported. Instead, the </span>
    <span style="color:#228B22">%      function uses a height/width ratio of 0.85 for cars and 3 for</span>
    <span style="color:#228B22">%      pedestrians.</span>
    <span style="color:#228B22">%   2. The reported location is at the center of the object at ground </span>
    <span style="color:#228B22">%      level, i.e., the bottom of the bounding box.</span>
    xyLocation1 = vehicleToImage(sensor, videoDetections(i).positions' + [0,videoDetections(i).widths/2]);
    xyLocation2 = vehicleToImage(sensor, videoDetections(i).positions' - [0,videoDetections(i).widths/2]);
    dx = xyLocation2(1) - xyLocation1(1);
    
    <span style="color:#228B22">% Define the height/width ratio based on object class</span>
    <span style="color:#0000FF">if</span> strcmp(videoDetections(i).labels, <span style="color:#A020F0">'Car'</span>)
        dy = dx * 0.85;
    <span style="color:#0000FF">elseif</span>  strcmp(videoDetections(i).labels, <span style="color:#A020F0">'Pedestrian'</span>)
        dy = dx * 3;
    <span style="color:#0000FF">else</span>
        dy = dx;
    <span style="color:#0000FF">end</span>
    
    <span style="color:#228B22">% Estimate the bounding box around the vehicle. Subtract the height of</span>
    <span style="color:#228B22">% the bounding box to define the top-left corner.</span>
    bboxes(i,:) =[(xyLocation1 - [0, dy]), dx, dy];
<span style="color:#0000FF">end</span>

<span style="color:#228B22">% Add labels</span>
labels = {videoDetections(:).labels}';

<span style="color:#228B22">% Add bounding boxes to the frame</span>
<span style="color:#0000FF">if</span> ~isempty(labels)
    frame = insertObjectAnnotation(frame, <span style="color:#A020F0">'rectangle'</span>, bboxes, labels,<span style="color:#0000FF">...</span>
        <span style="color:#A020F0">'Color'</span>, <span style="color:#A020F0">'yellow'</span>, <span style="color:#A020F0">'FontSize'</span>, 10, <span style="color:#A020F0">'TextBoxOpacity'</span>, .8, <span style="color:#A020F0">'LineWidth'</span>, 2);
<span style="color:#0000FF">end</span>

<span style="color:#228B22">% Display the lane boundary on the video frame</span>
xRangeVehicle = [1, 100];
xPtsInVehicle = linspace(xRangeVehicle(1), xRangeVehicle(2), 100)';
frame = insertLaneBoundary(frame, laneBoundaries(1), sensor, xPtsInVehicle, <span style="color:#0000FF">...</span>
    <span style="color:#A020F0">'Color'</span>, <span style="color:#A020F0">'red'</span>);
frame = insertLaneBoundary(frame, laneBoundaries(2), sensor, xPtsInVehicle, <span style="color:#0000FF">...</span>
    <span style="color:#A020F0">'Color'</span>, <span style="color:#A020F0">'green'</span>);
<span style="color:#0000FF">end</span></pre>
</div>
</div>
</div>
<h3 class="title" id="AnnotateVideoUsingDetectionsInVehicleCoordiantesExample-6">总结</h3>
<p>这个示例展示了如何创建一个 <code class="literal">monoCamera</code> 传感器对象，并使用它在由单独的摄像机捕获的视频上显示以车辆坐标描述的物体。尝试使用您自己的录制数据和视频摄像机。尝试对您的摄像机进行校准，创建一个允许从车辆坐标到图像坐标的转换，以及反之亦然的 <code class="literal">monoCamera</code> 对象。</p>
<h3 class="title" id="AnnotateVideoUsingDetectionsInVehicleCoordiantesExample-7">Supporting Functions</h3>
<p><strong class="emphasis bold">readDetectionsFile</strong> - 读取记录的传感器数据文件。记录的数据以一个结构体数组的形式存在，被分为四个结构体数组。本示例仅使用以下两个数组：</p>
<div class="orderedlist"><ol style="list-style: decimal;"><li><p><code class="literal">laneReports</code>, 一个结构体数组，报告车道的边界。它具有以下字段：<code class="literal">left</code> 和 <code class="literal">right</code>。数组的每个元素对应于不同的时间步。<code class="literal">left</code> 和 <code class="literal">right </code>都是结构体，具有以下字段：<code class="literal">isValid</code>, <code class="literal">confidence</code>, <code class="literal">boundaryType</code>, <code class="literal">offset</code>, <code class="literal">headingAngle</code>, and <code class="literal">curvature</code>。</p></li>
<li><p><code class="literal">visionObjects</code>, 一个结构体数组，报告检测到的视觉对象。它具有字段 <code class="literal">numObjects</code> (<code class="literal">integer</code>) 和 <code class="literal">object</code> (<code class="literal">struct</code>)。数组的每个元素对应于不同的时间步。 <code class="literal">object</code> 是一个结构体数组，其中每个元素是一个单独的对象，具有以下字段：<code class="literal">id</code>, <code class="literal">classification</code>, <code class="literal">position (x;y;z)</code>, <code class="literal">velocity(vx;vy;vz)</code>, <code class="literal">size(dx;dy;dz)</code>. 注意：<span style="font-family: monospace;">z=vy=vz=dx=dz=0 </span>  <code class="literal">  </code></p></li>
</ol>
</div>
<div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre><span style="color:#0000FF">function</span> [visionObjects, laneReports, timeStep, numSteps] = readDetectionsFile(filename)
A = load(strcat(filename));
visionObjects = A.vision;
laneReports = A.lane;

<span style="color:#228B22">% Prepare some time variables</span>
timeStep = 0.05;                 <span style="color:#228B22">% Lane data is provided every 50 milliseconds</span>
numSteps = numel(visionObjects); <span style="color:#228B22">% Number of recorded timesteps</span>
<span style="color:#0000FF">end</span></pre>
</div>
</div>
</div>
<p><strong class="emphasis bold">processDetections</strong> - Reads the recorded vision detections. This example extracts only the following properties:</p>
<div class="orderedlist"><ol style="list-style: decimal;"><li><p>Position: A two-dimensional <code class="literal">[x, y]</code> array in vehicle coordinates</p></li>
<li><p>Width: The width of the object as reported by the video sensor (Note: The sensor does not report any other dimension of the object size.)</p></li>
<li><p>Labels: The reported classification of the object</p></li>
</ol>
</div>
<div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre><span style="color:#0000FF">function</span> videoDetections = processDetections(visionData, videoDetections)
<span style="color:#228B22">% The video sensor reports a classification value as an integer</span>
<span style="color:#228B22">% according to the following enumeration (starting from 0)</span>
ClassificationValues = {<span style="color:#A020F0">'Unknown'</span>, <span style="color:#A020F0">'Unknown Small'</span>, <span style="color:#A020F0">'Unknown Big'</span>, <span style="color:#0000FF">...</span>
    <span style="color:#A020F0">'Pedestrian'</span>, <span style="color:#A020F0">'Bike'</span>, <span style="color:#A020F0">'Car'</span>, <span style="color:#A020F0">'Truck'</span>, <span style="color:#A020F0">'Barrier'</span>};

<span style="color:#228B22">% The total number of objects reported by the sensor in this frame</span>
numVideoObjects = visionData.numObjects;

<span style="color:#228B22">% The video objects are reported only 10 times per second, but the video</span>
<span style="color:#228B22">% has a frame rate of 20 frames per second. To prevent the annotations from</span>
<span style="color:#228B22">% flickering on and off, this function returns the values from the previous</span>
<span style="color:#228B22">% timestep if there are no video objects.</span>
<span style="color:#0000FF">if</span> numVideoObjects == 0
    <span style="color:#0000FF">if</span> nargin == 1 <span style="color:#228B22">% Returning a result even if there is no previous value</span>
        videoDetections = struct(<span style="color:#A020F0">'positions'</span>, {}, <span style="color:#A020F0">'labels'</span>, {}, <span style="color:#A020F0">'widths'</span>, {});
    <span style="color:#0000FF">end</span>
    <span style="color:#0000FF">return</span>;
<span style="color:#0000FF">else</span>
    <span style="color:#228B22">% Prepare a container for the relevant properties of video detections</span>
    videoDetections = struct(<span style="color:#A020F0">'positions'</span>, [], <span style="color:#A020F0">'labels'</span>, [], <span style="color:#A020F0">'widths'</span>, []);
    <span style="color:#0000FF">for</span> i = 1:numVideoObjects
        videoDetections(i).widths = visionData.object(i).size(2);
        videoDetections(i).positions = visionData.object(i).position(1:2);
        videoDetections(i).labels = ClassificationValues{visionData.object(i).classification + 1};
    <span style="color:#0000FF">end</span>
<span style="color:#0000FF">end</span>
<span style="color:#0000FF">end</span></pre>
</div>
</div>
</div>
<p><strong class="emphasis bold">processLanes</strong> - Reads reported lane information and converts it into <code class="literal">parabolicLaneBoundary</code> objects.</p>
<p>Lane boundaries are updated based on the <code class="literal">laneReports</code> from the recordings. The sensor reports the lanes as parameters of a parabolic model: %  <span class="inlineequation"><math xmlns="http://www.w3.org/1998/Math/MathML" xmlns:mwmmlx="https://www.mathworks.com/namespace/MathMLextensions" mwmmlx:extension="true" display="block"><mrow><mi>y</mi><mo>=</mo><mi>a</mi><msup><mrow><mi>x</mi></mrow><mrow><mn>2</mn></mrow></msup><mo>+</mo><mi>b</mi><mi>x</mi><mo>+</mo><mi>c</mi></mrow></math></span></p>
<div class="code_responsive"><div class="programlisting"><div class="codeinput"><pre><span style="color:#0000FF">function</span> laneBoundaries = processLanes(laneReports)
<span style="color:#228B22">% Return processed lane boundaries</span>

<span style="color:#228B22">% Boundary type information</span>
types = {<span style="color:#A020F0">'Unmarked'</span>, <span style="color:#A020F0">'Solid'</span>, <span style="color:#A020F0">'Dashed'</span>, <span style="color:#A020F0">'Unmarked'</span>, <span style="color:#A020F0">'BottsDots'</span>, <span style="color:#0000FF">...</span>
    <span style="color:#A020F0">'Unmarked'</span>, <span style="color:#A020F0">'Unmarked'</span>, <span style="color:#A020F0">'DoubleSolid'</span>};

<span style="color:#228B22">% Read the recorded lane reports for this frame</span>
leftLane    = laneReports.left;
rightLane   = laneReports.right;

<span style="color:#228B22">% Create parabolicLaneBoundary objects for left and right lane boundaries</span>
leftParams = cast([leftLane.curvature, leftLane.headingAngle, leftLane.offset], <span style="color:#A020F0">'double'</span>);
leftBoundaries = parabolicLaneBoundary(leftParams);
leftBoundaries.BoundaryType = types{leftLane.boundaryType};

rightParams  = cast([rightLane.curvature, rightLane.headingAngle, rightLane.offset], <span style="color:#A020F0">'double'</span>);
rightBoundaries = parabolicLaneBoundary(rightParams);
rightBoundaries.BoundaryType = types{rightLane.boundaryType};

laneBoundaries = [leftBoundaries, rightBoundaries];
<span style="color:#0000FF">end</span></pre>
</div>
</div>
</div>
</div>
      <h2 id="d124e22496">See Also</h2>
<h3>Apps</h3>
<ul class="list-unstyled margined_10"><li><span itemscope="" itemtype="http://www.mathworks.com/help/schema/MathWorksDocPage/SeeAlso" itemprop="seealso"><a itemprop="url" href="../../vision/ref/cameracalibrator-app.html"><span itemprop="name">Camera Calibrator</span></a></span></li>
</ul>
<h3>Functions</h3>
<ul class="list-unstyled margined_10"><li><span itemscope="" itemtype="http://www.mathworks.com/help/schema/MathWorksDocPage/SeeAlso" itemprop="seealso"><a itemprop="url" href="../../vision/ref/insertobjectannotation.html"><span itemprop="name"><code class="function">insertObjectAnnotation</code></span></a></span> | <span itemscope="" itemtype="http://www.mathworks.com/help/schema/MathWorksDocPage/SeeAlso" itemprop="seealso"><a itemprop="url" href="../ref/insertlaneboundary.html"><span itemprop="name"><code class="function">insertLaneBoundary</code></span></a></span></li>
</ul>
<h3>Objects</h3>
<ul class="list-unstyled margined_10"><li><span itemscope="" itemtype="http://www.mathworks.com/help/schema/MathWorksDocPage/SeeAlso" itemprop="seealso"><a itemprop="url" href="../../matlab/ref/videoreader.html"><span itemprop="name"><code class="object">VideoReader</code></span></a></span> | <span itemscope="" itemtype="http://www.mathworks.com/help/schema/MathWorksDocPage/SeeAlso" itemprop="seealso"><a itemprop="url" href="../ref/monocamera.html"><span itemprop="name"><code class="object">monoCamera</code></span></a></span> | <span itemscope="" itemtype="http://www.mathworks.com/help/schema/MathWorksDocPage/SeeAlso" itemprop="seealso"><a itemprop="url" href="../../vision/ref/vision.deployablevideoplayer-system-object.html"><span itemprop="name"><code class="sysobj">vision.DeployableVideoPlayer</code></span></a></span></li>
</ul>
      <h2 id="d124e22526">Related Topics</h2>
<ul><li><a href="calibrate-a-monocular-camera.html" class="a">Calibrate a Monocular Camera</a></li>
<li><a href="coordinate-systems.html" class="a">Coordinate Systems in Automated Driving Toolbox</a></li>
<li><a href="visual-perception-using-monocular-camera.html" class="a">Visual Perception Using Monocular Camera</a></li>
</ul>
    </section>
    </div>
<div class="modal fade" id="open-example-dialog" tabindex="-1" role="dialog" aria-labelledby="openExampleDialogLabel" aria-hidden="true"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button><h2 class="h3 modal-title">Open Example</h2>
</div>
<div class="modal-body" id="dialog-body"><p>You have a modified version of this example. Do you want to open this example with your edits?</p>
</div>
<div class="modal-footer"><a id="open-example-dialog-replace" class="btn btn_color_blue companion_btn" data-dismiss="modal">No, open this example and discard my edits</a><a id="open-example-dialog-continue" class="btn btn_color_blue" data-dismiss="modal">Yes</a></div>
</div>
</div>
</div>
<div class="clearfix"></div>
<div align="center" class="feedbackblock" id="mw_docsurvey"><script src="https://www.mathworks.com/help/docsurvey/docfeedback.js"></script>
<script>loadSurveyHidden();</script>
<link rel="stylesheet" href="https://www.mathworks.com/help/docsurvey/release/index-css.css" type="text/css"/>
<script src="https://www.mathworks.com/help/docsurvey/release/bundle.index.js"></script>

<script>initDocSurvey();</script>
</div>
</section>


</div>
</div>
</div>
</div>
<!--close_0960--><footer xmlns="http://www.w3.org/1999/xhtml" id="footer" class="bs-footer">
<div class="container-fluid">
<div class="footer">
<div class="row">
<div class="col-xs-12">
<p class="copyright">© 1994-2022 The MathWorks, Inc.</p>
<ul class="footernav"><li class="footernav_help"><a href="matlab:web(matlab.internal.licenseAgreement)">Terms of Use</a></li>
<li class="footernav_patents"><a href="matlab:web([matlabroot '/patents.txt'])">Patents</a></li>
<li class="footernav_trademarks"><a href="matlab:web([matlabroot '/trademarks.txt'])">Trademarks</a></li>
<li class="footernav_piracy"><a href="matlab:web([docroot '/acknowledgments.html'])">Acknowledgments</a></li>
</ul>
</div>
</div>
</div>
</div>
</footer>
</div>
<!--close row-offcanvas--></div>
<!--close_0970-->
</body>
</html>
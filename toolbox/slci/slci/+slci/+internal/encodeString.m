

function OpStr=encodeString(str,mode,action)

    if isempty(str)

        OpStr=str;
        return;
    end

    if strcmpi(mode,'html')


        encodeTable=...
        {'&','&(?!#[0-9]+;)','&#38;';...
        '!','!','&#33;';...
        '"','"','&#34;';...
        '''','''','&#39;';...
        '$','$','&#36;';...
        '%','%','&#37;';...
        '<','<','&#60;';...
        '>','>','&#62;';...
        '|','|','&#166;'};

    elseif strcmpi(mode,'printf')


        encodeTable=...
        {'%','%','%%';...
        '\\','\\','\\\\'};

    elseif strcmpi(mode,'all')


        encodeTable=...
        {'&','&(?!#[0-9]+;)','&#38;';...
        '!','!','&#33;';...
        '"','"','&#34;';...
        '''','''','&#39;';...
        '$','$','&#36;';...
        '%','%','&#37;';...
        '<','<','&#60;';...
        '>','>','&#62;';...
        '|','|','&#166;';...
        '\\','\\','\\\\'};
    else
        assert(1,['Invalid mode: ',mode]);
    end

    switch action
    case 'encode'
        OpStr=regexprep(str,encodeTable(:,2),encodeTable(:,3));
    case 'decode'
        OpStr=regexprep(str,encodeTable(:,3),encodeTable(:,1));
    otherwise
        assert(1,['Invalid input argument: ',action]);
    end

end

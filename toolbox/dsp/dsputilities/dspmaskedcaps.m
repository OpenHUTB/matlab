function subsysCap=dspmaskedcaps(block)






    if~strcmpi(get_param(block,'Mask'),'on')
        DAStudio.error('Simulink:bcst:ErrOnlyMasks',mfilename);
    end

    maskType=get_param(block,'MaskType');


    [maskStr,trans]=getMaskStr(maskType,block);


    if strcmpi(get_param(block,'Mask'),'on')&&...
        strcmpi(get_param(block,'BlockType'),'SubSystem')&&...
        isSublibrary(block)
        maskStr='';
    end


    subsysCap=bcstCreateCap(maskType,maskStr,trans);


    function[subsysCapStr,trans]=getMaskStr(maskType,block)

        persistent maskTable transTable;
        if isempty(maskTable)
            [maskTable,transTable]=getMaskTable;
        end

        if isempty(maskType)||(strcmpi(get_param(block,'BlockType'),'SubSystem')&&isempty(get_param(block,'Blocks')))

            subsysCapStr='';
            trans=transTable;
        else

            findMask=find(strcmp(maskType,maskTable(:,2)));
            if~isempty(findMask)

                subsysCapStr=maskTable{findMask,1};
                trans=transTable;
            else
                DAStudio.error('Simulink:bcst:ErrMaskNotFound',maskType,mfilename);
            end
        end


        function[maskTable,transTable]=getMaskTable



            transTable.d='double';

            transTable.s='single';

            transTable.b='boolean';

            transTable.i='integer';
            transTable.is='integerSgn';
            transTable.iu='integerUns';
            transTable.depends.is='i';
            transTable.depends.iu='i';

            transTable.f='fixedpt';
            transTable.fs='fixedptSgn';
            transTable.fu='fixedptUns';
            transTable.depends.fs='f';
            transTable.depends.fu='f';

            transTable.e='enumerated';
            transTable.B='bus';

            transTable.c='codegen';
            transTable.p='production';

            transTable.m='multidimension';
            transTable.I='foreach';
            transTable.v='variablesize';
            transTable.S='symbolicdimension';
            transTable.t='string';
            transTable.z='zerocrossing';
            transTable.D='directfeedthrough';


































            maskTable={...
...
...
...
            'd;s;i;f;c;p;','Signal From Workspace';...
            'd;s;is;fs;c.dsp_FnRefSimTime;p;I;','Sine Wave';...
            'd;s;c;p;I;','Chirp';...
            'd;s;b;i;f;c;p;I;','Discrete Impulse ';...
            'd;b;c;p;I;','N-Sample Enable';...
            'd;s;b;c;p;I;','Multiphase Clock';...
            'd;s;b;i;f;c.FnReliesOnMemOp;p;I;','Identity Matrix';...
            'd;iu;c.dsp_FnHostPCOnly;p;','MIDI Controls';...
            'd;s;i.dsp_Fns16u8;c;p;','From Wave File';...
            'd;s;c.FnReliesOnMemOp;p;I;','Random Source';...
            'i;f;c.FnReliesOnMemOp;p;I;','NCO';...
            'd;s;c;p;I;','dsp.simulink.ColoredNoise';...
            'd;s;i;c;p;','dsp.simulink.BinaryFileReader';...
...
            'd;s;b;i;f;c-FnIgnoredCodeGen','Vector Scope';...
            'd;s;b;i;f;c-FnIgnoredCodeGen','Spectrum Analyzer';...
            'd;s;b;i;f;c-FnIgnoredCodeGen','Matrix Viewer';...
            'd;s;i;f;c-FnIgnoredCodeGen','Waterfall';...
            'd;s;b;i;f;e;c;p;','Signal To Workspace';...
            'd;s;b;i;f;e;c;p;','Triggered To Workspace';...
            'd;s;i.dsp_Fns16u8;fs.dsp_Fnsw16f15;c;p;','To Wave File';...
            'd;s;i.dsp_Fns3216u8;c.dsp_FnHostPCOnly;p;v;','Audio Device Writer';...
            'd;s;i;c;p;','dsp.simulink.BinaryFileWriter';...
...
            'd;s;c.FnReliesOnMemOp;p;I;','Digital Filter Design';...
            'd;c.FnConsiderMdlDiscr;I;','Analog Filter Design';...
            'd;s;i;f;c;p;I;','Filter Realization Wizard';...
            'd;s;is;fs;c.FnReliesOnMemOp;p;I;','Digital Filter';...
            'd;s;is;fs;c;p;I;v;','Biquad Filter';...
            'd;s;c;v;p;I;','dsp.simulink.AllpassFilter';...
            'd;s;c;v;p;I;','dsp.simulink.FrequencyDomainFIRFilter';...
            'd;s;c;v;p;I;','dsp.simulink.FourthOrderSectionFilter';...
...
            'd;s;is;fs;c.FnReliesOnMemOp;p;I;v;','LMS Filter';...
            'd;s;c.FnReliesOnMemOp;p;I;','Block LMS Filter';...
            'd;s;c.FnReliesOnMemOp;p;I;','Fast Block LMS Filter';...
            'd;s;c.FnReliesOnMemOp;p;I;','RLS filter';...
            'd;s;c;p;I;','Kalman Filter';...
            'd;s;c;p;I;','dsp.simulink.LMSUpdate';...
            'd;s;c;v;p;I;','dsp.simulink.FrequencyDomainAdaptiveFilter';...
...
            'd;s;i;f;c;v;p;I;','dsp.simulink.Differentiator';...
            'd;s;i;f;c;v;p;I;','dsp.simulink.LowpassFilter';...
            'd;s;i;f;c;v;p;I;','dsp.simulink.HighpassFilter';...
            'd;s;c;p;I;','Bandpass Filter';...
            'd;s;c;p;I;','Bandstop Filter';...
            'd;s;i;f;c;v;p;I;','dsp.simulink.FIRHalfbandDecimator';...
            'd;s;f;c;v;p;I;','dsp.simulink.FIRHalfbandInterpolator';...
            'd;s;c;v;p;I;','dsp.simulink.IIRHalfbandDecimator';...
            'd;s;c;v;p;I;','dsp.simulink.IIRHalfbandInterpolator';...
            'd;s;c;p;I;','Nyquist Filter';...
            'd;s;i;f;c;p;I;','dsp.simulink.CICCompensationDecimator';...
            'd;s;i;f;c;p;I;','dsp.simulink.CICCompensationInterpolator';...
            'd;s;c;p;I;','Inverse Sinc Filter';...
            'd;s;i;f;c;p;I;','CIC Filter';...
            'd;s;c;p;I;','Hilbert Filter';...
            'd;s;c;p;I;','Arbitrary Magnitude Filter';...
            'd;s;c;p;I;','Comb Filter';...
            'd;s;c;p;I;','Octave Filter';...
            'd;s;c;p;I;','Audio Weighting Filter';...
            'd;s;c;v;p;','dsp.simulink.VariableBandwidthFIRFilter';...
            'd;s;c;v;p;','dsp.simulink.VariableBandwidthIIRFilter';...
            'd;s;c;v;p;','dsp.simulink.NotchPeakFilter';...
            'd;s;c;v;p;','dsp.simulink.ParametricEQFilter';...
            'd;s;c;v;p;I;','dsp.simulink.MedianFilter';...
            'd;s;c;v;p;I;','dsp.simulink.HampelFilter';...
...
            'd;s;c.FnReliesOnMemOp;p;I;','Yule-Walker AR Estimator';...
            'd;s;c;p;I;','Burg AR Estimator';...
            'd;s;c.FnReliesOnMemOp;p;I;','Covariance AR Estimator';...
            'd;s;c.FnReliesOnMemOp;p;I;','Modified Covariance AR Estimator';...
...
            'd;s;c.FnReliesOnMemOp,dsp_FnFftwHostOnly;p;I;','Periodogram';...
            'd;s;i;f;c.FnReliesOnMemOp,dsp_FnFftwHostOnly;p;I;','Magnitude FFT';...
            'd;s;c;p;I;','Yule-Walker Method';...
            'd;s;c;p;I;','Burg Method';...
            'd;s;c;p;I;','Covariance Method';...
            'd;s;c;p;I;','Modified Covariance Method';...
            'd;s;c;p;I;','Discrete Transfer Function Estimator';...
            'd;s;c;p;','Cross-Spectrum Estimator';...
            'd;s;c;p;','Spectrum Estimator';...
...
            'd;s;c.FnReliesOnMemOp;p;I;','Autocorrelation LPC';...
            'd;s;c.FnReliesOnMemOp;p;I;','LPC to LSF/LSP Conversion';...
            'd;s;c;p;I;','LSF/LSP to LPC Conversion';...
            'd;s;is;fs;c.FnReliesOnMemOp;p;I;','Levinson-Durbin';...
            'd;s;c;p;I;','LPC/RC to Autocorrelation';...
            'd;s;c;p;I;','LPC to/from RC';...
            'd;s;c;p;I;','LPC to/from Cepstral Coefficients';...
...
            'd;s;i;f;c.dsp_FnFftwHostOnly;p;m;I;v.dsp_FnFftIfftVarSize;','FFT';...
            'd;s;i;f;c.FnReliesOnMemOp;p;m;I;','DCT';...
            'd;s;c.FnReliesOnMemOp;p;I;','DWT';...
            'd;s;c.FnReliesOnMemOp;p;I;','Complex Cepstrum';...
            'd;s;c.FnReliesOnMemOp;p;I;','Analytic Signal';...
            'd;s;is;fs;c.FnReliesOnMemOp;p;I;','Short-Time FFT';...
            'd;s;i;f;c.dsp_FnFftwHostOnly;p;m;I;v.dsp_FnFftIfftVarSize;','IFFT';...
            'd;s;i;f;c.FnReliesOnMemOp;p;m;I;','IDCT';...
            'd;s;c.FnReliesOnMemOp;p;I;','IDWT';...
            'd;s;c.FnReliesOnMemOp;p;I;','Real Cepstrum';...
            'd;s;i;f;c.FnReliesOnMemOp,dsp_FnFftwHostOnly;p;I;','Magnitude FFT';...
            'd;s;c.FnReliesOnMemOp;p;I;','Inverse Short-Time FFT';...
            'd;s;c;v;p;I;','dsp.simulink.ZoomFFT';...


...
            'd;s;i;f;c;p;I;v;','Minimum';...
            'd;s;i;f;c;p;I;v;','Maximum';...
            'd;s;c;v;p;i;I;','dsp.simulink.MovingMinimum';...
            'd;s;c;v;p;i;I;','dsp.simulink.MovingMaximum';...
            'd;s;c;v;p;I;','dsp.simulink.MovingAverage';...
            'd;s;c;v;p;I;','dsp.simulink.MovingRMS';...
            'd;s;c;v;p;I;','dsp.simulink.MovingVariance';...
            'd;s;c;v;p;I;','dsp.simulink.MovingStandardDeviation';...
            'd;s;i;f;c;p;I;v;','Mean';...
            'd;s;c;p;I;v;','Standard Deviation';...
            'd;s;i;f;c;p;I;v;','Variance';...
            'd;s;c;p;I;v;','RMS';...
            'd;s;c;p;I;v;','dsp.simulink.PowerMeter';...
            'd;s;i;f;c.FnReliesOnMemOp;p;I;','Autocorrelation';...
            'd;s;i;f;c;p;I;','Correlation';...
            'd;s;c.FnReliesOnMemOp;p;I;','Detrend';...
            'd;s;i;f;c.FnReliesOnMemOp;p;I;','Histogram';...
            'd;s;i;f;c.FnReliesOnMemOp;p;v;I;','Median';...
            'd;s;i;f;c.FnReliesOnMemOp;p;I;','Sort';...
...
            'd;s;c;p;I;','Uniform Encoder';...
            'i;c;p;I;','Uniform Decoder';...
            'is.dsp_Fns16;c;p;I;','G.711 Codec';...
            'd;s;is;fs;c;p;I;','Scalar Quantizer Encoder';...
            'i;f;c;p;I;','Scalar Quantizer Decoder';...
            'd;c;p;','Scalar Quantizer Design';...
            'd;s;is;fs;c.FnReliesOnMemOp;p;I;','Vector Quantizer Encoder';...
            'i;f;c.FnReliesOnMemOp;p;I;','Vector Quantizer Decoder';...
            'd;c;p;','Vector Quantizer Design';...
...
            'd;s;b;v;i;f;c.FnReliesOnMemOp;p;I;','Upsample';...
            'd;s;b;v;i;f;c.FnReliesOnMemOp;p;I;','Repeat';...
            'd;s;b;i;f;c.FnReliesOnMemOp;p;I;','Pad';...
            'd;s;b;i;f;c.FnReliesOnMemOp;p;I;','Delay';...
            'd;s;b;i;f;c;p;I;','Variable Integer Delay';...
            'd;s;i;f;c;p;I;v;','Variable Fractional Delay';...
            'd;s;is;fs;c;p;v.dsp_FnVarSzExceptCICMode;','dsp.simulink.DCBlocker';...
            'd;s;is;fs;c.FnReliesOnMemOp;p;v;I;','Window Function';...
            'd;s;c;p;I;','Interpolation';...
            'd;s;i;f;c;p;I;','Convolution';...
            'd;s;c.FnReliesOnMemOp;p;I;','Unwrap';...
            'i;f;c.FnReliesOnMemOp;p;I;','NCO';...
            'd;s;i;f;c.FnReliesOnMemOp;p;I;','Peak Finder';...
            'd;s;is;fs;c.FnReliesOnMemOp;p;I;','Offset';...
            'd;s;i;f;c;p;I;','Zero Crossing';...
            'd;s;i;f;c;p;','Triggered Signal From Workspace';...
            'd;s;b;i;f;c;p;I;','Sample and Hold';...
            'd;s;i;f;c.FnReliesOnMemOp;p;I;','Constant Ramp';...
            'd;s;c;v;p;I;','dsp.simulink.PhaseExtractor';...
            'd;s;c;p;I;is;fs','dsp.simulink.DigitalDownConverter';...
            'd;s;c;p;I;is;fs','dsp.simulink.DigitalUpConverter';...
...
            'd;s;c;p;I;','dB Conversion';...
            'd;s;i;f;c;p;I;','dB Gain';...
            'd;s;i;f;c.FnReliesOnMemOp;p;I;','Cumulative Sum';...
            'd;s;i;f;c.FnReliesOnMemOp;p;I;','Cumulative Product';...
            'd;s;i;f;c;p;v;I;','Difference';...
            'd;s;i;f;c;p;I;v;','Normalization';...
...
            'd;s;i;f;c;p;I;','Matrix Square';...
            'd;s;b;i;f;c;p;I;','Toeplitz';...
            'd;s;b;i;f;e;c.FnReliesOnMemOp;p;I;','Submatrix';...
            'd;s;b;i;f;c.FnReliesOnMemOp;p;I;','Overwrite Values';...
            'd;s;i;f;c.FnReliesOnMemOp;p;v;I;','Matrix Sum';...
            'd;s;i;f;c.FnReliesOnMemOp;p;v;I;','Matrix Product';...
            'd;s;i;f;c;p;I;','Matrix 1-Norm';...
            'd;s;c.FnReliesOnMemOp;p;I;','Reciprocal Condition';...
            'd;s;c.FnReliesOnMemOp;p;I;','Matrix Exponential';...
            'd;s;b;i;f;e;c.FnReliesOnMemOp;p;I;','Permute Matrix';...
            'd;s;b;i;f;c.FnReliesOnMemOp;p;I;','dsp.simulink.ExtractTriangularMatrix';...
            'd;s;b;i;f;c.FnReliesOnMemOp;p;I;','Extract Diagonal';...
            'd;s;b;i;f;c.FnReliesOnMemOp;p;I;','Create Diagonal Matrix';...
            'd;s;b;i;f;c.FnReliesOnMemOp;p;I;','Identity Matrix';...
            'd;s;is;fs;c;p;I;v;','Array-Vector Multiply';...
            'd;s;is;fs;c;p;I;v;','Array-Vector Divide';...
            'd;s;is;fs;c;p;I;v;','Array-Vector Add';...
            'd;s;is;fs;c;p;I;v;','Array-Vector Subtract';...

...
            'd;s;is;fs;c.FnReliesOnMemOp;p;I;','Backward Substitution';...
            'd;s;c.FnReliesOnMemOp;p;I;','Cholesky Solver';...
            'd;s;is;fs;c.FnReliesOnMemOp;p;I;','Forward Substitution';...
            'd;s;c.FnReliesOnMemOp;p;I;','LDL Solver';...
            'd;s;c.FnReliesOnMemOp;p;I;','LU Solver';...
            'd;s;is;fs;c.FnReliesOnMemOp;p;I;','Levinson-Durbin';...
            'd;s;c.FnReliesOnMemOp;p;I;','dsp.simulink.QRSolver';...
            'd;s;c.FnReliesOnMemOp;p;I;','SVD Solver';...
...
            'd;s;c.FnReliesOnMemOp;p;I;','Cholesky Factorization';...
            'd;s;is;fs;c.FnReliesOnMemOp;p;I;','LDL Factorization';...
            'd;s;is;fs;c.FnReliesOnMemOp;p;I;','LU Factorization';...
            'd;s;c.FnReliesOnMemOp;p;I;','dsp.simulink.QRFactorization';...
            'd;s;c;p;I;','Singular Value Decomposition';...
...
            'd;s;c.FnReliesOnMemOp;p;I;','LU Inverse';...
            'd;s;c.FnReliesOnMemOp;p;I;','Cholesky Inverse';...
            'd;s;c.FnReliesOnMemOp;p;I;','LDL Inverse';...
            'd;s;c.FnReliesOnMemOp;p;I;v;','Pseudoinverse';...
...
            'd;s;c.FnReliesOnMemOp;p;I;','Least Squares Polynomial Fit';...
            'd;s;c;p;I;','Polynomial Evaluation';...
            'd;s;c.FnReliesOnMemOp;p;I;','dsp.simulink.PolynomialStabilityTest';...
...
            'd;s;b;i;c;p;I;','Counter';...
            'd;s;b;i;f;c.FnReliesOnMemOp;p;I;','Edge Detector';...
            'd;s;b;i;f;e;c.FnReliesOnMemOp;p;I;','Event-Count Comparator';...
            'd;s;b;c;p;I;','Multiphase Clock';...
            'd;b;c;p;I;','N-Sample Enable';...
            'd;s;b;i;f;c;p;I;','N-Sample Switch';...
...
            'd;s;b;i;f;c.FnReliesOnMemOp;p;I;','Buffer';...
            'd;s;b;i;f;c.FnReliesOnMemOp;p;I;','Delay Line';...
            'd;s;b;i;f;c.FnReliesOnMemOp,dsp_FnSystemTargetGRT;p;I;','Queue';...
            'd;s;b;i;f;c.FnReliesOnMemOp,dsp_FnSystemTargetGRT;p;I;','Stack';...
            'd;s;b;i;f;c.FnReliesOnMemOp;p;I;','Unbuffer';...
...
            'd;s;b;i;f;e;c.FnReliesOnMemOp;p;I;','Multiport Selector';...
            'd;s;b;i;f;c.FnReliesOnMemOp;p;I;','Overwrite Values';...
            'd;s;b;i;f;c.FnReliesOnMemOp;p;I;','Submatrix';...
            'd;s;b;i;f;e;c.FnReliesOnMemOp;p;I;','Variable Selector';...
...
            'd;s;b;i;f;e;c;p;v;I;','Check Signal Attributes';...
            'd;s;b;i;f;c;p;I;','Convert 1-D to 2-D';...
            'd;s;b;i;f;e;c;p;I;','Convert 2-D to 1-D';...
            'd;s;b;i;f;c.FnReliesOnMemOp;p;v;I;','Inherit Complexity';...
...
            'is;fs;c.FnReliesOnMemOp;p;I;','CIC Decimation';...
            'is;fs;c.FnReliesOnMemOp;p;I;','CIC Interpolation';...
            'd;s;c.FnReliesOnMemOp;p;I;','Dyadic Analysis Filter Bank';...
            'd;s;c.FnReliesOnMemOp;p;I;','Dyadic Synthesis Filter Bank';...
            'd;s;i;f;c.FnReliesOnMemOp;p;I;v;','FIR Decimation';...
            'd;s;i;f;c.FnReliesOnMemOp;p;I;v;','FIR Interpolation';...
            'd;s;i;f;c.FnReliesOnMemOp;p;I;','FIR Rate Conversion';...
            'd;s;is;fs;c.FnReliesOnMemOp;p;I;','Two-Channel Analysis Subband Filter';...
            'd;s;is;fs;c.FnReliesOnMemOp;p;I;','Two-Channel Synthesis Subband Filter';...
            'd;s;c;p;I;v;','dsp.simulink.Channelizer';...
            'd;s;c;p;I;v;','dsp.simulink.ChannelSynthesizer';...
            'd;s;c;v;p;I;','dsp.simulink.ComplexBandpassDecimator';...
            'd;s;c;p;I;','dsp.simulink.SampleRateConverter';...
            'd;s;is;v;fs;c;p;I;','dsp.simulink.FarrowRateConverter';...
...
            'd;s;c;p;I;','waveletscattering';...
            };


            function isSubLib=isSublibrary(block)

                cnln=newline;
                sublibs={...
                'dsplibv4/Demos',...
                'dsplibv4/Estimation',...
                'dsplibv4/Filtering',...
                'dsplibv4/Info',...
                ['dsplibv4/Math',cnln,'Functions'],...
                'dsplibv4/Quantizers',...
                ['dsplibv4/Signal',cnln,'Management'],...
                ['dsplibv4/Signal',cnln,'Operations'],...
                ['dsplibv4/Signal',cnln,'Processing',cnln,'Sinks'],...
                ['dsplibv4/Signal',cnln,'Processing',cnln,'Sources'],...
                'dsplibv4/Statistics',...
                'dsplibv4/Transforms',...
                };

                nameSp=[get_param(block,'Parent'),'/',get_param(block,'Name')];

                isSubLib=any(strcmp(nameSp,sublibs));

function dlgStruct=getDialogSchema(this,name)




    if~builtin('license','checkout','SIMULINK_Report_Gen')
        dlgStruct=this.buildErrorMessage(name,true);
        return;

    end
    isCapture=strcmp(this.Format,'png-capture');

    isPaperSizeable=~this.isPrintFrame&&...
    ~isCapture&&...
    ~strcmp(this.PaperExtentMode,'auto');

    [wFormat,tFormat]=this.dlgWidget('Format',...
    'ColSpan',[2,4],...
    'RowSpan',[1,1],...
    'DialogRefresh',1);
    tFormat.ColSpan=[1,1];

    allFormat=rptgen.getImgFormat('ALLSL');



    if ispc&&~rptgen.isWordOutput(this)
        idx=~cellfun('isempty',strfind(allFormat(:,1),'wmf'));
        formatDesc=allFormat{idx,2};
        idx=~cellfun(@(x)strcmp(x,formatDesc),wFormat.Entries);
        wFormat.Entries=wFormat.Entries(idx);
        wFormat.Values=wFormat.Values(idx);
    end


    if rptgen.use_java
        imgInfo=char(rptgen.getImgFormat('AUTOSL',this));
    else
        imgInfo=rptgen.getImgFormat('AUTOSL',this);
        imgInfo=char(imgInfo.Name);
    end
    idx=~cellfun('isempty',strfind(allFormat(:,1),'AUTOSL'));
    formatDesc=allFormat{idx,2};
    formatDescReplace=[formatDesc,' (',imgInfo,')'];

    idx=cellfun(@(x)strcmp(x,formatDesc),wFormat.Entries);
    wFormat.Entries{idx}=formatDescReplace;



    [wPaperOrientation,tPaperOrientation]=this.dlgWidget('PaperOrientation',...
    'ColSpan',[2,4],...
    'RowSpan',[2,2],...
    'Enabled',~isCapture);
    tPaperOrientation.ColSpan=[1,1];

    paperZoomEnabled=strcmp(this.PaperExtentMode,'zoom');

    dlgStruct=this.dlgMain(name,{

    this.dlgContainer({
tFormat
wFormat
tPaperOrientation
wPaperOrientation
    this.dlgText('','RowSpan',[3,3],'ColSpan',[1,2],'MinimumSize',[1,10])
    gr_buildScalingContainer(this,[1,4],[4,4],true,...
    struct('Name','ScalingMode','MemberName','PaperExtentMode'),...
    struct('Name','Size','MemberName','PaperExtent',...
    'Enabled',isPaperSizeable&&~paperZoomEnabled),...
    struct('Name','Units','MemberName','PrintUnits',...
    'Enabled',isPaperSizeable),...
    struct('Name','Zoom','MemberName','PaperZoom',...
    'Enabled',isPaperSizeable&&paperZoomEnabled),...
    struct('Name','MaxSize','MemberName','MaxPaperExtent',...
    'Enabled',isPaperSizeable&&paperZoomEnabled))
    },getString(message('RptgenSL:rsl_csl_sys_snap:snapshot')),...
    'RowSpan',[1,1],...
    'ColSpan',[1,1],...
    'LayoutGrid',[4,4],...
    'ColStretch',[0,0,1,0])

    loc_buildPropertiesContainer(this,[1,1],[2,2],~isCapture)
    loc_buildAdvancedButton(this,[1,1],[3,3])
    gr_buildDisplayOptions(this,struct(...
    'none',getString(message('RptgenSL:rsl_csl_sys_snap:noTitleLbl')),...
    'sysname',getString(message('RptgenSL:rsl_csl_sys_snap:xlate_systemname')),...
    'fullname',getString(message('RptgenSL:rsl_csl_sys_snap:model_sys_sysnameLbl')),...
    'manual','-Title'),...
    struct(...
    'none',getString(message('RptgenSL:rsl_csl_sys_snap:noCaptionLbl')),...
    'auto',getString(message('RptgenSL:rsl_csl_sys_snap:fromSystemDescriptionLbl')),...
    'manual','-Caption'),...
    'ColSpan',[1,1],...
    'RowSpan',[4,4],...
    'Visible',this.isAdvancedVisible)
    },'LayoutGrid',[5,1],'RowStretch',[0,0,0,0,1]);

end




function button=loc_buildAdvancedButton(this,colSpan,rowSpan)

    if this.isAdvancedVisible
        label=getString(message('RptgenSL:rsl_csl_sys_snap:advancedLeftLbl'));
    else
        label=getString(message('RptgenSL:rsl_csl_sys_snap:advancedRightLbl'));
    end;

    button=struct('Type','pushbutton',...
    'Enabled',true,...
    'Name',label,...
    'ObjectMethod','toggleAdvanced',...
    'ToolTip',getString(message('RptgenSL:rsl_csl_sys_snap:toggleAdvanced')),...
    'DialogRefresh',true,...
    'ColSpan',colSpan,...
    'RowSpan',rowSpan,...
    'MaximumSize',[100,100]);
end



function container=loc_buildPropertiesContainer(this,colSpan,rowSpan,enablePrintFrame)
    container=this.dlgContainer({
    this.dlgWidget('UseCallouts',...
    'ColSpan',[1,4],...
    'RowSpan',[1,1])
    this.dlgWidget('isPrintFrame',...
    'DialogRefresh',1,...
    'Enabled',enablePrintFrame,...
    'ColSpan',[1,2],...
    'RowSpan',[2,2])
    this.dlgWidget('PrintFrameName',...
    'Enabled',this.isPrintFrame&&enablePrintFrame,...
    'ColSpan',[3,3],...
    'RowSpan',[2,2])
    this.dlgFileBrowse('PrintFrameName','*.fig',...
    'Enabled',this.isPrintFrame&&enablePrintFrame,...
    'ColSpan',[4,4],...
    'RowSpan',[2,2])
    },...
    getString(message('RptgenSL:rsl_csl_sys_snap:propertiesLbl')),...
    'LayoutGrid',[2,4],...
    'RowStretch',[0,1],...
    'RowSpan',rowSpan,...
    'ColSpan',colSpan);
end

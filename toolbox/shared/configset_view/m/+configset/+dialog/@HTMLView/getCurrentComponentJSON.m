function[json,layoutFeatures]=getCurrentComponentJSON(obj,cc,pid,lazy)





    layoutFeatures=[];
    params=locGetJSONForParams(cc);
    if isempty(params)
        json='';
        return;
    end

    [data,layoutFeatures]=locAddMetaData(obj,cc,pid,lazy,params);


    if cc.isValidParam('CurrentDlgPage')
        data.initPage=cc.CurrentDlgPage;
    end

    json=jsonencode(data);

end



function[data,layoutFeatures]=locAddMetaData(obj,cc,pid,lazy,params)

    layoutFeatures=[];
    cid=obj.getCID(cc);
    componentPath=configset.internal.data.MetaConfigSet.registerComponent(cid);

    data=[];
    data.cid=cid;
    data.pid=pid;

    if isempty(componentPath)

        separateBuild=false;
        data.path=configset.internal.data.MetaConfigSet.DerivedDataPath;
    else




        separateBuild=true;

        data.path=['/',strrep(componentPath,filesep,'/')];
    end

    if separateBuild
        str=['configset.htmlview.custom_functions.get_',strrep(cid,'.','_'),'_ComponentData'];
        t=which(str);
        if isempty(t)
            compData=[];
        else
            fn=str2func(str);
            compData=fn(cc.getConfigSet);
        end
    elseif isobject(cc)

        compData.feature=[];
        compData.license=[];
        compData.status=0;
    else
        compData=configset.htmlview.custom_functions.getComponentData(cc,cid);
    end

    if~isempty(compData)
        className=cid;
        targetUnknown=false;
    elseif isa(cc,'Simulink.TargetCC')
        className='Simulink.TargetCC';
        compData=configset.htmlview.custom_functions.getComponentData(cc,className);
        targetUnknown=true;
    else
        data=obj.getAutoGeneratedData(cc,pid);


        return;
    end

    data.targetUnknown=targetUnknown;




    if(~obj.uptMode&&lazy)||isa(cc,'Simulink.SolverCC')
        str=['configset.htmlview.custom_functions.get_',strrep(className,'.','_'),'_data'];
        t=which(str);
        if~isempty(t)
            fn=str2func(str);
            [ps,gs]=fn(cc.getConfigSet);
            data.custom={ps,gs};
        end
    end


    if~isempty(compData)
        data.feature=compData.feature;
        data.license=compData.license;
        data.status=compData.status;
        if isfield(compData,'layout')



            layoutFeatures=compData.layout;
        end
    end

    data.params=params;

end

function params=locGetJSONForParams(cc)


    warns={'RTW:configSet:migratedToCoderDictionary';
    'Simulink:ConfigSet:ObsoleteParam';
    'Simulink:ConfigSet:SimModeMovedToMdlInvalidGet';
    'Simulink:ConfigSet:ParameterMigrationWarningGet'};
    wState=[warning;cellfun(@(x)warning('query',x),warns)];
    cellfun(@(x)warning('off',x),warns);
    wCleanup=onCleanup(@()warning(wState));

    params=cc.getAllParamValueStatusForDialog;
end



function onBrowseFMU(~,dlg,fmuEditTag)


    try

        defaultFile=get_param(gcb,'FMULoadedFullPathName');
        if exist(defaultFile,'file')~=2
            defaultFile='';
        end


        if isempty(defaultFile)
            prevInput=dlg.getWidgetValue(fmuEditTag);
            [prevPath,prevName,prevExt]=fileparts(prevInput);
            if isempty(prevExt)&&~isempty(prevName)
                prevInput=[prevInput,'.fmu'];
            end
            defaultFile=which(prevInput);
        end
    catch
    end

    [fileName,pathName]=uigetfile({'*.fmu',...
    DAStudio.message('FMUBlock:FMU:FMUFiles')},...
    DAStudio.message('FMUBlock:FMU:SelectFMUFile'),...
    defaultFile);


    if(fileName==0)
        return;
    end

    fullFileName=fullfile(pathName,fileName);

    if slfeature('FMUBlockFullFilePathSupport')==0


        [fmuPath,fmuName,fmuExt]=fileparts(fullFileName);
        fmuName=[fmuName,fmuExt];
        if isempty(which(fmuName))
            if~openOffPathDialog(pathName,fileName)
                return;
            end
        end


        if~strcmp(which(fullFileName),which(fmuName))
            error(message('FMUBlock:FMU:FMUBlockDialogSelectedFilePrecedence',fullFileName));
        end

        dlg.setWidgetValue(fmuEditTag,fmuName);

    else








        if ispc
            pathList=[{pwd},strsplit(path,';')];
        else
            pathList=[{pwd},strsplit(path,':')];
        end;
        relPath='';
        for i=1:length(pathList)
            if(any(strfind(fullFileName,[pathList{i},filesep])==1))
                relPath=fullFileName(length([pathList{i},filesep])+1:end);

                for j=1:i-1
                    if(exist([pathList{j},filesep,relPath])==2)
                        relPath='';
                        break;
                    end
                end;
                break
            end
        end


        if isempty(relPath)
            dlg.setWidgetValue(fmuEditTag,fullFileName);
        else
            dlg.setWidgetValue(fmuEditTag,relPath);
        end

    end

end

function isSuccess=openOffPathDialog(pathName,fileName)



    isSuccess=false;

    questDlgMsg=message('FMUBlock:FMU:FMUBlockDialogSelectedFileNotOnPathQString',...
    fullfile(pathName,fileName)).getString;
    questDlgTitle=message('FMUBlock:FMU:FMUBlockDialogPathDialogTitle').getString;
    addPathMsg=message('FMUBlock:FMU:FMUBlockDialogBrowseAddPathLabel').getString;
    cancelMsg=message('FMUBlock:FMU:FMUBlockDialogBrowseCancelLabel').getString;

    choice=questdlg(questDlgMsg,questDlgTitle,addPathMsg,cancelMsg,cancelMsg);

    if strcmp(choice,addPathMsg)
        addpath(pathName);
        isSuccess=true;
    end
end

function result=OpenDialogForSLXPReplacement(targetSLXPName)
    strResult=questdlg(['This FMU is generated by Simulink and the corresponding Simulink protected model ''',targetSLXPName,''' is found in this FMU. Do you want to replace FMU block with Model block to load protected model instead? Simulink will extract .slxp file into current working directory.'],...
    'Replace FMU with Simulink Protected Model',...
    'Yes, replace FMU With SLXP','No',...
    'Yes, replace FMU With SLXP');
    if strcmp(strResult,'No')
        result=false;
    else
        result=true;
    end
end

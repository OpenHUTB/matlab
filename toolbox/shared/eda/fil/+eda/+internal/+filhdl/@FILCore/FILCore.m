

classdef(ConstructOnLoad)FILCore<eda.internal.component.MWCore


    properties
clk
reset
txclk_en
rxclk_en

buildInfo
commprops
    end

    methods
        function this=FILCore(BuildInfo)
            this.buildInfo=BuildInfo;
            this.clk=eda.internal.component.ClockPort;
            this.reset=eda.internal.component.ResetPort;
            this.txclk_en=eda.internal.component.Inport('FiType','boolean');
            this.rxclk_en=eda.internal.component.Inport('FiType','boolean');
            this.flatten=false;

            if strcmpi(this.buildInfo.BoardObj.Component.Communication_Channel,'Altera JTAG')
                this.commprops={'CLK125'};
                for m=1:numel(this.commprops)
                    addprop(this,this.commprops{m});
                end
                this.CLK125=eda.internal.component.ClockPort;
            else
                this.commprops={'gmii_rx_clk',...
                'gmii_rxd',...
                'gmii_rx_dv',...
                'gmii_rx_er',...
                'gmii_tx_clk',...
                'gmii_txd',...
                'gmii_tx_en',...
                'gmii_tx_er',...
                'gmii_col',...
                'gmii_crs'};
                for m=1:numel(this.commprops)
                    addprop(this,this.commprops{m});
                end
                this.gmii_rx_clk=eda.internal.component.ClockPort;
                this.gmii_rxd=eda.internal.component.Inport('FiType','std8');
                this.gmii_rx_dv=eda.internal.component.Inport('FiType','boolean');
                this.gmii_rx_er=eda.internal.component.Inport('FiType','boolean');
                this.gmii_tx_clk=eda.internal.component.ClockPort;
                this.gmii_txd=eda.internal.component.Outport('FiType','std8');
                this.gmii_tx_en=eda.internal.component.Outport('FiType','boolean');
                this.gmii_tx_er=eda.internal.component.Outport('FiType','boolean');
                this.gmii_col=eda.internal.component.Inport('FiType','boolean');
                this.gmii_crs=eda.internal.component.Inport('FiType','boolean');
            end
        end

        function implement(this)
            dut_rst=this.signal('Name','dut_rst','FiType','boolean');
            dut_din=this.signal('Name','dut_din','FiType','std8');
            dut_dinvld=this.signal('Name','dut_dinvld','FiType','boolean');
            dut_dinrdy=this.signal('Name','dut_dinrdy','FiType','boolean');
            simcycle=this.signal('Name','simcycle','FiType','std16');
            dut_dout=this.signal('Name','dut_dout','FiType','std8');
            dut_doutvld=this.signal('Name','dut_doutvld','FiType','boolean');
            dut_doutrdy=this.signal('Name','dut_doutrdy','FiType','boolean');

            commpvpair=cell(1,2*numel(this.commprops));
            for m=1:numel(this.commprops)
                commpvpair{m*2-1}=this.commprops{m};
                commpvpair{m*2}=this.(this.commprops{m});
            end

            this.component(...
            'Name','FILCommLayer',...
            'Component',eda.internal.filhdl.FILCommLayer(this.buildInfo),...
            'clk',this.clk,...
            'reset',this.reset,...
            'txclk_en',this.txclk_en,...
            'rxclk_en',this.rxclk_en,...
            commpvpair{:},...
            'dut_rst',dut_rst,...
            'dut_din',dut_din,...
            'dut_dinvld',dut_dinvld,...
            'dut_dinrdy',dut_dinrdy,...
            'simcycle',simcycle,...
            'dut_dout',dut_dout,...
            'dut_doutvld',dut_doutvld,...
            'dut_doutrdy',dut_doutrdy);

            this.component(...
            'Name','mwfil_chiftop',...
            'Component',eda.internal.filhdl.mwfil_chiftop(this.buildInfo,8),...
            'clk',this.clk,...
            'reset',dut_rst,...
            'din',dut_din,...
            'din_valid',dut_dinvld,...
            'din_ready',dut_dinrdy,...
            'simcycle',simcycle,...
            'dout',dut_dout,...
            'dout_valid',dut_doutvld,...
            'dout_ready',dut_doutrdy);
        end
    end
end
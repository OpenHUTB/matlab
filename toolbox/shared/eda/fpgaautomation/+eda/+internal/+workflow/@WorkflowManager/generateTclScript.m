function status=generateTclScript(h)




    status=0;

    fpgaObj=h.mAutoInterfaceObj;
    hdlcData=h.mWorkflowInfo.hdlcData;
    userParam=h.mWorkflowInfo.userParam;
    tdkParam=h.mWorkflowInfo.tdkParam;

    h.makeHdlDir;
    tclFile=fullfile(hdlcData.codegenDir,...
    [hdlcData.dutName,tdkParam.tclScriptName]);

    msg=['Generating Project Tcl Script ',hdlgetfilelink(tclFile)];
    hdldisp(msg);



    cm='#';
    nl=char(10);

    matlabVersion=getVersionInfo;
    createdate=datestr(now,31);
    fileName=strrep(tclFile,'\','\\');

    if strcmpi(userParam.tclOption,'Create new project')
        helpTxt=getHelpTxt_new(cm);
    else
        helpTxt=getHelpTxt_add(cm);
    end

    headertxt=...
    [repmat(cm,1,60),nl...
    ,cm,nl...
    ,cm,blanks(5),'File Name: ',fileName,nl...
    ,cm,blanks(5),'Created: ',createdate,nl...
    ,cm,nl...
    ,cm,blanks(5),matlabVersion,nl...
    ,cm,nl...
    ,repmat(cm,1,60),nl,nl...
    ,helpTxt,nl...
    ];

    shead=sprintf(headertxt);





    [~,tclStr]=fpgaObj.newProject(userParam.projectName,...
    userParam.projectLoc,userParam.projectTarget);
    tclStr_newProj=[cm,' Create new project',nl,tclStr,nl];


    genFiles=hdlcData.hdlFiles;
    if~isempty(tdkParam.tdkFiles)
        genFiles=[genFiles,tdkParam.tdkFiles];
    end
    [~,tclStr]=fpgaObj.addFiles(genFiles);
    tclStr_addGenFile=[cm,' Add generated source files',nl,tclStr,nl];




    tclStr_addUserFile='';
    if~isempty(userParam.projectUserFiles)
        f=getUserFilePath(userParam.projectUserFiles);
        [~,tclStr]=fpgaObj.addFiles(f);
        tclStr_addUserFile=[cm,' Add user source files',nl,tclStr,nl];
    end


    tclStr_setProp='';
    if~isempty(userParam.projectProperties)
        [~,tclStr]=fpgaObj.setProp(userParam.projectProperties);
        tclStr_setProp=[cm,' Set process properties',nl,tclStr,nl];
    end


    [~,tclStr]=fpgaObj.openProject('<project_name>.xise');
    tclStr_openProjCmt=[cm,' Open project',nl,cm,' ',tclStr,nl];


    [~,tclStr]=fpgaObj.closeProject;
    tclStr_closeProj=[cm,' Close project',nl,tclStr,nl];
    tclStr_closeProjCmt=[cm,' Close project',nl,cm,' ',tclStr,nl];


    tclStr='';
    [~,cmd]=fpgaObj.runProcess('compile');
    tclStr=[tclStr,cm,' ',cmd];
    [~,cmd]=fpgaObj.runProcess('synthesize');
    tclStr=[tclStr,cm,' ',cmd];
    [~,cmd]=fpgaObj.runProcess('translate');
    tclStr=[tclStr,cm,' ',cmd];
    [~,cmd]=fpgaObj.runProcess('map');
    tclStr=[tclStr,cm,' ',cmd];
    [~,cmd]=fpgaObj.runProcess('par');
    tclStr=[tclStr,cm,' ',cmd];
    [~,cmd]=fpgaObj.runProcess('implement');
    tclStr=[tclStr,cm,' ',cmd];
    [~,cmd]=fpgaObj.runProcess('generatebit');
    tclStr=[tclStr,cm,' ',cmd];
    tclStr_runProcessCmt=[cm,' Run processes',nl,tclStr,nl];


    if strcmpi(userParam.tclOption,'Create new project')
        tclStr=[tclStr_newProj,tclStr_addGenFile,tclStr_addUserFile...
        ,tclStr_setProp,tclStr_runProcessCmt,tclStr_closeProj];
    else
        tclStr=[tclStr_openProjCmt,tclStr_addGenFile,tclStr_closeProjCmt];
    end


    tclErrMsg='Tcl script generation failed.';
    internalUse=false;
    h.writeTclScript(tclFile,[shead,tclStr],tclErrMsg,internalUse);



    function str=getVersionInfo
        mver=ver('matlab');



        str=['Generated by ',mver.Name,' ',mver.Version];

        function str=getHelpTxt_new(cm)
            nl=char(10);
            tclHelp=getTclHelpTxt(cm);

            str=[...
            cm,' To create a new ISE project using this script:',nl...
            ,cm,'   - Create a project folder.',nl...
            ,cm,'   - Copy this script and the necessary generated source',nl...
            ,cm,'     files to the project folder.',nl...
            ,cm,'   - Execute this script in a Xilinx Tcl shell.',nl...
            ,nl,tclHelp,nl...
            ,cm,' To run ISE processes after creating a project, uncomment',nl...
            ,cm,' the appropriate lines in the "Run processes" section.',nl...
            ];

            function str=getHelpTxt_add(cm)
                nl=char(10);
                tclHelp=getTclHelpTxt(cm);

                str=[...
                cm,' To add generated files to an existing ISE project using',nl...
                ,cm,' this script:',nl...
                ,cm,'   - Copy this script and the necessary generated source',nl...
                ,cm,'     files to the project folder.',nl...
                ,cm,'   - Open the project.',nl...
                ,cm,'   - Execute this script in a Xilinx Tcl shell.',nl...
                ,nl,tclHelp,nl...
                ,cm,' To open and close project with the same script, uncomment',nl...
                ,cm,' the appropriate lines for the open/close command.',nl...
                ];

                function str=getTclHelpTxt(cm)
                    nl=char(10);

                    str=[...
                    cm,' To access the Xilinx Tcl shell:',nl...
                    ,cm,'   From the command prompt, type xtclsh.',nl...
                    ,cm,'   From ISE Project Navigator, select View > Panels > Tcl',nl...
                    ,cm,'   Console.',nl...
                    ];

                    function filepath=getUserFilePath(filelist)
                        for n=1:length(filelist)

                            filepath{n}=strrep(filelist{n},'\','/');
                        end


function figOut=pattern3DSettings(obj,toolStrip,figHandle,arr,w,...
    propSpeed,steerAng,subarraySteerAng)





    figHandle.Name=...
    getString(message('phased:apps:arrayapp:array3D'));
    figHandle.Tag='pattern3DFig';
    figHandle.HandleVisibility='on';


    set(groot,'CurrentFigure',figHandle);

    drawnow();


    if strcmp(toolStrip.CoordDropDown3D.Value,...
        getString(message('phased:apps:arrayapp:coordPolar')))
        coord='polar';
    elseif strcmp(toolStrip.CoordDropDown3D.Value,...
        getString(message('phased:apps:arrayapp:coordLine')))
        coord='rectangular';
    elseif strcmp(toolStrip.CoordDropDown3D.Value,...
        getString(message('phased:apps:arrayapp:coordUV')))
        coord='uv';
    end

    if strcmp(toolStrip.TypeDropDown.Value,...
        getString(message('phased:apps:arrayapp:Directivity')))
        type='Directivity';
    elseif strcmp(toolStrip.TypeDropDown.Value,...
        getString(message('phased:apps:arrayapp:efield')))
        type='efield';
    elseif strcmp(toolStrip.TypeDropDown.Value,...
        getString(message('phased:apps:arrayapp:Power')))
        type='power';
    elseif strcmp(toolStrip.TypeDropDown.Value,...
        getString(message('phased:apps:arrayapp:PowerdB')))
        type='powerdB';
    end

    if strcmp(toolStrip.PolarizationDropDown.Value,...
        getString(message('phased:apps:arrayapp:Combined')))
        polarization='Combined';
    elseif strcmp(toolStrip.PolarizationDropDown.Value,...
        getString(message('phased:apps:arrayapp:H')))
        polarization='H';
    elseif strcmp(toolStrip.PolarizationDropDown.Value,...
        getString(message('phased:apps:arrayapp:V')))
        polarization='V';
    end

    if~strcmp(toolStrip.TypeDropDown.Value,getString(message('phased:apps:arrayapp:Directivity')))...
        &&isPolarizationCapable(toolStrip.AppHandle.CurrentElement)
        toolStrip.PolarizationDropDown.Enabled=true;
        toolStrip.PolarizationLabel.Enabled=true;
    else
        toolStrip.PolarizationDropDown.Enabled=false;
        toolStrip.PolarizationLabel.Enabled=false;
    end

    if~strcmp(toolStrip.TypeDropDown.Value,getString(message('phased:apps:arrayapp:Directivity')))
        toolStrip.NormalizeCheck.Enabled=true;
    else
        toolStrip.NormalizeCheck.Enabled=false;
    end


    getCurrentFreqCallback(toolStrip);


    [y,~,u]=engunits(toolStrip.Freq3D);
    fcStr=[num2str(y),' ',u];
    toolStrip.FreqDropDown3D.Text=fcStr;


    if strcmp(coord,'polar')
        if strcmp(toolStrip.SubarraySteerPopup.Value,...
            getString(message('phased:apps:arrayapp:nosubarraysteering')))
            if toolStrip.PolarizationDropDown.Enabled
                pattern(arr,...
                toolStrip.Freq3D,...
                'PropagationSpeed',propSpeed,...
                'weights',w(:,1),...
                'CoordinateSystem',coord,...
                'ShowArray',toolStrip.ArrayCheck.Value,...
                'Orientation',str2num(toolStrip.OrientationEdit.Value),...
                'ShowLocalCoordinates',toolStrip.LocalCoordinateCheck.Value,...
                'ShowColorbar',toolStrip.ColorbarCheck.Value,...
                'Type',type,'Polarization',polarization,...
                'Normalize',toolStrip.NormalizeCheck.Value);
            elseif toolStrip.NormalizeCheck.Enabled
                pattern(arr,...
                toolStrip.Freq3D,...
                'PropagationSpeed',propSpeed,...
                'weights',w(:,1),...
                'CoordinateSystem',coord,...
                'ShowArray',toolStrip.ArrayCheck.Value,...
                'Orientation',str2num(toolStrip.OrientationEdit.Value),...
                'ShowLocalCoordinates',toolStrip.LocalCoordinateCheck.Value,...
                'ShowColorbar',toolStrip.ColorbarCheck.Value,...
                'Type',type,...
                'Normalize',toolStrip.NormalizeCheck.Value);
            else
                pattern(arr,...
                toolStrip.Freq3D,...
                'PropagationSpeed',propSpeed,...
                'weights',w(:,1),...
                'CoordinateSystem',coord,...
                'ShowArray',toolStrip.ArrayCheck.Value,...
                'Orientation',str2num(toolStrip.OrientationEdit.Value),...
                'ShowLocalCoordinates',toolStrip.LocalCoordinateCheck.Value,...
                'ShowColorbar',toolStrip.ColorbarCheck.Value,...
                'Type',type);
            end
        elseif strcmp(toolStrip.SubarraySteerPopup.Value,...
            getString(message('phased:apps:arrayapp:customsubarraysteering')))
            if toolStrip.PolarizationDropDown.Enabled
                pattern(arr,...
                toolStrip.Freq3D,...
                'PropagationSpeed',propSpeed,...
                'weights',w(:,1),...
                'CoordinateSystem',coord,...
                'ElementWeights',obj.ElementWeights,...
                'ShowArray',toolStrip.ArrayCheck.Value,...
                'Orientation',str2num(toolStrip.OrientationEdit.Value),...
                'ShowLocalCoordinates',toolStrip.LocalCoordinateCheck.Value,...
                'ShowColorbar',toolStrip.ColorbarCheck.Value,...
                'Type',type,'Polarization',polarization,...
                'Normalize',toolStrip.NormalizeCheck.Value);
            elseif toolStrip.NormalizeCheck.Enabled
                pattern(arr,...
                toolStrip.Freq3D,...
                'PropagationSpeed',propSpeed,...
                'weights',w(:,1),...
                'CoordinateSystem',coord,...
                'ElementWeights',obj.ElementWeights,...
                'ShowArray',toolStrip.ArrayCheck.Value,...
                'Orientation',str2num(toolStrip.OrientationEdit.Value),...
                'ShowLocalCoordinates',toolStrip.LocalCoordinateCheck.Value,...
                'ShowColorbar',toolStrip.ColorbarCheck.Value,...
                'Type',type,...
                'Normalize',toolStrip.NormalizeCheck.Value);
            else
                pattern(arr,...
                toolStrip.Freq3D,...
                'PropagationSpeed',propSpeed,...
                'weights',w(:,1),...
                'CoordinateSystem',coord,...
                'ElementWeights',obj.ElementWeights,...
                'ShowArray',toolStrip.ArrayCheck.Value,...
                'Orientation',str2num(toolStrip.OrientationEdit.Value),...
                'ShowLocalCoordinates',toolStrip.LocalCoordinateCheck.Value,...
                'ShowColorbar',toolStrip.ColorbarCheck.Value,...
                'Type',type);
            end
        else
            if toolStrip.PolarizationDropDown.Enabled
                pattern(arr,...
                toolStrip.Freq3D,...
                'PropagationSpeed',propSpeed,...
                'weights',w(:,1),...
                'CoordinateSystem',coord,...
                'SteerAngle',subarraySteerAng,...
                'ShowArray',toolStrip.ArrayCheck.Value,...
                'Orientation',str2num(toolStrip.OrientationEdit.Value),...
                'ShowLocalCoordinates',toolStrip.LocalCoordinateCheck.Value,...
                'ShowColorbar',toolStrip.ColorbarCheck.Value,...
                'Type',type,'Polarization',polarization,...
                'Normalize',toolStrip.NormalizeCheck.Value);
            elseif toolStrip.NormalizeCheck.Enabled
                pattern(arr,...
                toolStrip.Freq3D,...
                'PropagationSpeed',propSpeed,...
                'weights',w(:,1),...
                'CoordinateSystem',coord,...
                'SteerAngle',subarraySteerAng,...
                'ShowArray',toolStrip.ArrayCheck.Value,...
                'Orientation',str2num(toolStrip.OrientationEdit.Value),...
                'ShowLocalCoordinates',toolStrip.LocalCoordinateCheck.Value,...
                'ShowColorbar',toolStrip.ColorbarCheck.Value,...
                'Type',type,...
                'Normalize',toolStrip.NormalizeCheck.Value);
            else
                pattern(arr,...
                toolStrip.Freq3D,...
                'PropagationSpeed',propSpeed,...
                'weights',w(:,1),...
                'CoordinateSystem',coord,...
                'SteerAngle',subarraySteerAng,...
                'ShowArray',toolStrip.ArrayCheck.Value,...
                'Orientation',str2num(toolStrip.OrientationEdit.Value),...
                'ShowLocalCoordinates',toolStrip.LocalCoordinateCheck.Value,...
                'ShowColorbar',toolStrip.ColorbarCheck.Value,...
                'Type',type);
            end

        end
    else
        if strcmp(toolStrip.SubarraySteerPopup.Value,...
            getString(message('phased:apps:arrayapp:nosubarraysteering')))
            if toolStrip.PolarizationDropDown.Enabled
                pattern(arr,...
                toolStrip.Freq3D,...
                'PropagationSpeed',propSpeed,...
                'weights',w(:,1),...
                'CoordinateSystem',coord,...
                'ShowColorbar',toolStrip.ColorbarCheck.Value,...
                'Type',type,'Polarization',polarization,...
                'Normalize',toolStrip.NormalizeCheck.Value);
            elseif toolStrip.NormalizeCheck.Enabled
                pattern(arr,...
                toolStrip.Freq3D,...
                'PropagationSpeed',propSpeed,...
                'weights',w(:,1),...
                'CoordinateSystem',coord,...
                'ShowColorbar',toolStrip.ColorbarCheck.Value,...
                'Type',type,...
                'Normalize',toolStrip.NormalizeCheck.Value);
            else
                pattern(arr,...
                toolStrip.Freq3D,...
                'PropagationSpeed',propSpeed,...
                'weights',w(:,1),...
                'CoordinateSystem',coord,...
                'ShowColorbar',toolStrip.ColorbarCheck.Value,...
                'Type',type);
            end
        elseif strcmp(toolStrip.SubarraySteerPopup.Value,...
            getString(message('phased:apps:arrayapp:customsubarraysteering')))
            if toolStrip.PolarizationDropDown.Enabled
                pattern(arr,...
                toolStrip.Freq3D,...
                'PropagationSpeed',propSpeed,...
                'weights',w(:,1),...
                'CoordinateSystem',coord,...
                'ElementWeights',obj.ElementWeights,...
                'ShowColorbar',toolStrip.ColorbarCheck.Value,...
                'Type',type,'Polarization',polarization,...
                'Normalize',toolStrip.NormalizeCheck.Value);
            elseif toolStrip.NormalizeCheck.Enabled
                pattern(arr,...
                toolStrip.Freq3D,...
                'PropagationSpeed',propSpeed,...
                'weights',w(:,1),...
                'CoordinateSystem',coord,...
                'ElementWeights',obj.ElementWeights,...
                'ShowColorbar',toolStrip.ColorbarCheck.Value,...
                'Type',type,...
                'Normalize',toolStrip.NormalizeCheck.Value);
            else
                pattern(arr,...
                toolStrip.Freq3D,...
                'PropagationSpeed',propSpeed,...
                'weights',w(:,1),...
                'CoordinateSystem',coord,...
                'ElementWeights',obj.ElementWeights,...
                'ShowColorbar',toolStrip.ColorbarCheck.Value,...
                'Type',type);
            end
        else
            if toolStrip.PolarizationDropDown.Enabled
                pattern(arr,...
                toolStrip.Freq3D,...
                'PropagationSpeed',propSpeed,...
                'weights',w(:,1),...
                'CoordinateSystem',coord,...
                'SteerAngle',subarraySteerAng,...
                'ShowColorbar',toolStrip.ColorbarCheck.Value,...
                'Type',type,'Polarization',polarization,...
                'Normalize',toolStrip.NormalizeCheck.Value);
            elseif toolStrip.NormalizeCheck.Enabled
                pattern(arr,...
                toolStrip.Freq3D,...
                'PropagationSpeed',propSpeed,...
                'weights',w(:,1),...
                'CoordinateSystem',coord,...
                'SteerAngle',subarraySteerAng,...
                'ShowColorbar',toolStrip.ColorbarCheck.Value,...
                'Type',type,...
                'Normalize',toolStrip.NormalizeCheck.Value);
            else
                pattern(arr,...
                toolStrip.Freq3D,...
                'PropagationSpeed',propSpeed,...
                'weights',w(:,1),...
                'CoordinateSystem',coord,...
                'SteerAngle',subarraySteerAng,...
                'ShowColorbar',toolStrip.ColorbarCheck.Value,...
                'Type',type);
            end
        end
    end

    figHandle.HandleVisibility='off';


    hAxes=figHandle.CurrentAxes;
    hk=get(hAxes,'Children');
    surfHandle=findall(hk,'type','Surface');
    if all(surfHandle.XData(:)==0)&&all(surfHandle.YData(:)==0)...
        &&all(surfHandle.ZData(:)==0)

        if strcmp(obj.Container,'ToolGroup')
            bannerMessage=matlabshared.application.Banner(obj.Pattern3DFig);
        else
            bannerMessage=matlabshared.application.Banner(obj.Pattern3DFig);
            bannerMessage.IsWebFigure=true;
        end
        setMessage(bannerMessage,'text',...
        getString(message('phased:apps:arrayapp:zeroresponsepatternbannermsg',polarization)),...
        'phased:apps:arrayapp:zeroresponsepatternbannermsg');
        obj.BannerMessage3D=bannerMessage;
    else
        if~isempty(obj.BannerMessage3D)
            removeAllMessages(obj.BannerMessage3D);
        end
    end
    title=get(hAxes,'title');
    title_str=get(title,'String');
    [Fval,~,Fletter]=engunits(toolStrip.Freq3D);

    if~strcmp(coord,'polar')
        view(hAxes,0,90);
        axis(hAxes,'square');
        if strcmp(coord,'rectangular')
            xlim(hAxes,[-180,180]);
            ylim(hAxes,[-90,90]);
        end
    end

    axtoolbar(hAxes,{'export','rotate','pan',...
    'zoomin','zoomout','restoreview'});

    if any(any(steerAng~=0))
        steeringString=getString(...
        message('phased:apps:arrayapp:d3titlesteer',...
        num2str(steerAng(1,1)),num2str(steerAng(2,1))));
    else
        steeringString=getString(...
        message('phased:apps:arrayapp:NoSteering'));
    end

    title_str=[title_str,newline,num2str(Fval),' ',Fletter,[...
    getString(message('phased:apps:arrayapp:Hz')),' '],steeringString];


    set(title,'String',title_str);

    figOut=figHandle;

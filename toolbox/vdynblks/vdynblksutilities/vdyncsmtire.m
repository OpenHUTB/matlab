function[Fx,Fy,Fz,Mx,My,Mz,Re,kappa,alpha,sig_x,sig_y,patch_a,patch_b]=vdyncsmtire(Omega,Vx,Vy,psidot,gamma,press,scaleFactors,rhoz,plySteer,turnslip,...
    PRESMAX,...
    PRESMIN,...
    FZMAX,...
    FZMIN,...
    VXLOW,...
    KPUMAX,...
    KPUMIN,...
    ALPMAX,...
    ALPMIN,...
    CAMMIN,...
    CAMMAX,...
    LONGVL,...
    UNLOADED_RADIUS,...
    RIM_RADIUS,...
    NOMPRES,...
    FNOMIN,...
    VERTICAL_STIFFNESS,...
    DREFF,...
    BREFF,...
    FREFF,...
    Q_RE0,...
    Q_V1,...
    Q_V2,...
    Q_FZ1,...
    Q_FZ2,...
    Q_FCX,...
    Q_FCY,...
    PFZ1,...
    Q_FCY2,...
    BOTTOM_OFFST,...
    BOTTOM_STIFF,...
    PCX1,...
    PDX1,...
    PDX2,...
    PDX3,...
    PEX1,...
    PEX2,...
    PEX3,...
    PEX4,...
    PKX1,...
    PKX2,...
    PKX3,...
    PHX1,...
    PHX2,...
    PVX1,...
    PVX2,...
    PPX1,...
    PPX2,...
    PPX3,...
    PPX4,...
    RBX1,...
    RBX2,...
    RBX3,...
    RCX1,...
    REX1,...
    REX2,...
    RHX1,...
    QSX1,...
    QSX2,...
    QSX3,...
    QSX4,...
    QSX5,...
    QSX6,...
    QSX7,...
    QSX8,...
    QSX9,...
    QSX10,...
    QSX11,...
    PPMX1,...
    PCY1,...
    PDY1,...
    PDY2,...
    PDY3,...
    PEY1,...
    PEY2,...
    PEY3,...
    PEY4,...
    PEY5,...
    PKY1,...
    PKY2,...
    PKY3,...
    PKY4,...
    PKY5,...
    PKY6,...
    PKY7,...
    PHY1,...
    PHY2,...
    PVY1,...
    PVY2,...
    PVY3,...
    PVY4,...
    PPY1,...
    PPY2,...
    PPY3,...
    PPY4,...
    PPY5,...
    RBY1,...
    RBY2,...
    RBY3,...
    RBY4,...
    RCY1,...
    REY1,...
    REY2,...
    RHY1,...
    RHY2,...
    RVY1,...
    RVY2,...
    RVY3,...
    RVY4,...
    RVY5,...
    RVY6,...
    QSY1,...
    QSY2,...
    QSY3,...
    QSY4,...
    QSY5,...
    QSY6,...
    QSY7,...
    QSY8,...
    QBZ1,...
    QBZ2,...
    QBZ3,...
    QBZ4,...
    QBZ5,...
    QBZ6,...
    QBZ9,...
    QBZ10,...
    QCZ1,...
    QDZ1,...
    QDZ2,...
    QDZ3,...
    QDZ4,...
    QDZ6,...
    QDZ7,...
    QDZ8,...
    QDZ9,...
    QDZ10,...
    QDZ11,...
    QEZ1,...
    QEZ2,...
    QEZ3,...
    QEZ4,...
    QEZ5,...
    QHZ1,...
    QHZ2,...
    QHZ3,...
    QHZ4,...
    PPZ1,...
    PPZ2,...
    SSZ1,...
    SSZ2,...
    SSZ3,...
    SSZ4,...
    PDXP1,...
    PDXP2,...
    PDXP3,...
    PKYP1,...
    PDYP1,...
    PDYP2,...
    PDYP3,...
    PDYP4,...
    PHYP1,...
    PHYP2,...
    PHYP3,...
    PHYP4,...
    PECP1,...
    PECP2,...
    QDTP1,...
    QCRP1,...
    QCRP2,...
    QBRP1,...
    QDRP1,...
    QDRP2,...
    WIDTH,...
    Q_RA1,...
    Q_RA2,...
    Q_RB1,...
    Q_RB2,...
    QSX12,...
    QSX13,...
    QSX14,...
    Q_FZ3,...
    LONGITUDINAL_STIFFNESS,...
    LATERAL_STIFFNESS,...
    PCFX1,...
    PCFX2,...
    PCFX3,...
    PCFY1,...
    PCFY2,...
    PCFY3,...
    Fx_ext,...
    Fy_ext,...
    vdynMF)%#codegen

    coder.allowpcode('plain');
    [Naxles,Ntracks]=size(Omega);
    numWheels=Naxles.*Ntracks;
    if vdynMF(4)==1









































































































































































































































































































































































        if plySteer==0
            QSX1=0;
            RHX1=0;
            PEY3=0;
            PHY1=0;
            PHY2=0;
            PVY1=0;
            PVY2=0;
            RBY3=0;
            RVY1=0;
            RVY2=0;
            QBZ4=0;
            QDZ3=0;
            QDZ6=0;
            QDZ7=0;
            QEZ4=0;
            QHZ1=0;
            QHZ2=0;
            SSZ1=0;
        end



        lam_Fzo=scaleFactors(1,:)';
        lam_mux=scaleFactors(2,:)';
        lam_muy=scaleFactors(3,:)';
        lam_muV=scaleFactors(4,:)';
        lam_Kxkappa=scaleFactors(5,:)';
        lam_Kyalpha=scaleFactors(6,:)';
        lam_Cx=scaleFactors(7,:)';
        lam_Cy=scaleFactors(8,:)';
        lam_Ex=scaleFactors(9,:)';
        lam_Ey=scaleFactors(10,:)';
        lam_Hx=scaleFactors(11,:)';
        lam_Hy=scaleFactors(12,:)';
        lam_Vx=scaleFactors(13,:)';
        lam_Vy=scaleFactors(14,:)';
        lam_Kygamma=scaleFactors(15,:)';
        lam_Kzgamma=scaleFactors(16,:)';
        lam_t=scaleFactors(17,:)';
        lam_Mr=scaleFactors(18,:)';

        lam_xalpha=scaleFactors(19,:)';
        lam_ykappa=scaleFactors(20,:)';
        lam_Vykappa=scaleFactors(21,:)';
        lam_s=scaleFactors(22,:)';

        lam_Cz=scaleFactors(23,:)';
        lam_Mx=scaleFactors(24,:)';
        lam_VMx=scaleFactors(25,:)';
        lam_My=scaleFactors(26,:)';
        lam_Mphi=scaleFactors(27,:)';



        [~,Vxpabs]=div0protect(Vx,VXLOW);

        tempInds=gamma<CAMMIN;
        gamma(tempInds)=CAMMIN;
        tempInds=gamma>CAMMAX;
        gamma(tempInds)=CAMMAX;
        tempInds=press<PRESMIN;
        press(tempInds)=PRESMIN;
        tempInds=press>PRESMAX;
        press(tempInds)=PRESMAX;

        dpi=(press-NOMPRES)./NOMPRES;

        tempInds=lam_mux<=0;
        lam_mux(tempInds)=eps;
        tempInds=lam_muy<=0;
        lam_muy(tempInds)=eps;




        if any(isempty(Q_FZ1))||any(Q_FZ1==0)
            Q_FZ1=sqrt((VERTICAL_STIFFNESS.*UNLOADED_RADIUS./FNOMIN).^2-4.*Q_FZ2);
        end
        Fzo_prime=lam_Fzo.*FNOMIN;



        Fz=(1+Q_V2.*abs(Omega).*UNLOADED_RADIUS./LONGVL-(Q_FCX.*Fx_ext./FNOMIN).^2.-(Q_FCY.*Fy_ext./FNOMIN).^2).*...
        ((Q_FZ1+Q_FZ3.*gamma.*gamma).*rhoz./UNLOADED_RADIUS+Q_FZ2.*(rhoz./UNLOADED_RADIUS).^2).*(1+PFZ1.*dpi).*Fzo_prime;



        Fz_btm=BOTTOM_STIFF.*(RIM_RADIUS+BOTTOM_OFFST-(UNLOADED_RADIUS+rhoz)./cos(gamma));
        Fz=max(Fz,Fz_btm);

        Cz=VERTICAL_STIFFNESS.*lam_Cz;
        tempInds=rhoz>0;
        Cz(tempInds)=(Fz(tempInds)./abs(rhoz(tempInds))+Q_FCY2.*Fy_ext(tempInds)./FNOMIN).*lam_Cz(tempInds);


        FzUnSat=Fz;
        tempInds=Fz<FZMIN;
        Fz(tempInds)=FZMIN;
        tempInds=(Fz>FZMAX);
        Fz(tempInds)=FZMAX;

        dfz=(Fz-Fzo_prime)./Fzo_prime;



        epsilon=0.0001;
        epsilon_x=epsilon;
        epsilon_y=epsilon;
        epsilon_K=epsilon;
        epsilon_gamma=PECP1.*(1+PECP2.*dfz);
        epsilon_r=epsilon;
        epsilon_v=epsilon;



        Re=UNLOADED_RADIUS.*(Q_RE0+Q_V1.*((Omega.*UNLOADED_RADIUS)./LONGVL).^2);
        Re=Re-(FNOMIN./Cz).*(DREFF.*atan(BREFF.*(FzUnSat./FNOMIN))+FREFF.*(FzUnSat./FNOMIN));
        tempInds=Re<1e-3;
        Re(tempInds)=1e-3;



        patch_a=UNLOADED_RADIUS.*(Q_RA2.*(FzUnSat./(Cz.*UNLOADED_RADIUS))+Q_RA1.*sqrt(FzUnSat./(Cz.*UNLOADED_RADIUS)));
        patch_b=WIDTH.*(Q_RB2.*(FzUnSat./(Cz.*UNLOADED_RADIUS))+Q_RB1.*(FzUnSat./(Cz.*UNLOADED_RADIUS)).^(1/3));



        kappa=(Re.*Omega-Vx)./Vxpabs;

        tempInds=(kappa<KPUMIN);
        kappa(tempInds)=KPUMIN;
        tempInds=(kappa>KPUMAX);
        kappa(tempInds)=KPUMAX;
        kappa_x=kappa+(PHX1+PHX2.*dfz).*lam_Hx;



        alpha=atan2(Vy,Vxpabs);

        tempInds=(alpha<ALPMIN);
        alpha(tempInds)=ALPMIN;
        tempInds=(alpha>ALPMAX);
        alpha(tempInds)=ALPMAX;
        alpha_star=alpha;





        gamma_star=sin(gamma);







        Vsx=-Vxpabs.*kappa;
        Vsy=-Vxpabs.*tan(alpha);
        Vs=sqrt(Vsx.^2+Vsy.^2);


        Vcx=Vx;

        [Vcxp,~]=div0protect(Vcx,VXLOW);
        Vcy=Vsy;
        Vc=sqrt(Vcx.^2+Vcy.^2);
        [Vcp,~]=div0protect(Vc,VXLOW);

        Vc_prime=div0protect(Vc,epsilon_v);



        Vp=Re.*Omega-Vx;
        isLowSpeed=sqrt(Vp.^2+Vcy.^2)<VXLOW;



        A_mu=10;
        lam_mux_star=lam_mux./(1+lam_muV.*Vs./LONGVL);
        lam_mux_prime=lam_mux_star.*A_mu./(1+(A_mu-1).*lam_mux_star);
        mu_x=(PDX1+PDX2.*dfz).*(1+PPX3.*dpi+PPX4.*dpi.^2).*(1-PDX3.*gamma.^2).*lam_mux_star;

        lam_muy_star=lam_muy./(1+lam_muV.*Vs./LONGVL);
        lam_muy_prime=lam_muy_star.*A_mu./(1+(A_mu-1).*lam_muy_star);
        mu_y=(PDY1+PDY2.*dfz).*(1+PPY3.*dpi+PPY4.*dpi.^2).*(1-PDY3.*gamma_star.^2).*lam_muy_star;



        phi_t=-psidot./Vcxp;
        phi_t=phi_t.*cos(alpha);





        phi_t(isLowSpeed)=phi_t(isLowSpeed).*(abs(Vcx(isLowSpeed))./VXLOW);


        phi=-(1./Vc_prime).*(psidot-(1-epsilon_gamma).*abs(Omega).*sin(gamma));

        Rmin=100;
        if turnslip==1

            turnslipinds=logical(abs(phi)>abs(1./Rmin));
        else
            turnslipinds=false(numWheels,1);
        end
        nomslipinds=not(turnslipinds);


        SHykappa=RHY1+RHY2.*dfz;
        Eykappa=REY1+REY2.*dfz;
        Eykappa(Eykappa>1)=1;
        Cykappa=RCY1;
        Bykappa=(RBY1+RBY4.*gamma_star.^2).*cos(atan(RBY2.*(alpha_star-RBY3))).*lam_ykappa;
        Bykappa(Bykappa<0)=0;
        kappaS=kappa+SHykappa;




        zeta=ones(9,numWheels);

        zeta(1,turnslipinds)=0;
        if any(turnslipinds)
            Bxphi=PDXP1.*(1+PDXP2.*dfz).*cos(atan(PDXP3.*kappa));
            Byphi=PDYP1.*(1+PDYP2.*dfz).*cos(atan(PDYP3.*tan(alpha)));

            zeta(2,turnslipinds)=cos(atan(Bxphi(turnslipinds).*UNLOADED_RADIUS.*phi(turnslipinds)));

            zeta(3,turnslipinds)=cos(atan(Byphi(turnslipinds).*(UNLOADED_RADIUS.*abs(phi(turnslipinds))+PDYP4.*sqrt(UNLOADED_RADIUS.*abs(phi(turnslipinds))))));

            zeta(4,turnslipinds)=cos(atan(PKYP1.*UNLOADED_RADIUS.^2.*phi(turnslipinds).^2));
        end

        Kygammao=Fz.*(PKY6+PKY7.*dfz).*(1+PPY5.*dpi).*lam_Kygamma;

        Kyalpha=PKY1.*Fzo_prime.*(1+PPY1.*dpi).*(1-PKY3.*abs(gamma_star)).*...
        sin(PKY4.*atan(Fz./Fzo_prime./(PKY2+PKY5.*gamma_star.^2)./(1+PPY2.*dpi))).*zeta(4,:)'.*lam_Kyalpha;

        Kyalphao=PKY1.*Fzo_prime.*(1+PPY1.*dpi).*(1-PKY3.*abs(0)).*...
        sin(PKY4.*atan(Fz./Fzo_prime./(PKY2+PKY5.*gamma_star.^2)./(1+PPY2.*dpi))).*zeta(4,:)'.*lam_Kyalpha;
        [Kyalpha_prime,~]=div0protect(Kyalpha,epsilon_K);
        [Kyalphao_prime,~]=div0protect(Kyalphao,epsilon_K);
        CHyphi=PHYP1;
        CHyphi(CHyphi<0)=0;
        DHyphi=(PHYP2+PHYP3.*dfz).*tanh(Vcx);
        EHyphi=PHYP4;
        EHyphi(EHyphi>1)=1;

        KyRphio=Kygammao./(1-epsilon_gamma);
        BHyphi=KyRphio./(CHyphi.*DHyphi.*Kyalphao_prime);

        SHyphi=magicsin(DHyphi,CHyphi,BHyphi,EHyphi,UNLOADED_RADIUS.*phi).*tanh(Vcx);
        SVygamma=Fz.*(PVY3+PVY4.*dfz).*gamma_star.*zeta(3,:)'.*lam_Kygamma.*lam_muy_prime;
        SHy=zeros(numWheels,1);
        Gykappao=magiccos(1,Cykappa,Bykappa,Eykappa,SHykappa);
        Gykappa=magiccos(1,Cykappa,Bykappa,Eykappa,kappaS)./Gykappao;
        Gykappa(Gykappa<0)=0;
        if any(turnslipinds)
            zeta(5,turnslipinds)=1+SHyphi(turnslipinds)-SVygamma(turnslipinds)./Kyalpha_prime(turnslipinds);

            zeta(6,turnslipinds)=cos(atan(QDTP1.*UNLOADED_RADIUS.*phi(turnslipinds)));

            zeta(7,turnslipinds)=cos(atan(QBRP1.*UNLOADED_RADIUS.*phi(turnslipinds)));

            Mzphiinf=QCRP1.*mu_y.*UNLOADED_RADIUS.*Fz.*sqrt(Fz./Fzo_prime).*lam_Mphi;
            Mzphiinf(Mzphiinf<0)=1e-6;
            Mzphi90=Mzphiinf.*2./pi.*atan(QCRP2.*UNLOADED_RADIUS.*abs(phi_t)).*Gykappa;
            CDrphi=QDRP1;
            CDrphi(CDrphi<0)=0;
            EDrphi=QDRP2;
            EDrphi(EDrphi<0)=0;
            DDrphi=Mzphiinf./sin(0.5*pi*CDrphi);
            Kzgammaro=Fz.*UNLOADED_RADIUS.*(QDZ8+QDZ9.*dfz+(QDZ10+QDZ11.*dfz).*abs(gamma)).*lam_Kzgamma;
            BDrphi=Kzgammaro./(CDrphi.*DDrphi.*(1-epsilon_gamma)+epsilon_r.*sign(1-epsilon_gamma));
            Drphi=magicsin(DDrphi,CDrphi,BDrphi,EDrphi,-UNLOADED_RADIUS.*phi);
            DrphiSign=sign(Drphi);
            DrphiSign(DrphiSign==0)=1;
            tmpDrphiVar=Mzphi90(turnslipinds)./(-abs(Drphi(turnslipinds))+epsilon_r.*DrphiSign(turnslipinds));
            tmpDrphiVar(tmpDrphiVar>1)=1;
            tmpDrphiVar(tmpDrphiVar<-1)=-1;
            zeta(8,turnslipinds)=2./pi.*acos(tmpDrphiVar);

            zeta(9,turnslipinds)=1+Drphi(turnslipinds);



            SHy(turnslipinds)=(PHY1+PHY2.*dfz(turnslipinds)).*lam_Hy(turnslipinds)+SHyphi(turnslipinds)-SVygamma(turnslipinds)./Kyalpha_prime(turnslipinds);
        end




        Cx=PCX1.*lam_Cx;
        Cx(Cx<0)=0;

        Dx=mu_x.*Fz.*zeta(2,:)';
        Dx(Dx<0)=0;

        Ex=(PEX1+PEX2.*dfz+PEX3.*dfz.^2).*(1-PEX4.*tanh(10.*kappa_x)).*lam_Ex;
        Ex(Ex>1)=1;

        Kxkappa=Fz.*(PKX1+PKX2.*dfz).*exp(PKX3.*dfz).*(1+PPX1.*dpi+PPX2.*dpi.^2).*lam_Kxkappa;

        [CxDxp,~]=div0protect(Cx.*Dx,epsilon_x);
        Bx=Kxkappa./CxDxp;

        SVx=Fz.*(PVX1+PVX2.*dfz).*lam_mux_prime.*lam_Vx.*zeta(2,:)';

        Fxo_nom=magicsin(Dx,Cx,Bx,Ex,kappa_x);
        Fxo=Fxo_nom+SVx;



        SHxalpha=RHX1;
        Exalpha=REX1+REX2.*dfz;
        Exalpha(Exalpha>1)=1;
        Cxalpha=RCX1;
        Bxalpha=(RBX1+RBX3.*gamma_star.^2).*cos(atan(RBX2.*kappa)).*lam_xalpha;
        Bxalpha(Bxalpha<0)=0;
        alpha_S=alpha_star+SHxalpha;
        Gxalpha=magiccos(1,Cxalpha,Bxalpha,Exalpha,alpha_S)./magiccos(1,Cxalpha,Bxalpha,Exalpha,SHxalpha);
        Gxalpha(Gxalpha<0)=0;
        Fx=Fxo.*Gxalpha;



        Cy=PCY1.*lam_Cy;
        Cy(Cy<0)=0;

        Dy=mu_y.*Fz.*zeta(3,:)';

        [CyDyp,~]=div0protect(Cy.*Dy,epsilon_y);
        By=Kyalpha./CyDyp;

        if any(nomslipinds)
            SHy(nomslipinds)=(PHY1+PHY2.*dfz(nomslipinds)).*lam_Hy(nomslipinds)+(Kygammao(nomslipinds).*gamma_star(nomslipinds)-SVygamma(nomslipinds))./(Kyalpha_prime(nomslipinds)).*zeta(1,nomslipinds)'+zeta(5,nomslipinds)'-1;
        end


        SVy=Fz.*(PVY1+PVY2.*dfz).*lam_Vy.*lam_muy_prime.*zeta(3,:)'+SVygamma;

        alpha_y=alpha_star+SHy;
        alpha_ySign=sign(alpha_y);
        alpha_ySign(alpha_ySign==0)=1;


        Ey=(PEY1+PEY2.*dfz).*(1+PEY5.*gamma_star.^2-(PEY3+PEY4.*gamma_star).*alpha_ySign).*lam_Ey;
        Ey(Ey>1)=1;


        Fyo=magicsin(Dy,Cy,By,Ey,alpha_y);
        Fyo=Fyo+SVy;


        DVykappa=mu_y.*Fz.*(RVY1+RVY2.*dfz+RVY3.*gamma_star).*cos(atan(RVY4.*alpha_star)).*zeta(3,:)';
        SVykappa=DVykappa.*sin(RVY5.*atan(RVY6.*kappa)).*lam_Vykappa;
        Fy=(Fyo.*Gykappa+SVykappa);





        My=tanh(10.*Omega).*rollingMoment(Fx,Vcx,FzUnSat,press,gamma,LONGVL,UNLOADED_RADIUS,FNOMIN,NOMPRES,QSY1,QSY2,QSY3,QSY4,QSY5,QSY6,QSY7,QSY8,lam_My);








        Mx=UNLOADED_RADIUS.*Fz.*lam_Mx.*(QSX1.*lam_VMx-QSX2.*gamma.*(1+PPMX1.*dpi)-QSX12.*gamma.*abs(gamma)+QSX3.*Fy./FNOMIN+...
        QSX4.*cos(QSX5.*atan((QSX6.*Fz./FNOMIN).^2)).*sin(QSX7.*gamma+QSX8.*atan(QSX9.*Fy./FNOMIN))+...
        QSX10.*atan(QSX11.*Fz./FNOMIN).*gamma)+UNLOADED_RADIUS.*Fy.*lam_Mx.*(QSX13+QSX14.*abs(gamma));



        cosprimealpha=Vcx./Vcp;
        SHt=QHZ1+QHZ2.*dfz+(QHZ3+QHZ4.*dfz).*gamma_star;
        alpha_t=alpha_star+SHt;
        Kyalphaprime=Kyalpha_prime;
        SHf=SHy+SVy./Kyalphaprime;
        alpha_r=alpha_star+SHf;







        Bt=(QBZ1+QBZ2.*dfz+QBZ3.*dfz.^2).*(1+QBZ4.*gamma+QBZ5.*abs(gamma)+QBZ6.*gamma_star.^2).*lam_Kyalpha./lam_muy_star;
        Bt(Bt<0)=0;
        Ct=QCZ1;
        Ct(Ct<0)=0;
        Dt=(QDZ1+QDZ2.*dfz).*(1-PPZ1.*dpi).*(1+QDZ3.*gamma+QDZ4.*gamma.^2).*Fz.*(UNLOADED_RADIUS./Fzo_prime).*lam_t.*zeta(6,:)';
        Et=(QEZ1+QEZ2.*dfz+QEZ3.*dfz.^2).*(1+(QEZ4+QEZ5.*gamma_star).*2./pi.*atan(Bt.*Ct.*alpha_t));
        Et(Et>1)=1;
        Dr=Fz.*UNLOADED_RADIUS.*((QDZ6+QDZ7.*dfz).*lam_Mr.*zeta(3,:)'+((QDZ8+QDZ9.*dfz).*(1+PPZ2.*dpi)+(QDZ10+QDZ11.*dfz).*abs(gamma_star)).*gamma_star.*lam_Kzgamma.*zeta(1,:)').*lam_muy_star.*tanh(10*Vcx).*cosprimealpha+zeta(9,:)'-1;
        Cr=zeta(8,:)';
        Br=(QBZ9.*lam_Kyalpha./lam_muy_star+QBZ10.*By.*Cy).*zeta(7,:)';
        alpha_req=atan(sqrt(tan(alpha_r).^2+(Kxkappa./Kyalphaprime).^2.*kappa.^2)).*tanh(1e3.*alpha_r);
        alpha_teq=atan(sqrt(tan(alpha_t).^2+(Kxkappa./Kyalphaprime).^2.*kappa.^2)).*tanh(1e3.*alpha_t);
        Mzr=magiccos(Dr,Cr,Br,0,alpha_req);

        t=magiccos(Dt,Ct,Bt,Et,alpha_teq).*cosprimealpha;
        t=t.*lam_Fzo;

        s=UNLOADED_RADIUS.*(SSZ1+SSZ2.*Fy./FNOMIN+(SSZ3+SSZ4.*dfz).*gamma_star).*lam_s;
        Fyprime=Fy-SVykappa;
        Mzprime=-t.*Fyprime;
        Mz=Mzprime+Mzr+s.*Fx;


        sig_Cx=LONGITUDINAL_STIFFNESS.*(1+PCFX1.*dfz+PCFX2.*dfz.^2).*(1+PCFX3.*dpi);
        sig_Cy=LATERAL_STIFFNESS.*(1+PCFY1.*dfz+PCFY2.*dfz.^2).*(1+PCFY3.*dpi);
        sig_x=abs(Kxkappa./sig_Cx);
        sig_y=abs(Kyalpha./sig_Cy);
    else
        [Fx,Fy,Fz,Mx,My,Mz,Re,kappa,alpha,sig_x,sig_y,patch_a,patch_b]=vdyncsmtire(Omega,Vx,Vy,psidot,gamma,press,scaleFactors,rhoz,plySteer,turnslip,...
        PRESMAX,...
        PRESMIN,...
        FZMAX,...
        FZMIN,...
        VXLOW,...
        KPUMAX,...
        KPUMIN,...
        ALPMAX,...
        ALPMIN,...
        CAMMIN,...
        CAMMAX,...
        LONGVL,...
        UNLOADED_RADIUS,...
        RIM_RADIUS,...
        NOMPRES,...
        FNOMIN,...
        vdynMF(39),...
        vdynMF(44),...
        vdynMF(43),...
        vdynMF(45),...
        vdynMF(46),...
        vdynMF(47),...
        vdynMF(48),...
        vdynMF(49),...
        vdynMF(50),...
        vdynMF(52),...
        vdynMF(53),...
        vdynMF(55),...
        vdynMF(56),...
        vdynMF(63),...
        vdynMF(64),...
        vdynMF(135),...
        vdynMF(136),...
        vdynMF(137),...
        vdynMF(138),...
        vdynMF(139),...
        vdynMF(140),...
        vdynMF(141),...
        vdynMF(142),...
        vdynMF(143),...
        vdynMF(144),...
        vdynMF(145),...
        vdynMF(146),...
        vdynMF(147),...
        vdynMF(148),...
        vdynMF(149),...
        vdynMF(150),...
        vdynMF(151),...
        vdynMF(152),...
        vdynMF(153),...
        vdynMF(154),...
        vdynMF(155),...
        vdynMF(156),...
        vdynMF(157),...
        vdynMF(158),...
        vdynMF(159),...
        vdynMF(160),...
        vdynMF(161),...
        vdynMF(162),...
        vdynMF(163),...
        vdynMF(164),...
        vdynMF(165),...
        vdynMF(166),...
        vdynMF(167),...
        vdynMF(168),...
        vdynMF(169),...
        vdynMF(170),...
        vdynMF(171),...
        vdynMF(175),...
        vdynMF(176),...
        vdynMF(177),...
        vdynMF(178),...
        vdynMF(179),...
        vdynMF(180),...
        vdynMF(181),...
        vdynMF(182),...
        vdynMF(183),...
        vdynMF(184),...
        vdynMF(185),...
        vdynMF(186),...
        vdynMF(187),...
        vdynMF(188),...
        vdynMF(189),...
        vdynMF(190),...
        vdynMF(191),...
        vdynMF(192),...
        vdynMF(193),...
        vdynMF(194),...
        vdynMF(195),...
        vdynMF(196),...
        vdynMF(197),...
        vdynMF(198),...
        vdynMF(199),...
        vdynMF(200),...
        vdynMF(201),...
        vdynMF(202),...
        vdynMF(203),...
        vdynMF(204),...
        vdynMF(205),...
        vdynMF(206),...
        vdynMF(207),...
        vdynMF(208),...
        vdynMF(209),...
        vdynMF(210),...
        vdynMF(211),...
        vdynMF(212),...
        vdynMF(213),...
        vdynMF(214),...
        vdynMF(215),...
        vdynMF(216),...
        vdynMF(217),...
        vdynMF(218),...
        vdynMF(219),...
        vdynMF(220),...
        vdynMF(221),...
        vdynMF(222),...
        vdynMF(223),...
        vdynMF(224),...
        vdynMF(225),...
        vdynMF(226),...
        vdynMF(227),...
        vdynMF(228),...
        vdynMF(229),...
        vdynMF(230),...
        vdynMF(231),...
        vdynMF(232),...
        vdynMF(233),...
        vdynMF(234),...
        vdynMF(235),...
        vdynMF(236),...
        vdynMF(237),...
        vdynMF(238),...
        vdynMF(239),...
        vdynMF(240),...
        vdynMF(241),...
        vdynMF(243),...
        vdynMF(243),...
        vdynMF(244),...
        vdynMF(245),...
        vdynMF(246),...
        vdynMF(247),...
        vdynMF(248),...
        vdynMF(249),...
        vdynMF(250),...
        vdynMF(251),...
        vdynMF(252),...
        vdynMF(253),...
        vdynMF(254),...
        vdynMF(255),...
        vdynMF(256),...
        vdynMF(257),...
        vdynMF(258),...
        vdynMF(259),...
        vdynMF(260),...
        vdynMF(261),...
        vdynMF(262),...
        vdynMF(263),...
        vdynMF(264),...
        vdynMF(265),...
        vdynMF(266),...
        vdynMF(267),...
        vdynMF(268),...
        vdynMF(269),...
        vdynMF(270),...
        vdynMF(271),...
        vdynMF(272),...
        vdynMF(273),...
        vdynMF(274),...
        vdynMF(275),...
        vdynMF(276),...
        vdynMF(277),...
        vdynMF(278),...
        vdynMF(279),...
        WIDTH,...
        vdynMF(87),...
        vdynMF(88),...
        vdynMF(89),...
        vdynMF(90),...
        vdynMF(172),...
        vdynMF(173),...
        vdynMF(174),...
        vdynMF(51),...
        vdynMF(65),...
        vdynMF(66),...
        vdynMF(80),...
        vdynMF(81),...
        vdynMF(82),...
        vdynMF(83),...
        vdynMF(84),...
        vdynMF(85),...
        Fx_ext,...
        Fy_ext,[0;0;0;1;zeros(275,1)]);
    end
end
function y=magicsin(D,C,B,E,u)
%#codegen
    y=D.*sin(C.*atan(B.*u-E.*(B.*u-atan(B.*u))));
end
function y=magiccos(D,C,B,E,u)
%#codegen
    y=D.*cos(C.*atan(B.*u-E.*(B.*u-atan(B.*u))));
end
function[y,yabs]=div0protect(u,tol)
%#codegen
    yabs=abs(u);
    ytolinds=yabs<tol;
    yabs(ytolinds)=2.*tol./(3-(yabs(ytolinds)./tol).^2);
    yneginds=u<0;
    y=yabs;
    y(yneginds)=-yabs(yneginds);
end
function My=rollingMoment(Fx,Vcx,Fz,press,gamma,Vo,Ro,Fzo,pio,QSY1,QSY2,QSY3,QSY4,QSY5,QSY6,QSY7,QSY8,lam_My)
%#codegen




    My=-Ro.*Fzo.*lam_My.*(QSY1+QSY2.*(Fx./Fzo)+QSY3.*abs(Vcx./Vo)+QSY4.*(Vcx./Vo).^4...
    +(QSY5+QSY6.*(Fz./Fzo)).*gamma.*gamma).*((Fz./Fzo).^QSY7.*(press./pio).^QSY8);

end
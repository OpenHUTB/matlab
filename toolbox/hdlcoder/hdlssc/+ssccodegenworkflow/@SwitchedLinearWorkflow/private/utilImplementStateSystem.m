function utilImplementStateSystem(hstateSystemIn1StateNew,hstateSystemIn2State,...
    hstateSystemIn3ModeNew,hstateSystemOut1StateNew,hstateSystemOut2State,...
    hstateSystemOut3Mode,hstateSystem,stateSpaceParameters,numsolverIters,...
    initialState,hdlAlgorithmDataType)




    stateSystem=getfullname(hstateSystem);


    set_param(hstateSystemIn1StateNew,'Position',[640,43,670,57]);
    set_param(hstateSystemIn2State,'Position',[730,113,760,127]);
    set_param(hstateSystemIn3ModeNew,'Position',[430,228,460,242]);
    set_param(hstateSystemOut1StateNew,'Position',[970,98,1000,112]);
    set_param(hstateSystemOut2State,'Position',[640,143,670,157]);
    set_param(hstateSystemOut3Mode,'Position',[640,283,670,297]);




    henableConstantBlk=add_block('hdlsllib/Sources/Constant',strcat(stateSystem,'/Enable'),...
    'MakeNameUnique','on',...
    'Value','1',...
    'OutDataTypeStr','boolean',...
    'Position',[20,275,50,305]);


    hdelayBlk1=add_block('hdlsllib/Discrete/Delay',strcat(stateSystem,'/Delay1'),...
    'MakeNameUnique','on',...
    'DelayLength','1',...
    'Position',[95,273,130,307]);
    hdelayBlk2=add_block('hdlsllib/Discrete/Delay',strcat(stateSystem,'/Delay2'),...
    'MakeNameUnique','on',...
    'DelayLength','1',...
    'Position',[205,133,240,167]);


    hstateSelectRateTransitionBlk=add_block('hdlsllib/Signal Attributes/Rate Transition',strcat(stateSystem,'/Rate Transition1'),...
    'MakeNameUnique','on',...
    'OutPortSampleTimeOpt','Multiple of input port sample time',...
    'OutPortSampleTimeMultiple',strcat('1/',num2str(numsolverIters)),...
    'Position',[280,129,320,171]);
    hmodeSelectRateTransitionBlk=add_block('hdlsllib/Signal Attributes/Rate Transition',strcat(stateSystem,'/Rate Transition2'),...
    'MakeNameUnique','on',...
    'OutPortSampleTimeOpt','Multiple of input port sample time',...
    'OutPortSampleTimeMultiple',strcat('1/',num2str(numsolverIters)),...
    'Position',[280,269,320,311]);


    hinitialStateConstantBlk=add_block('hdlsllib/Sources/Constant',strcat(stateSystem,'/X0'),...
    'MakeNameUnique','on',...
    'Value',initialState,...
    'Position',[365,185,395,215]);

    numIndexBits=max(ceil(log2(stateSpaceParameters.NumberOfSwitchingModes)));
    if iscell(stateSpaceParameters.Ad)
        startingModeValue=strcat('[',repmat(strcat(' fi(','0,0,',num2str(numIndexBits),',0)'),1,size(stateSpaceParameters.Ad,2)),']');
    else
        startingModeValue=strcat('fi(','0,0,',num2str(numIndexBits),',0)');
    end


    hinitialModeConstantBlk=add_block('hdlsllib/Sources/Constant',strcat(stateSystem,'/Constant'),...
    'MakeNameUnique','on',...
    'Value',startingModeValue,...
    'Position',[365,325,395,355]);


    hmodeSelectDelayBlk=add_block('hdlsllib/Discrete/Delay',strcat(stateSystem,'/Delay'),...
    'MakeNameUnique','on',...
    'DelayLength','1',...
    'Position',[365,273,400,307]);


    hstateSelectSwitchBlk=add_block('hdlsllib/Signal Routing/Switch',strcat(stateSystem,'/Switch'),...
    'MakeNameUnique','on',...
    'Position',[515,130,565,170],...
    'OutDataTypeStr',hdlAlgorithmDataType,...
    'Criteria','u2 ~= 0');
    hmodeSelectSwitchBlk=add_block('hdlsllib/Signal Routing/Switch',strcat(stateSystem,'/Switch1'),...
    'MakeNameUnique','on',...
    'Position',[515,270,565,310],...
    'Criteria','u2 ~= 0');
    hstateNewSelectSwitchBlk=add_block('hdlsllib/Signal Routing/Switch',strcat(stateSystem,'/Switch2'),...
    'MakeNameUnique','on',...
    'Position',[855,85,905,125],...
    'OutDataTypeStr',hdlAlgorithmDataType,...
    'Criteria','u2 ~= 0');
    hswitchBlk=add_block('hdlsllib/Signal Routing/Switch',strcat(stateSystem,'/Switch3'),...
    'MakeNameUnique','on',...
    'Position',[1210,100,1260,140],...
    'Criteria','u2 ~= 0');


    hstorageDelayBlk=add_block('hdlsllib/Discrete/Delay',strcat(stateSystem,'/Delay3'),...
    'MakeNameUnique','on',...
    'DelayLength','1',...
    'Position',[1325,102,1360,138]);


    hcounterBlk=add_block('hdlsllib/Sources/Counter Limited',strcat(stateSystem,'/Counter Limited'),...
    'uplimit',num2str(numsolverIters-1),...
    'Position',[365,425,395,455]);


    hcomparatorBlk=add_block('hdlsllib/Logic and Bit Operations/Compare To Constant',strcat(stateSystem,'/Compare To Constant'),...
    'relop','==',...
    'const',num2str(numsolverIters-1),...
    'Position',[745,425,775,455]);


    hbitwiseAnd=add_block('hdlsllib/Logic and Bit Operations/Bitwise Operator',strcat(stateSystem,'/Bitwise Operator'),...
    'logicop','AND',...
    'UseBitMask','off',...
    'NumInputPorts','2',...
    'Position',[905,411,945,449]);


    add_line(stateSystem,strcat(get_param(henableConstantBlk,'Name'),'/1'),strcat(get_param(hdelayBlk1,'Name'),'/1'),...
    'autorouting','on');

    add_line(stateSystem,strcat(get_param(hdelayBlk1,'Name'),'/1'),strcat(get_param(hdelayBlk2,'Name'),'/1'),...
    'autorouting','on');
    add_line(stateSystem,strcat(get_param(hdelayBlk1,'Name'),'/1'),strcat(get_param(hmodeSelectRateTransitionBlk,'Name'),'/1'),...
    'autorouting','on');

    add_line(stateSystem,strcat(get_param(hdelayBlk2,'Name'),'/1'),strcat(get_param(hstateSelectRateTransitionBlk,'Name'),'/1'),...
    'autorouting','on');

    add_line(stateSystem,strcat(get_param(hstateSelectRateTransitionBlk,'Name'),'/1'),strcat(get_param(hstateSelectSwitchBlk,'Name'),'/2'),...
    'autorouting','on');

    add_line(stateSystem,strcat(get_param(hmodeSelectRateTransitionBlk,'Name'),'/1'),strcat(get_param(hmodeSelectDelayBlk,'Name'),'/1'),...
    'autorouting','on');

    add_line(stateSystem,strcat(get_param(hmodeSelectDelayBlk,'Name'),'/1'),strcat(get_param(hmodeSelectSwitchBlk,'Name'),'/2'),...
    'autorouting','on');
    add_line(stateSystem,strcat(get_param(hmodeSelectDelayBlk,'Name'),'/1'),strcat(get_param(hbitwiseAnd,'Name'),'/1'),...
    'autorouting','on');

    add_line(stateSystem,strcat(get_param(hinitialStateConstantBlk,'Name'),'/1'),strcat(get_param(hstateSelectSwitchBlk,'Name'),'/3'),...
    'autorouting','on');

    add_line(stateSystem,strcat(get_param(hinitialModeConstantBlk,'Name'),'/1'),strcat(get_param(hmodeSelectSwitchBlk,'Name'),'/3'),...
    'autorouting','on');

    add_line(stateSystem,strcat(get_param(hstateSelectSwitchBlk,'Name'),'/1'),strcat(get_param(hstateSystemOut2State,'Name'),'/1'),...
    'autorouting','on');

    add_line(stateSystem,strcat(get_param(hmodeSelectSwitchBlk,'Name'),'/1'),strcat(get_param(hstateSystemOut3Mode,'Name'),'/1'),...
    'autorouting','on');

    add_line(stateSystem,strcat(get_param(hstateSystemIn3ModeNew,'Name'),'/1'),strcat(get_param(hmodeSelectSwitchBlk,'Name'),'/1'),...
    'autorouting','on');

    add_line(stateSystem,strcat(get_param(hcounterBlk,'Name'),'/1'),strcat(get_param(hcomparatorBlk,'Name'),'/1'),...
    'autorouting','on');

    add_line(stateSystem,strcat(get_param(hcomparatorBlk,'Name'),'/1'),strcat(get_param(hbitwiseAnd,'Name'),'/2'),...
    'autorouting','on');

    add_line(stateSystem,strcat(get_param(hbitwiseAnd,'Name'),'/1'),strcat(get_param(hstateNewSelectSwitchBlk,'Name'),'/2'),...
    'autorouting','on');
    add_line(stateSystem,strcat(get_param(hbitwiseAnd,'Name'),'/1'),strcat(get_param(hswitchBlk,'Name'),'/2'),...
    'autorouting','on');

    add_line(stateSystem,strcat(get_param(hstateSystemIn2State,'Name'),'/1'),strcat(get_param(hstateNewSelectSwitchBlk,'Name'),'/3'),...
    'autorouting','on');
    add_line(stateSystem,strcat(get_param(hstateNewSelectSwitchBlk,'Name'),'/1'),strcat(get_param(hstateSystemOut1StateNew,'Name'),'/1'),...
    'autorouting','on');

    add_line(stateSystem,strcat(get_param(hstateSystemIn1StateNew,'Name'),'/1'),strcat(get_param(hstateNewSelectSwitchBlk,'Name'),'/1'),...
    'autorouting','on');
    add_line(stateSystem,strcat(get_param(hstateSystemIn1StateNew,'Name'),'/1'),strcat(get_param(hswitchBlk,'Name'),'/1'),...
    'autorouting','on');

    add_line(stateSystem,strcat(get_param(hswitchBlk,'Name'),'/1'),strcat(get_param(hstorageDelayBlk,'Name'),'/1'),...
    'autorouting','on');

    add_line(stateSystem,strcat(get_param(hstorageDelayBlk,'Name'),'/1'),strcat(get_param(hstateSelectSwitchBlk,'Name'),'/1'),...
    'autorouting','on');
    add_line(stateSystem,strcat(get_param(hstorageDelayBlk,'Name'),'/1'),strcat(get_param(hswitchBlk,'Name'),'/3'),...
    'autorouting','on');
end

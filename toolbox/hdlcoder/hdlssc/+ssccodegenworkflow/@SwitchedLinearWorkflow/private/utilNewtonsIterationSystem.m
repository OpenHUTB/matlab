function utilNewtonsIterationSystem(hInX_n,hInX_guess,hIn3Input,~,hOut1,system,systemParameters)












    if strcmpi(systemParameters.AlgorithmDataType,'MixedDoubleSingle')
        mixedDataType='double';
    else
        mixedDataType=systemParameters.AlgorithmDataType;
    end


    hmultiplyMxdot=add_block('hdlssclib/NFPSparseConstMultiply',strcat(system,'/Mxdot'),...
    'MakeNameUnique','on',...
    'Position',[905,120,985,200],...
    'constMatrix',strcat(mixedDataType,'(',systemParameters.Mass{1},')'));

    hmultiplyAx=add_block('hdlssclib/NFPSparseConstMultiply',strcat(system,'/Ax'),...
    'MakeNameUnique','on',...
    'Position',[905,120,985,200],...
    'constMatrix',strcat(mixedDataType,'(',systemParameters.StateParameter{1},')'));

    hmultiplyBu=add_block('hdlssclib/NFPSparseConstMultiply',strcat(system,'/Bu'),...
    'MakeNameUnique','on',...
    'Position',[905,120,985,200],...
    'constMatrix',strcat(mixedDataType,'(',systemParameters.InputParameter{1},')'));

    hDiscreteDifference=add_block('hdlsllib/HDL Floating Point Operations/Add',strcat(system,'/Discrete Difference'),...
    'MakeNameUnique','on',...
    'Position',[1100,51,1130,84],...
    'Inputs','+-');
    hOutputSum=add_block('hdlsllib/HDL Floating Point Operations/Add',strcat(system,'/OutputSum'),...
    'MakeNameUnique','on',...
    'Position',[1100,51,1130,84],...
    'Inputs','++++');

    hmatlabFunctionBlk=add_block('hdlsllib/User-Defined Functions/MATLAB Function',strcat(system,'/nonlinearity'),...
    'MakeNameUnique','on',...
    'Position',[275,31,345,79]);
    hmatlabCodeBlk=find(slroot,'-isa','Stateflow.EMChart','Path',getfullname(hmatlabFunctionBlk));

    hmatlabCodeBlk.Script=systemParameters.Nonlinearity{2};
    hDtGain=add_block('hdlsllib/HDL Floating Point Operations/Gain',strcat(system,'/SampleTime'),...
    'MakeNameUnique','on',...
    'Gain',strcat(mixedDataType,'(',systemParameters.SampleTime,')'));


    add_line(system,strcat(get_param(hInX_n,'Name'),'/1'),strcat(get_param(hDiscreteDifference,'Name'),'/1'),...
    'autorouting','on');
    add_line(system,strcat(get_param(hInX_guess,'Name'),'/1'),strcat(get_param(hDiscreteDifference,'Name'),'/2'),...
    'autorouting','on');
    add_line(system,strcat(get_param(hDiscreteDifference,'Name'),'/1'),strcat(get_param(hmultiplyMxdot,'Name'),'/1'),...
    'autorouting','on');
    add_line(system,strcat(get_param(hmultiplyMxdot,'Name'),'/1'),strcat(get_param(hOutputSum,'Name'),'/1'),...
    'autorouting','on');


    add_line(system,strcat(get_param(hInX_guess,'Name'),'/1'),strcat(get_param(hmultiplyAx,'Name'),'/1'),...
    'autorouting','on');
    add_line(system,strcat(get_param(hmultiplyAx,'Name'),'/1'),strcat(get_param(hOutputSum,'Name'),'/2'),...
    'autorouting','on');


    add_line(system,strcat(get_param(hIn3Input,'Name'),'/1'),strcat(get_param(hmultiplyBu,'Name'),'/1'),...
    'autorouting','on');
    add_line(system,strcat(get_param(hmultiplyBu,'Name'),'/1'),strcat(get_param(hOutputSum,'Name'),'/3'),...
    'autorouting','on');


    add_line(system,strcat(get_param(hInX_guess,'Name'),'/1'),strcat(get_param(hmatlabFunctionBlk,'Name'),'/1'),...
    'autorouting','on');
    add_line(system,strcat(get_param(hIn3Input,'Name'),'/1'),strcat(get_param(hmatlabFunctionBlk,'Name'),'/2'),...
    'autorouting','on');
    add_line(system,strcat(get_param(hmatlabFunctionBlk,'Name'),'/1'),strcat(get_param(hDtGain,'Name'),'/1'),...
    'autorouting','on');
    add_line(system,strcat(get_param(hDtGain,'Name'),'/1'),strcat(get_param(hOutputSum,'Name'),'/4'),...
    'autorouting','on');




    hfullJacobian=add_block('hdlsllib/HDL Floating Point Operations/Add',strcat(system,'/Full Jacobian'),...
    'MakeNameUnique','on',...
    'Position',[1100,51,1130,84],...
    'Inputs','+-+');
    hcorrection=add_block('hdlsllib/HDL Floating Point Operations/Divide',strcat(system,'/Correction'),...
    'MakeNameUnique','on',...
    'Position',[1100,51,1130,84],...
    'Inputs','/*','Multiplication','Matrix');
    hnextGuess=add_block('hdlsllib/HDL Floating Point Operations/Add',strcat(system,'/Next Guess'),...
    'MakeNameUnique','on',...
    'Position',[1100,51,1130,84],...
    'Inputs','+-');

    hMmatrix=add_block('hdlsllib/Sources/Constant',strcat(system,'/M'),...
    'MakeNameUnique','on',...
    'Value',strcat(mixedDataType,'(',systemParameters.Mass{1},')'),'Position',[20,275,50,305]);
    hAmatrix=add_block('hdlsllib/Sources/Constant',strcat(system,'/A'),...
    'MakeNameUnique','on',...
    'Value',strcat(mixedDataType,'(',systemParameters.StateParameter{1},')'),'Position',[20,275,50,305]);

    hDtGain2=add_block('hdlsllib/HDL Floating Point Operations/Gain',strcat(system,'/SampleTime2'),...
    'MakeNameUnique','on',...
    'Gain',strcat(mixedDataType,'(',systemParameters.SampleTime,')'));




    hmatlabFunctionBlkNonlinearJ=add_block('hdlsllib/User-Defined Functions/MATLAB Function',strcat(system,'/Nonlinear Jacobian'),...
    'MakeNameUnique','on',...
    'Position',[275,31,345,79]);
    hmatlabCodeBlkNonlinearJ=find(slroot,'-isa','Stateflow.EMChart','Path',getfullname(hmatlabFunctionBlkNonlinearJ));

    hmatlabCodeBlkNonlinearJ.Script=systemParameters.NonlinearityJ{2};
    add_line(system,strcat(get_param(hInX_guess,'Name'),'/1'),strcat(get_param(hmatlabFunctionBlkNonlinearJ,'Name'),'/1'),...
    'autorouting','on');
    add_line(system,strcat(get_param(hIn3Input,'Name'),'/1'),strcat(get_param(hmatlabFunctionBlkNonlinearJ,'Name'),'/2'),...
    'autorouting','on');

    add_line(system,strcat(get_param(hmatlabFunctionBlkNonlinearJ,'Name'),'/1'),strcat(get_param(hDtGain2,'Name'),'/1'),...
    'autorouting','on');
    add_line(system,strcat(get_param(hDtGain2,'Name'),'/1'),strcat(get_param(hfullJacobian,'Name'),'/1'),...
    'autorouting','on');






    add_line(system,strcat(get_param(hMmatrix,'name'),'/1'),strcat(get_param(hfullJacobian,'Name'),'/2'),...
    'autorouting','on');
    add_line(system,strcat(get_param(hAmatrix,'name'),'/1'),strcat(get_param(hfullJacobian,'Name'),'/3'),...
    'autorouting','on');


    add_line(system,strcat(get_param(hfullJacobian,'Name'),'/1'),strcat(get_param(hcorrection,'name'),'/1'),...
    'autorouting','on');
    add_line(system,strcat(get_param(hOutputSum,'Name'),'/1'),strcat(get_param(hcorrection,'name'),'/2'),...
    'autorouting','on');


    add_line(system,strcat(get_param(hInX_guess,'name'),'/1'),strcat(get_param(hnextGuess,'Name'),'/1'),...
    'autorouting','on');
    add_line(system,strcat(get_param(hcorrection,'name'),'/1'),strcat(get_param(hnextGuess,'Name'),'/2'),...
    'autorouting','on');
    add_line(system,strcat(get_param(hnextGuess,'Name'),'/1'),strcat(get_param(hOut1,'name'),'/1'),...
    'autorouting','on');




end

function hICsystem=utilAddICsystem(parent,position,EqnName,globalInfo,dataType)








    totalSolverSteps=globalInfo.TotalIters;

    hICsystem=utilAddSubsystem(parent,'Initial Conditions',position);
    ICName=getfullname(hICsystem);


    hInX=add_block('hdlsllib/Sources/In1',strcat(ICName,'/State'),...
    'MakeNameUnique','on',...
    'Position',[310,-7,340,7]);

    hInMode=add_block('hdlsllib/Sources/In1',strcat(ICName,'/Mode'),...
    'MakeNameUnique','on',...
    'Position',[310,143,340,157]);

    hOut=add_block('hdlsllib/Sinks/Out1',strcat(ICName,'/State Out'),...
    'MakeNameUnique','on',...
    'Position',[570,33,600,47]);

    hModeOut=add_block('hdlsllib/Sinks/Out1',strcat(ICName,'/Mode Out'),...
    'MakeNameUnique','on',...
    'Position',[570,183,600,197]);

    fModechart=matlab.internal.feature("SSC2HDLModechart");

    if(fModechart)
        if(globalInfo.numQs>0)

            hInQ=add_block('hdlsllib/Sources/In1',strcat(ICName,'/Q'),...
            'MakeNameUnique','on',...
            'Position',[310,200,340,215]);

            hInCI=add_block('hdlsllib/Sources/In1',strcat(ICName,'/CI'),...
            'MakeNameUnique','on',...
            'Position',[310,300,340,315]);

            hQOut=add_block('hdlsllib/Sinks/Out1',strcat(ICName,'/Q Out'),...
            'MakeNameUnique','on',...
            'Position',[570,357,600,373]);

            hCIOut=add_block('hdlsllib/Sinks/Out1',strcat(ICName,'/CI Out'),...
            'MakeNameUnique','on',...
            'Position',[570,502,600,518]);
        end
    end



    hStateDelay=add_block('hdlsllib/Discrete/Delay',strcat(ICName,'/Delay'),...
    'MakeNameUnique','on',...
    'DelayLength','1',...
    'Position',[405,-17,440,17]);

    hModeDelay=add_block('hdlsllib/Discrete/Delay',strcat(ICName,'/Delay1'),...
    'MakeNameUnique','on',...
    'DelayLength','1',...
    'Position',[405,133,440,167]);

    if(fModechart)
        if(globalInfo.numQs>0)

            hQDelay=add_block('hdlsllib/Discrete/Delay',strcat(ICName,'/Delay'),...
            'MakeNameUnique','on',...
            'DelayLength','1',...
            'Position',[405,250,440,284]);

            hCIDelay=add_block('hdlsllib/Discrete/Delay',strcat(ICName,'/Delay1'),...
            'MakeNameUnique','on',...
            'DelayLength','1',...
            'Position',[405,400,440,434]);
        end
    end


    hDelay=add_block('hdlsllib/Discrete/Delay',strcat(ICName,'/Delay2'),...
    'MakeNameUnique','on',...
    'DelayLength',num2str(totalSolverSteps),...
    'Position',[120,23,155,57]);

    hDelay1=add_block('hdlsllib/Discrete/Delay',strcat(ICName,'/Delay3'),...
    'MakeNameUnique','on',...
    'DelayLength',num2str(totalSolverSteps),...
    'Position',[205,23,240,57]);


    hstateSwitchBlk=add_block('hdlsllib/Signal Routing/Switch',strcat(ICName,'/Switch'),...
    'MakeNameUnique','on',...
    'Position',[470,20,520,60],...
    'OutDataTypeStr',dataType,...
    'Criteria','u2 ~= 0');


    featIntModes=matlab.internal.feature('SSC2HDLIntegerModes');
    if(featIntModes)
        hmodeSwitchBlk=add_block('hdlsllib/Signal Routing/Switch',strcat(ICName,'/Switch'),...
        'MakeNameUnique','on',...
        'Position',[470,170,520,210],...
        'Criteria','u2 ~= 0',...
        'OutDataTypeStr','int32');
    else
        hmodeSwitchBlk=add_block('hdlsllib/Signal Routing/Switch',strcat(ICName,'/Switch'),...
        'MakeNameUnique','on',...
        'Position',[470,170,520,210],...
        'Criteria','u2 ~= 0',...
        'OutDataTypeStr','boolean');
    end


    if(fModechart)

        if(globalInfo.numQs>0)
            hqSwitchBlk=add_block('hdlsllib/Signal Routing/Switch',strcat(ICName,'/Switch'),...
            'MakeNameUnique','on',...
            'Position',[470,370,520,410],...
            'Criteria','u2 ~= 0',...
            'OutDataTypeStr',dataType);


            hCISwitchBlk=add_block('hdlsllib/Signal Routing/Switch',strcat(ICName,'/Switch'),...
            'MakeNameUnique','on',...
            'Position',[470,570,520,610],...
            'Criteria','u2 ~= 0',...
            'OutDataTypeStr',dataType);
        end
    end



    hValid=add_block('hdlsllib/Sources/Constant',strcat(ICName,'/Valid Out'),...
    'MakeNameUnique','on',...
    'Value','1',...
    'SampleTime',compactButAccurateNum2Str(globalInfo.sampleTime),...
    'OutDataTypeStr','boolean',...
    'Position',[45,25,75,55]);

    if(~fModechart)
        initialX=EqnName.IC;
    else
        initialX=EqnName.IC.X;
    end
    hICX=add_block('hdlsllib/Sources/Constant',strcat(ICName,'/Constant'),...
    'MakeNameUnique','on',...
    'Value',strcat(dataType,'(',initialX,')'),...
    'SampleTime',compactButAccurateNum2Str(globalInfo.sampleTime),...
    'Position',[370,60,400,90]);

    hICM=add_block('hdlsllib/Sources/Constant',strcat(ICName,'/Constant1'),...
    'MakeNameUnique','on',...
    'Value',EqnName.IM,...
    'SampleTime',compactButAccurateNum2Str(globalInfo.sampleTime),...
    'Position',[370,225,400,255]);

    if(fModechart)
        if(globalInfo.numQs>0)

            hICQ=add_block('hdlsllib/Sources/Constant',strcat(ICName,'/Constant2'),...
            'MakeNameUnique','on',...
            'Value',strcat(dataType,'(',EqnName.IC.Q,')'),...
            'SampleTime',compactButAccurateNum2Str(globalInfo.sampleTime),...
            'Position',[395,380,425,410]);

            hICC=add_block('hdlsllib/Sources/Constant',strcat(ICName,'/Constant3'),...
            'MakeNameUnique','on',...
            'Value',strcat(dataType,'(',EqnName.IC.CI,')'),...
            'SampleTime',compactButAccurateNum2Str(globalInfo.sampleTime),...
            'Position',[365,530,395,560]);
        end
    end


    portDims=12;
    if(fModechart)
        if(globalInfo.numQs>0)
            portDims=22;
        end
    end
    linePorts=cell(portDims,2);

    linePorts(1,:)={strcat(get_param(hValid,'name'),'/1'),...
    strcat(get_param(hDelay,'name'),'/1')};

    linePorts(2,:)={strcat(get_param(hDelay,'name'),'/1'),...
    strcat(get_param(hDelay1,'name'),'/1')};

    linePorts(3,:)={strcat(get_param(hDelay,'name'),'/1'),...
    strcat(get_param(hmodeSwitchBlk,'name'),'/2')};

    linePorts(4,:)={strcat(get_param(hDelay1,'name'),'/1'),...
    strcat(get_param(hstateSwitchBlk,'name'),'/2')};


    linePorts(5,:)={strcat(get_param(hInX,'name'),'/1'),...
    strcat(get_param(hStateDelay,'name'),'/1')};

    linePorts(6,:)={strcat(get_param(hStateDelay,'name'),'/1'),...
    strcat(get_param(hstateSwitchBlk,'name'),'/1')};

    linePorts(7,:)={strcat(get_param(hICX,'name'),'/1'),...
    strcat(get_param(hstateSwitchBlk,'name'),'/3')};

    linePorts(8,:)={strcat(get_param(hstateSwitchBlk,'name'),'/1'),...
    strcat(get_param(hOut,'name'),'/1')};


    linePorts(9,:)={strcat(get_param(hInMode,'name'),'/1'),...
    strcat(get_param(hModeDelay,'name'),'/1')};

    linePorts(10,:)={strcat(get_param(hModeDelay,'name'),'/1'),...
    strcat(get_param(hmodeSwitchBlk,'name'),'/1')};

    linePorts(11,:)={strcat(get_param(hICM,'name'),'/1'),...
    strcat(get_param(hmodeSwitchBlk,'name'),'/3')};

    linePorts(12,:)={strcat(get_param(hmodeSwitchBlk,'name'),'/1'),...
    strcat(get_param(hModeOut,'name'),'/1')};

    if(fModechart)
        if(globalInfo.numQs>0)

            linePorts(13,:)={strcat(get_param(hDelay1,'name'),'/1'),...
            strcat(get_param(hqSwitchBlk,'name'),'/2')};


            linePorts(14,:)={strcat(get_param(hDelay1,'name'),'/1'),...
            strcat(get_param(hCISwitchBlk,'name'),'/2')};


            linePorts(15,:)={strcat(get_param(hInQ,'name'),'/1'),...
            strcat(get_param(hQDelay,'name'),'/1')};

            linePorts(16,:)={strcat(get_param(hQDelay,'name'),'/1'),...
            strcat(get_param(hqSwitchBlk,'name'),'/1')};

            linePorts(17,:)={strcat(get_param(hICQ,'name'),'/1'),...
            strcat(get_param(hqSwitchBlk,'name'),'/3')};

            linePorts(18,:)={strcat(get_param(hqSwitchBlk,'name'),'/1'),...
            strcat(get_param(hQOut,'name'),'/1')};


            linePorts(19,:)={strcat(get_param(hInCI,'name'),'/1'),...
            strcat(get_param(hCIDelay,'name'),'/1')};

            linePorts(20,:)={strcat(get_param(hCIDelay,'name'),'/1'),...
            strcat(get_param(hCISwitchBlk,'name'),'/1')};

            linePorts(21,:)={strcat(get_param(hICC,'name'),'/1'),...
            strcat(get_param(hCISwitchBlk,'name'),'/3')};

            linePorts(22,:)={strcat(get_param(hCISwitchBlk,'name'),'/1'),...
            strcat(get_param(hCIOut,'name'),'/1')};


        end
    end

    add_line(ICName,linePorts(:,1),linePorts(:,2),'AutoRouting','smart')

end


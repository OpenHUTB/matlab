

function OutputStreamController(~,hN,OutControlInSigs,OutControlOutSigs,hBoolT,...
    hInputDataT,hAddrT,hCounterT,slRate,blockInfo)



    hOutControlN=pirelab.createNewNetwork(...
    'Name','OutputStreamController',...
    'InportNames',{'invDone','outEnable','rdData'},...
    'InportTypes',[hBoolT,hBoolT,pirelab.createPirArrayType(hInputDataT,[blockInfo.RowSize+1,0])],...
    'InportRates',slRate*ones(1,3),...
    'OutportNames',{'outStreamEnb','validOut','dataOut','rdAddrOut','outStreamDone'},...
    'OutportTypes',[hBoolT,hBoolT,hInputDataT,hAddrT,hBoolT]);

    hOutControlN.setTargetCompReplacementCandidate(true);


    for ii=1:numel(hOutControlN.PirOutputSignals)
        hOutControlN.PirOutputSignals(ii).SimulinkRate=slRate;
    end

    hOutControlNinSigs=hOutControlN.PirInputSignals;
    hOutControlNoutSigs=hOutControlN.PirOutputSignals;

    outStreamRdEnbS=l_addSignal(hOutControlN,'outStreamRdEnb',hBoolT,slRate);
    rowCountS=l_addSignal(hOutControlN,'rowCount',hCounterT,slRate);


    RdControlInSigs=[hOutControlNinSigs(1),hOutControlNoutSigs(5)];
    RdControlOutSigs=[hOutControlNoutSigs(1),outStreamRdEnbS,rowCountS,hOutControlNoutSigs(4)];

    ReadControl(hOutControlN,RdControlInSigs,RdControlOutSigs,hBoolT,hCounterT,hAddrT,slRate,blockInfo);


    OutDataSelInSigs=[hOutControlNoutSigs(1),outStreamRdEnbS,rowCountS,...
    hOutControlNinSigs(2),hOutControlNinSigs(3)];

    OutDataSelOutSigs=[hOutControlNoutSigs(2),hOutControlNoutSigs(3)];

    OutDataSelector(hOutControlN,OutDataSelInSigs,OutDataSelOutSigs,hBoolT,hCounterT,hInputDataT,slRate,blockInfo);


    OutDoneInSigs=hOutControlNoutSigs(1);
    OutDoneOutSigs=hOutControlNoutSigs(5);

    OutStreamDoneGenerator(hOutControlN,OutDoneInSigs,OutDoneOutSigs,hBoolT,slRate);


    pirelab.instantiateNetwork(hN,hOutControlN,OutControlInSigs,OutControlOutSigs,...
    [hOutControlN.Name,'_inst']);
end



function ReadControl(hN,RdControlInSigs,RdControlOutSigs,hBoolT,hCounterT,hAddrT,slRate,blockInfo)


    hReadControlN=pirelab.createNewNetwork(...
    'Name','ReadControl',...
    'InportNames',{'invDone','outStreamDone'},...
    'InportTypes',[hBoolT,hBoolT],...
    'InportRates',slRate*ones(1,2),...
    'OutportNames',{'outStreamEnable','outStreamRdEnable','rowCount','rdAddrOut'},...
    'OutportTypes',[hBoolT,hBoolT,hCounterT,hAddrT]);



    for ii=1:numel(hReadControlN.PirOutputSignals)
        hReadControlN.PirOutputSignals(ii).SimulinkRate=slRate;
    end
    hReadControlNinSigs=hReadControlN.PirInputSignals;
    hReadControlNoutSigs=hReadControlN.PirOutputSignals;

    CompareToConstant_out1_s1=l_addSignal(hReadControlN,sprintf('Compare\nTo Constant_out1'),hBoolT,slRate);
    CompareToConstant2_out1_s2=l_addSignal(hReadControlN,sprintf('Compare\nTo Constant2_out1'),hBoolT,slRate);
    Constant_out1_s3=l_addSignal(hReadControlN,'Constant_out1',hBoolT,slRate);
    Constant1_out1_s4=l_addSignal(hReadControlN,'Constant1_out1',hBoolT,slRate);
    Constant2_out1_s5=l_addSignal(hReadControlN,'Constant2_out1',hCounterT,slRate);
    Delay_out1_s6=l_addSignal(hReadControlN,'Delay_out1',hBoolT,slRate);
    HDLCounter_out1_s8=l_addSignal(hReadControlN,'HDL Counter_out1',hCounterT,slRate);
    LogicalOperator_out1_s10=l_addSignal(hReadControlN,sprintf('Logical\nOperator_out1'),hBoolT,slRate);
    LogicalOperator2_out1_s12=l_addSignal(hReadControlN,sprintf('Logical\nOperator2_out1'),hBoolT,slRate);
    LogicalOperator3_out1_s13=l_addSignal(hReadControlN,sprintf('Logical\nOperator3_out1'),hBoolT,slRate);
    Switch_out1_s15=l_addSignal(hReadControlN,'Switch_out1',hBoolT,slRate);
    Switch1_out1_s16=l_addSignal(hReadControlN,'Switch1_out1',hBoolT,slRate);



    pirelab.getConstComp(hReadControlN,...
    Constant_out1_s3,...
    1,...
    'Constant','on',0,'','','');

    pirelab.getConstComp(hReadControlN,...
    Constant1_out1_s4,...
    0,...
    'Constant1','on',1,'','','');

    pirelab.getConstComp(hReadControlN,...
    Constant2_out1_s5,...
    1,...
    'Constant2','on',0,'','','');

    pirelab.getIntDelayComp(hReadControlN,...
    hReadControlNoutSigs(2),...
    Delay_out1_s6,...
    1,'Delay',...
    false,...
    0,0,[],0,0);

    pirelab.getIntDelayComp(hReadControlN,...
    Switch_out1_s15,...
    hReadControlNoutSigs(2),...
    1,'Delay1',...
    false,...
    0,0,[],0,0);

    pirelab.getCounterComp(hReadControlN,...
    [hReadControlNinSigs(2),hReadControlNoutSigs(2)],...
    HDLCounter_out1_s8,...
    'Count limited',1,1,blockInfo.RowSize,1,0,1,0,'HDL Counter',1);

    pirelab.getCounterComp(hReadControlN,...
    [hReadControlNinSigs(2),LogicalOperator_out1_s10],...
    hReadControlNoutSigs(3),...
    'Count limited',1,1,blockInfo.RowSize,1,0,1,0,'HDL Counter1',1);

    pirelab.getCompareToValueComp(hReadControlN,...
    HDLCounter_out1_s8,...
    CompareToConstant_out1_s1,...
    '==',blockInfo.RowSize,...
    sprintf('Compare\nTo Constant'),0);

    pirelab.getCompareToValueComp(hReadControlN,...
    hReadControlNoutSigs(3),...
    CompareToConstant2_out1_s2,...
    '==',blockInfo.RowSize,...
    sprintf('Compare\nTo Constant2'),0);

    pirelab.getLogicComp(hReadControlN,...
    [hReadControlNoutSigs(2),CompareToConstant_out1_s1],...
    LogicalOperator_out1_s10,...
    'and',sprintf('Logical\nOperator'));

    pirelab.getLogicComp(hReadControlN,...
    [Delay_out1_s6,hReadControlNoutSigs(2)],...
    hReadControlNoutSigs(1),...
    'or',sprintf('Logical\nOperator1'));


    pirelab.getLogicComp(hReadControlN,...
    [CompareToConstant2_out1_s2,CompareToConstant_out1_s1],...
    LogicalOperator2_out1_s12,...
    'and',sprintf('Logical\nOperator2'));

    pirelab.getLogicComp(hReadControlN,...
    [hReadControlNoutSigs(2),LogicalOperator2_out1_s12],...
    LogicalOperator3_out1_s13,...
    'and',sprintf('Logical\nOperator3'));

    pirelab.getAddComp(hReadControlN,...
    [HDLCounter_out1_s8,Constant2_out1_s5],...
    hReadControlNoutSigs(4),...
    'Floor','Wrap','Subtract3',hCounterT,'+-');

    pirelab.getSwitchComp(hReadControlN,...
    [Constant_out1_s3,Switch1_out1_s16],...
    Switch_out1_s15,...
    hReadControlNinSigs(1),'Switch',...
    '~=',0,'Floor','Wrap');

    pirelab.getSwitchComp(hReadControlN,...
    [Constant1_out1_s4,hReadControlNoutSigs(2)],...
    Switch1_out1_s16,...
    LogicalOperator3_out1_s13,'Switch1',...
    '~=',0,'Floor','Wrap');



    pirelab.instantiateNetwork(hN,hReadControlN,RdControlInSigs,RdControlOutSigs,...
    [hReadControlN.Name,'_inst']);
end



function OutDataSelector(hN,OutDataSelInSigs,OutDataSelOutSigs,hBoolT,...
    hCounterT,hInputDataT,slRate,blockInfo)


    hOutDataSelN=pirelab.createNewNetwork(...
    'Name','OutDataSelector',...
    'InportNames',{'outStreamEnable','outStreamRdEnable','rowCount',...
    'outEnable','rdData'},...
    'InportTypes',[hBoolT,hBoolT,hCounterT,hBoolT,pirelab.createPirArrayType(hInputDataT,[blockInfo.RowSize+1,0])],...
    'InportRates',slRate*ones(1,5),...
    'OutportNames',{'validOut','dataOut'},...
    'OutportTypes',[hBoolT,hInputDataT]);



    for ii=1:numel(hOutDataSelN.PirOutputSignals)
        hOutDataSelN.PirOutputSignals(ii).SimulinkRate=slRate;
    end
    hOutDataSelNinSigs=hOutDataSelN.PirInputSignals;
    hOutDataSelNoutSigs=hOutDataSelN.PirOutputSignals;


    Constant2_out1_s5=l_addSignal(hOutDataSelN,'Constant2_out1',hInputDataT,slRate);
    Delay_out1_s6=l_addSignal(hOutDataSelN,'Delay_out1',hCounterT,slRate);
    Delay1_out1_s7=l_addSignal(hOutDataSelN,'Delay1_out1',hBoolT,slRate);
    MultiPortSwitchOutS=l_addSignal(hOutDataSelN,'MultiPortSwitchOut',hInputDataT,slRate);


    pirelab.getConstComp(hOutDataSelN,...
    Constant2_out1_s5,...
    single(0),...
    'Constant2','on',1,'','','');


    pirelab.getIntDelayComp(hOutDataSelN,...
    hOutDataSelNinSigs(3),...
    Delay_out1_s6,...
    1,'Delay',...
    0,...
    0,0,[],0,0);


    pirelab.getIntDelayComp(hOutDataSelN,...
    hOutDataSelNinSigs(2),...
    Delay1_out1_s7,...
    1,'Delay1',...
    false,...
    0,0,[],0,0);

    pirelab.getLogicComp(hOutDataSelN,...
    [hOutDataSelNinSigs(4),Delay1_out1_s7,hOutDataSelNinSigs(1)],...
    hOutDataSelNoutSigs(1),...
    'and',sprintf('Logical\nOperator'));



    rdDataOutSelS=hOutDataSelNinSigs(5).split;



    pirelab.getMultiPortSwitchComp(hOutDataSelN,...
    [Delay_out1_s6,(rdDataOutSelS.PirOutputSignals(1:end-1))',Constant2_out1_s5],...
    MultiPortSwitchOutS,...
    1,'One-based contiguous','Floor','Wrap',sprintf('Multiport\nSwitch'),[]);

    pirelab.getSwitchComp(hOutDataSelN,...
    [MultiPortSwitchOutS,Constant2_out1_s5],...
    hOutDataSelNoutSigs(2),...
    hOutDataSelNoutSigs(1),'Switch',...
    '~=',0,'Floor','Wrap');


    pirelab.instantiateNetwork(hN,hOutDataSelN,OutDataSelInSigs,OutDataSelOutSigs,...
    [hOutDataSelN.Name,'_inst']);

end


function OutStreamDoneGenerator(hN,OutDoneInSigs,OutDoneOutSigs,hBoolT,...
    slRate)


    hOutDoneN=pirelab.createNewNetwork(...
    'Name','OutStreamDoneGenerator',...
    'InportNames',{'outStreamEnable'},...
    'InportTypes',hBoolT,...
    'InportRates',slRate,...
    'OutportNames',{'outStreamDone'},...
    'OutportTypes',hBoolT);



    for ii=1:numel(hOutDoneN.PirOutputSignals)
        hOutDoneN.PirOutputSignals(ii).SimulinkRate=slRate;
    end

    hOutDoneNinSigs=hOutDoneN.PirInputSignals;
    hOutDoneNoutSigs=hOutDoneN.PirOutputSignals;



    CompareToConstant8_out1_s1=l_addSignal(hOutDoneN,sprintf('Compare\nTo Constant8_out1'),hBoolT,slRate);
    CompareToConstant9_out1_s2=l_addSignal(hOutDoneN,sprintf('Compare\nTo Constant9_out1'),hBoolT,slRate);
    Delay3_out1_s3=l_addSignal(hOutDoneN,'Delay3_out1',hBoolT,slRate);
    Delay3_out_s5=l_addSignal(hOutDoneN,'Delay3_out',hBoolT,slRate);
    Delay3_Initial_Val_out_s6=l_addSignal(hOutDoneN,'Delay3_Initial_Val_out',hBoolT,slRate);
    Delay3_ctrl_const_out_s7=l_addSignal(hOutDoneN,'Delay3_ctrl_const_out',hBoolT,slRate);
    Delay3_ctrl_delay_out_s8=l_addSignal(hOutDoneN,'Delay3_ctrl_delay_out',hBoolT,slRate);

    pirelab.getIntDelayComp(hOutDoneN,...
    hOutDoneNinSigs(1),...
    Delay3_out_s5,...
    1,'Delay3',...
    double(0),...
    0,0,[],0,0);


    pirelab.getConstComp(hOutDoneN,...
    Delay3_Initial_Val_out_s6,...
    false,...
    'Delay3_Initial_Val','on',0,'','','');

    pirelab.getConstComp(hOutDoneN,...
    Delay3_ctrl_const_out_s7,...
    1,...
    'Delay3_ctrl_const');

    pirelab.getIntDelayComp(hOutDoneN,...
    Delay3_ctrl_const_out_s7,...
    Delay3_ctrl_delay_out_s8,...
    1,'Delay3_ctrl_delay',...
    double(0),...
    0,0,[],0,0);

    pirelab.getSwitchComp(hOutDoneN,...
    [Delay3_out_s5,Delay3_Initial_Val_out_s6],...
    Delay3_out1_s3,...
    Delay3_ctrl_delay_out_s8,'Delay3_switch',...
    '~=',0,'Floor','Wrap');


    pirelab.getCompareToValueComp(hOutDoneN,...
    Delay3_out1_s3,...
    CompareToConstant8_out1_s1,...
    '==',1,...
    sprintf('Compare\nTo Constant8'),0);


    pirelab.getCompareToValueComp(hOutDoneN,...
    hOutDoneNinSigs(1),...
    CompareToConstant9_out1_s2,...
    '==',0,...
    sprintf('Compare\nTo Constant9'),1);


    pirelab.getLogicComp(hOutDoneN,...
    [CompareToConstant9_out1_s2,CompareToConstant8_out1_s1],...
    hOutDoneNoutSigs(1),...
    'and',sprintf('Logical\nOperator4'));



    pirelab.instantiateNetwork(hN,hOutDoneN,OutDoneInSigs,OutDoneOutSigs,...
    [hOutDoneN.Name,'_inst']);
end


function hS=l_addSignal(hN,sigName,pirTyp,simulinkRate)
    hS=hN.addSignal;
    hS.Name=sigName;
    hS.Type=pirTyp;
    hS.SimulinkHandle=-1;
    hS.SimulinkRate=simulinkRate;
end

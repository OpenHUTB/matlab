

function DiagDataComputation(~,hN,DiagDataComputationInSigs,DiagDataComputationOutSigs,...
    hBoolT,hInputDataT,slRate)


    hDiagDataComputationN=pirelab.createNewNetwork(...
    'Name','DiagDataComputation',...
    'InportNames',{'diagValidIn','diagDataIn','nonDiagDataOut','nonDiagValidOut','rowDone'},...
    'InportTypes',[hBoolT,hInputDataT,hInputDataT,hBoolT,hBoolT],...
    'InportRates',slRate*ones(1,5),...
    'OutportNames',{'diagValidOut','diagDataOut'},...
    'OutportTypes',[hBoolT,hInputDataT]);

    hDiagDataComputationN.setTargetCompReplacementCandidate(true);


    for ii=1:numel(hDiagDataComputationN.PirOutputSignals)
        hDiagDataComputationN.PirOutputSignals(ii).SimulinkRate=slRate;
    end

    hDiagDataComputationNinSigs=hDiagDataComputationN.PirInputSignals;
    hDiagDataComputationNoutSigs=hDiagDataComputationN.PirOutputSignals;


    Add_out1_s5=l_addSignal(hDiagDataComputationN,'Add_out1',hInputDataT,slRate);
    Constant_out1_s6=l_addSignal(hDiagDataComputationN,'Constant_out1',hInputDataT,slRate);
    Constant4_out1_s7=l_addSignal(hDiagDataComputationN,'Constant4_out1',hInputDataT,slRate);
    DataTypeConversion_out1_s8=l_addSignal(hDiagDataComputationN,'Data Type Conversion_out1',hInputDataT,slRate);
    Delay_out1_s9=l_addSignal(hDiagDataComputationN,'Delay_out1',hBoolT,slRate);
    Delay1_out1_s10=l_addSignal(hDiagDataComputationN,'Delay1_out1',hBoolT,slRate);
    Delay10_out1_s11=l_addSignal(hDiagDataComputationN,'Delay10_out1',hInputDataT,slRate);
    Delay11_out1_s12=l_addSignal(hDiagDataComputationN,'Delay11_out1',hInputDataT,slRate);
    Delay12_out1_s13=l_addSignal(hDiagDataComputationN,'Delay12_out1',hInputDataT,slRate);
    Delay13_out1_s14=l_addSignal(hDiagDataComputationN,'Delay13_out1',hBoolT,slRate);
    Delay14_out1_s15=l_addSignal(hDiagDataComputationN,'Delay14_out1',hInputDataT,slRate);
    Delay15_out1_s16=l_addSignal(hDiagDataComputationN,'Delay15_out1',hBoolT,slRate);
    Delay16_out1_s17=l_addSignal(hDiagDataComputationN,'Delay16_out1',hBoolT,slRate);
    Delay17_out1_s18=l_addSignal(hDiagDataComputationN,'Delay17_out1',hBoolT,slRate);
    Delay18_out1_s19=l_addSignal(hDiagDataComputationN,'Delay18_out1',hBoolT,slRate);
    Delay19_out1_s20=l_addSignal(hDiagDataComputationN,'Delay19_out1',hBoolT,slRate);
    Delay2_out1_s21=l_addSignal(hDiagDataComputationN,'Delay2_out1',hInputDataT,slRate);
    Delay3_out1_s22=l_addSignal(hDiagDataComputationN,'Delay3_out1',hInputDataT,slRate);
    Delay4_out1_s23=l_addSignal(hDiagDataComputationN,'Delay4_out1',hInputDataT,slRate);
    Delay5_out1_s24=l_addSignal(hDiagDataComputationN,'Delay5_out1',hInputDataT,slRate);
    Delay6_out1_s25=l_addSignal(hDiagDataComputationN,'Delay6_out1',hInputDataT,slRate);
    Delay7_out1_s26=l_addSignal(hDiagDataComputationN,'Delay7_out1',hInputDataT,slRate);
    Delay8_out1_s27=l_addSignal(hDiagDataComputationN,'Delay8_out1',hBoolT,slRate);
    Delay9_out1_s28=l_addSignal(hDiagDataComputationN,'Delay9_out1',hBoolT,slRate);
    Product_out1_s29=l_addSignal(hDiagDataComputationN,'Product_out1',hInputDataT,slRate);
    Sqrt_out1_s30=l_addSignal(hDiagDataComputationN,'Sqrt_out1',hInputDataT,slRate);
    Subtract_out1_s31=l_addSignal(hDiagDataComputationN,'Subtract_out1',hInputDataT,slRate);
    Switch_out1_s32=l_addSignal(hDiagDataComputationN,'Switch_out1',hInputDataT,slRate);
    Switch1_out1_s33=l_addSignal(hDiagDataComputationN,'Switch1_out1',hInputDataT,slRate);
    Switch2_out1_s34=l_addSignal(hDiagDataComputationN,'Switch2_out1',hInputDataT,slRate);
    Switch3_out1_s35=l_addSignal(hDiagDataComputationN,'Switch3_out1',hInputDataT,slRate);
    Switch4_out1_s36=l_addSignal(hDiagDataComputationN,'Switch4_out1',hInputDataT,slRate);
    subtractDataOutReg_out1_s39=l_addSignal(hDiagDataComputationN,'subtractDataOutReg_out1',hInputDataT,slRate);
    subtractVldOutReg_out1_s40=l_addSignal(hDiagDataComputationN,'subtractVldOutReg_out1',hBoolT,slRate);

    CompareToConstantS=l_addSignal(hDiagDataComputationN,'CompareToConstant',hBoolT,slRate);
    SubtractOutS=l_addSignal(hDiagDataComputationN,'SubtractOut',hInputDataT,slRate);
    SwitchOutS=l_addSignal(hDiagDataComputationN,'SwitchOut',hInputDataT,slRate);
    CompareToConstantDelayS=l_addSignal(hDiagDataComputationN,'CompareToConstantDelay',hBoolT,slRate);
    SubtractOutDelayS=l_addSignal(hDiagDataComputationN,'SubtractOutDelay',hInputDataT,slRate);
    subtractDataOutRegDelayS=l_addSignal(hDiagDataComputationN,'subtractDataOutRegDelay',hInputDataT,slRate);
    subtractVldOutRegDelayS=l_addSignal(hDiagDataComputationN,'subtractVldOutRegDelay',hBoolT,slRate);


    pirelab.getConstComp(hDiagDataComputationN,...
    Constant_out1_s6,...
    single(0),...
    'Constant','on',1,'','','');

    pirelab.getConstComp(hDiagDataComputationN,...
    Constant4_out1_s7,...
    single(0),...
    'Constant4','on',1,'','','');

    hProdC=pirelab.getMulComp(hDiagDataComputationN,...
    [hDiagDataComputationNinSigs(3),hDiagDataComputationNinSigs(3)],...
    Product_out1_s29,...
    'Floor','Wrap','Product','**','',-1,0);

    pirelab.getIntDelayComp(hDiagDataComputationN,...
    hDiagDataComputationNinSigs(4),...
    Delay16_out1_s17,...
    resolveLatencyForIPType(hProdC,'MUL'),'Delay16',...
    false,...
    0,0,[],0,0);

    pirelab.getIntDelayComp(hDiagDataComputationN,...
    hDiagDataComputationNinSigs(4),...
    Delay17_out1_s18,...
    resolveLatencyForIPType(hProdC,'MUL'),'Delay17',...
    false,...
    0,0,[],0,0);

    pirelab.getIntDelayComp(hDiagDataComputationN,...
    Product_out1_s29,...
    Delay6_out1_s25,...
    resolveLatencyForIPType(hProdC,'MUL'),'Delay6',...
    single(0),...
    0,0,[],0,0);

    pirelab.getIntDelayComp(hDiagDataComputationN,...
    hDiagDataComputationNinSigs(2),...
    Delay7_out1_s26,...
    resolveLatencyForIPType(hProdC,'MUL'),'Delay7',...
    single(0),...
    0,0,[],0,0);

    pirelab.getIntDelayComp(hDiagDataComputationN,...
    hDiagDataComputationNinSigs(1),...
    Delay8_out1_s27,...
    resolveLatencyForIPType(hProdC,'MUL'),'Delay8',...
    false,...
    0,0,[],0,0);

    hAddC=pirelab.getAddComp(hDiagDataComputationN,...
    [Delay4_out1_s23,Delay5_out1_s24],...
    Add_out1_s5,...
    'Floor','Wrap','Add',hInputDataT,'++');

    pirelab.getIntDelayComp(hDiagDataComputationN,...
    Delay_out1_s9,...
    Delay9_out1_s28,...
    resolveLatencyForIPType(hAddC,'ADDSUB'),'Delay9',...
    false,...
    0,0,[],0,0);

    pirelab.getIntDelayComp(hDiagDataComputationN,...
    Delay2_out1_s21,...
    Delay10_out1_s11,...
    resolveLatencyForIPType(hAddC,'ADDSUB'),'Delay10',...
    single(0),...
    0,0,[],0,0);

    pirelab.getIntDelayComp(hDiagDataComputationN,...
    Add_out1_s5,...
    Delay11_out1_s12,...
    resolveLatencyForIPType(hAddC,'ADDSUB'),'Delay11',...
    single(0),...
    0,0,[],0,0);

    pirelab.getIntDelayComp(hDiagDataComputationN,...
    Delay18_out1_s19,...
    Delay19_out1_s20,...
    resolveLatencyForIPType(hAddC,'ADDSUB'),'Delay19',...
    false,...
    0,0,[],0,0);


    pirelab.getIntDelayComp(hDiagDataComputationN,...
    Subtract_out1_s31,...
    Delay12_out1_s13,...
    resolveLatencyForIPType(hAddC,'ADDSUB'),'Delay12',...
    single(0),...
    0,0,[],0,0);

    pirelab.getIntDelayComp(hDiagDataComputationN,...
    Delay1_out1_s10,...
    Delay13_out1_s14,...
    resolveLatencyForIPType(hAddC,'ADDSUB'),'Delay13',...
    false,...
    0,0,[],0,0);


    pirelab.getIntDelayComp(hDiagDataComputationN,...
    CompareToConstantS,...
    CompareToConstantDelayS,...
    resolveLatencyForIPType(hAddC,'ADDSUB'),'CompareToConstantDelay',...
    false,...
    0,0,[],0,0);

    pirelab.getIntDelayComp(hDiagDataComputationN,...
    subtractDataOutReg_out1_s39,...
    subtractDataOutRegDelayS,...
    resolveLatencyForIPType(hAddC,'ADDSUB'),'subtractDataOutRegDelay',...
    single(0),...
    0,0,[],0,0);

    pirelab.getIntDelayComp(hDiagDataComputationN,...
    SubtractOutS,...
    SubtractOutDelayS,...
    resolveLatencyForIPType(hAddC,'ADDSUB'),'subtractOutDelay',...
    single(0),...
    0,0,[],0,0);

    pirelab.getIntDelayComp(hDiagDataComputationN,...
    subtractVldOutReg_out1_s40,...
    subtractVldOutRegDelayS,...
    resolveLatencyForIPType(hAddC,'ADDSUB'),'subtractVldOutReg',...
    false,...
    0,0,[],0,0);

    hSqrtC=pirelab.getSqrtComp(hDiagDataComputationN,...
    SwitchOutS,...
    Sqrt_out1_s30,...
    'Sqrt',...
    -1,...
    'sqrt');

    pirelab.getIntDelayComp(hDiagDataComputationN,...
    Sqrt_out1_s30,...
    Delay14_out1_s15,...
    resolveLatencyForIPType(hSqrtC,'SQRT'),'Delay14',...
    single(0),...
    0,0,[],0,0);

    pirelab.getIntDelayComp(hDiagDataComputationN,...
    subtractVldOutRegDelayS,...
    Delay15_out1_s16,...
    resolveLatencyForIPType(hSqrtC,'SQRT'),'Delay15',...
    false,...
    0,0,[],0,0);

    pirelab.getIntDelayComp(hDiagDataComputationN,...
    Delay8_out1_s27,...
    Delay_out1_s9,...
    1,'Delay',...
    false,...
    0,0,[],0,0);

    pirelab.getIntDelayComp(hDiagDataComputationN,...
    Delay9_out1_s28,...
    Delay1_out1_s10,...
    1,'Delay1',...
    false,...
    0,0,[],0,0);

    pirelab.getIntDelayComp(hDiagDataComputationN,...
    Delay16_out1_s17,...
    Delay18_out1_s19,...
    1,'Delay18',...
    false,...
    0,0,[],0,0);



    pirelab.getIntDelayComp(hDiagDataComputationN,...
    Delay7_out1_s26,...
    Delay2_out1_s21,...
    1,'Delay2',...
    single(0),...
    0,0,[],0,0);

    pirelab.getIntDelayComp(hDiagDataComputationN,...
    Delay10_out1_s11,...
    Delay3_out1_s22,...
    1,'Delay3',...
    single(0),...
    0,0,[],0,0);

    pirelab.getIntDelayComp(hDiagDataComputationN,...
    Switch_out1_s32,...
    Delay4_out1_s23,...
    1,'Delay4',...
    single(0),...
    0,0,[],0,0);

    pirelab.getIntDelayComp(hDiagDataComputationN,...
    Switch1_out1_s33,...
    Delay5_out1_s24,...
    1,'Delay5',...
    single(0),...
    0,0,[],0,0);

    pirelab.getIntDelayComp(hDiagDataComputationN,...
    Switch3_out1_s35,...
    hDiagDataComputationNoutSigs(2),...
    1,'sqrtData',...
    single(0),...
    0,0,[],0,0);

    pirelab.getIntDelayComp(hDiagDataComputationN,...
    Delay15_out1_s16,...
    hDiagDataComputationNoutSigs(1),...
    1,'sqrtValidOut',...
    false,...
    0,0,[],0,0);

    pirelab.getIntDelayComp(hDiagDataComputationN,...
    Switch2_out1_s34,...
    subtractDataOutReg_out1_s39,...
    1,'subtractDataOutReg',...
    single(0),...
    0,0,[],0,0);




    pirelab.getIntDelayComp(hDiagDataComputationN,...
    Delay13_out1_s14,...
    subtractVldOutReg_out1_s40,...
    1,'subtractVldOutReg',...
    false,...
    0,0,[],0,0);

    pirelab.getDTCComp(hDiagDataComputationN,...
    Delay12_out1_s13,...
    DataTypeConversion_out1_s8,...
    'Floor','Wrap','RWV','Data Type Conversion');



    pirelab.getCompareToValueComp(hDiagDataComputationN,...
    subtractDataOutReg_out1_s39,...
    CompareToConstantS,...
    '<',0,...
    sprintf('Compare\nTo Constant'),0);



    pirelab.getAddComp(hDiagDataComputationN,...
    [Constant_out1_s6,subtractDataOutReg_out1_s39],...
    SubtractOutS,...
    'Floor','Wrap','Subtract',hInputDataT,'+-');



    pirelab.getSwitchComp(hDiagDataComputationN,...
    [SubtractOutDelayS,subtractDataOutRegDelayS],...
    SwitchOutS,...
    CompareToConstantDelayS,'Switch',...
    '~=',0,'Floor','Wrap');



    pirelab.getAddComp(hDiagDataComputationN,...
    [Delay3_out1_s22,Delay5_out1_s24],...
    Subtract_out1_s31,...
    'Floor','Wrap','Subtract',hInputDataT,'+-');

    pirelab.getSwitchComp(hDiagDataComputationN,...
    [Delay6_out1_s25,Constant_out1_s6],...
    Switch_out1_s32,...
    Delay17_out1_s18,'Switch',...
    '~=',0,'Floor','Wrap');

    pirelab.getSwitchComp(hDiagDataComputationN,...
    [Constant_out1_s6,Switch4_out1_s36],...
    Switch1_out1_s33,...
    hDiagDataComputationNinSigs(5),'Switch1',...
    '~=',0,'Floor','Wrap');

    pirelab.getSwitchComp(hDiagDataComputationN,...
    [DataTypeConversion_out1_s8,Constant_out1_s6],...
    Switch2_out1_s34,...
    Delay13_out1_s14,'Switch2',...
    '~=',0,'Floor','Wrap');

    pirelab.getSwitchComp(hDiagDataComputationN,...
    [Delay14_out1_s15,Constant4_out1_s7],...
    Switch3_out1_s35,...
    Delay15_out1_s16,'Switch3',...
    '~=',0,'Floor','Wrap');

    pirelab.getSwitchComp(hDiagDataComputationN,...
    [Delay11_out1_s12,Delay5_out1_s24],...
    Switch4_out1_s36,...
    Delay19_out1_s20,'Switch4',...
    '~=',0,'Floor','Wrap');

    pirelab.instantiateNetwork(hN,hDiagDataComputationN,DiagDataComputationInSigs,...
    DiagDataComputationOutSigs,[hDiagDataComputationN.Name,'_inst']);
end



function hS=l_addSignal(hN,sigName,pirTyp,simulinkRate)
    hS=hN.addSignal;
    hS.Name=sigName;
    hS.Type=pirTyp;
    hS.SimulinkHandle=-1;
    hS.SimulinkRate=simulinkRate;
end

function latency=resolveLatencyForIPType(hC,targetIPType)

    hDriver=hdlcurrentdriver;

    p=pir(hC.Owner.getCtxName);
    targetCompDataType='SINGLE';
    targetDriver=hDriver.getTargetCodeGenDriver(p);
    if isempty(targetDriver)||~strcmpi(class(targetDriver),'targetcodegen.nfpdriver')
        latency=-1;
        return;
    end

    latency=targetDriver.getDefaultLatency(targetIPType,targetCompDataType,hC);
end



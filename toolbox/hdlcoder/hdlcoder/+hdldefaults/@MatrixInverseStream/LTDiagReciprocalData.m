
function LTDiagReciprocalData(~,hN,LTDiagReciprocalDataInSigs,LTDiagReciprocalDataOutSigs,...
    hBoolT,hInputDataT,slRate)


    hLTDiagReciprocalDataN=pirelab.createNewNetwork(...
    'Name','LTDiagReciprocalData',...
    'InportNames',{'diagValidOut','diagDataOut'},...
    'InportTypes',[hBoolT,hInputDataT],...
    'InportRates',slRate*ones(1,2),...
    'OutportNames',{'reciprocalOutValid','reciprocalOutData','rowDone'},...
    'OutportTypes',[hBoolT,hInputDataT,hBoolT]);

    hLTDiagReciprocalDataN.setTargetCompReplacementCandidate(true);



    for ii=1:numel(hLTDiagReciprocalDataN.PirOutputSignals)
        hLTDiagReciprocalDataN.PirOutputSignals(ii).SimulinkRate=slRate;
    end

    hLTDiagReciprocalDataNinSigs=hLTDiagReciprocalDataN.PirInputSignals;
    hLTDiagReciprocalDataNoutSigs=hLTDiagReciprocalDataN.PirOutputSignals;

    diagDataOut=hLTDiagReciprocalDataNinSigs(2);


    Constant_out1_s2=l_addSignal(hLTDiagReciprocalDataN,'Constant_out1',hInputDataT,slRate);
    Delay_out1_s3=l_addSignal(hLTDiagReciprocalDataN,'Delay_out1',hInputDataT,slRate);
    Delay1_out1_s4=l_addSignal(hLTDiagReciprocalDataN,'Delay1_out1',hBoolT,slRate);
    Reciprocal_out1_s6=l_addSignal(hLTDiagReciprocalDataN,'Reciprocal_out1',hInputDataT,slRate);
    Switch_out1_s7=l_addSignal(hLTDiagReciprocalDataN,'Switch_out1',hInputDataT,slRate);
    Reciprocal_prod_out_s10=l_addSignal(hLTDiagReciprocalDataN,'Reciprocal_prod_out',hInputDataT,slRate);
    CompareToConstantS=l_addSignal(hLTDiagReciprocalDataN,'CompareToConstant',hBoolT,slRate);
    SwitchOutS=l_addSignal(hLTDiagReciprocalDataN,'SwitchOut',hInputDataT,slRate);
    DelayConstantOutS=l_addSignal(hLTDiagReciprocalDataN,'DelayConstantOut',hInputDataT,slRate);
    CompareToConstantDelayS=l_addSignal(hLTDiagReciprocalDataN,'CompareToConstantDelay',hBoolT,slRate);


    pirelab.getConstComp(hLTDiagReciprocalDataN,...
    Constant_out1_s2,...
    single(0),...
    'Constant','on',1,'','','');

    hRecipC=pirelab.getMathComp(hLTDiagReciprocalDataN,...
    Reciprocal_prod_out_s10,...
    Reciprocal_out1_s6,...
    'Reciprocal_recip',...
    -1,...
    'reciprocal');

    pirelab.getIntDelayComp(hLTDiagReciprocalDataN,...
    Reciprocal_out1_s6,...
    Delay_out1_s3,...
    resolveLatencyForIPType(hRecipC,'RECIP'),...
    'Delay',...
    single(0),...
    0,0,[],0,0);

    pirelab.getIntDelayComp(hLTDiagReciprocalDataN,...
    Constant_out1_s2,...
    DelayConstantOutS,...
    resolveLatencyForIPType(hRecipC,'RECIP'),'Delay',...
    single(0),...
    0,0,[],0,0);

    pirelab.getIntDelayComp(hLTDiagReciprocalDataN,...
    hLTDiagReciprocalDataNinSigs(1),...
    Delay1_out1_s4,...
    resolveLatencyForIPType(hRecipC,'RECIP'),'Delay1',...
    false,...
    0,0,[],0,0);

    pirelab.getIntDelayComp(hLTDiagReciprocalDataN,...
    hLTDiagReciprocalDataNoutSigs(1),...
    hLTDiagReciprocalDataNoutSigs(3),...
    1,'Delay2',...
    false,...
    0,0,[],0,0);

    pirelab.getIntDelayComp(hLTDiagReciprocalDataN,...
    Switch_out1_s7,...
    hLTDiagReciprocalDataNoutSigs(2),...
    1,'reciprocalDataReg',...
    single(0),...
    0,0,[],0,0);


    pirelab.getIntDelayComp(hLTDiagReciprocalDataN,...
    Delay1_out1_s4,...
    hLTDiagReciprocalDataNoutSigs(1),...
    1,'reciprocalValidOutReg',...
    false,...
    0,0,[],0,0);

    pirelab.getWireComp(hLTDiagReciprocalDataN,...
    diagDataOut,...
    Reciprocal_prod_out_s10,...
    'diagDataOut_wire');

    pirelab.getCompareToValueComp(hLTDiagReciprocalDataN,...
    diagDataOut,...
    CompareToConstantS,...
    '~=',0,...
    sprintf('Compare\nTo Constant'),0);

    pirelab.getIntDelayComp(hLTDiagReciprocalDataN,...
    CompareToConstantS,...
    CompareToConstantDelayS,...
    resolveLatencyForIPType(hRecipC,'RECIP'),'CompareToConstantDelay',...
    false,...
    0,0,[],0,0);

    pirelab.getSwitchComp(hLTDiagReciprocalDataN,...
    [Delay_out1_s3,DelayConstantOutS],...
    SwitchOutS,...
    CompareToConstantDelayS,'Switch',...
    '~=',0,'Floor','Wrap');


    pirelab.getSwitchComp(hLTDiagReciprocalDataN,...
    [SwitchOutS,Constant_out1_s2],...
    Switch_out1_s7,...
    Delay1_out1_s4,'Switch',...
    '~=',0,'Floor','Wrap');


    pirelab.instantiateNetwork(hN,hLTDiagReciprocalDataN,LTDiagReciprocalDataInSigs,...
    LTDiagReciprocalDataOutSigs,[hLTDiagReciprocalDataN.Name,'_inst']);


end


function hS=l_addSignal(hN,sigName,pirTyp,simulinkRate)
    hS=hN.addSignal;
    hS.Name=sigName;
    hS.Type=pirTyp;
    hS.SimulinkHandle=-1;
    hS.SimulinkRate=simulinkRate;
end


function latency=resolveLatencyForIPType(hC,targetIPType)

    hDriver=hdlcurrentdriver;

    p=pir(hC.Owner.getCtxName);
    targetCompDataType='SINGLE';
    targetDriver=hDriver.getTargetCodeGenDriver(p);
    if isempty(targetDriver)||~strcmpi(class(targetDriver),'targetcodegen.nfpdriver')
        latency=-1;
        return;
    end

    latency=targetDriver.getDefaultLatency(targetIPType,targetCompDataType,hC);
end

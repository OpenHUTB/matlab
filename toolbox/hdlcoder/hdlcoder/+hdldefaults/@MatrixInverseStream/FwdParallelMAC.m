

function FwdParallelMAC(this,hN,FwdMacInSigs,FwdMacOutSigs,...
    hBoolT,hInputDataT,slRate,blockInfo)


    hFwdMacN=pirelab.createNewNetwork(...
    'Name','FwdParallelMAC',...
    'InportNames',{'reciprocalData','pipelineData1','pipelineData2',...
    'nonDiagValidIn','rowProcDone','rowCount','colCount'},...
    'InportTypes',[hInputDataT,...
    FwdMacInSigs(2).Type,...
    FwdMacInSigs(3).Type,...
    hBoolT,hBoolT,FwdMacInSigs(6).Type,FwdMacInSigs(7).Type],...
    'InportRates',slRate*ones(1,7),...
    'OutportNames',{'procData','nonDiagOutValid'},...
    'OutportTypes',[FwdMacOutSigs(1).Type,hBoolT]);

    hFwdMacN.setTargetCompReplacementCandidate(true);


    for ii=1:numel(hFwdMacN.PirOutputSignals)
        hFwdMacN.PirOutputSignals(ii).SimulinkRate=slRate;
    end

    hFwdMacNinSigs=hFwdMacN.PirInputSignals;
    hFwdMacNoutSigs=hFwdMacN.PirOutputSignals;

    if bitand(blockInfo.RowSize,blockInfo.RowSize*2-1)==blockInfo.RowSize
        hCounterT=hFwdMacN.getType('FixedPoint','Signed',false,'WordLength',ceil(log2(blockInfo.RowSize))+1,...
        'FractionLength',0);
    else
        hCounterT=hFwdMacN.getType('FixedPoint','Signed',false,'WordLength',ceil(log2(blockInfo.RowSize)),...
        'FractionLength',0);
    end

    Constant1_out1_s8=l_addSignal(hFwdMacN,'Constant1_out1',hInputDataT,slRate);
    Constant2_out1_s9=l_addSignal(hFwdMacN,'Constant2_out1',hInputDataT,slRate);
    Subtract_out1_s50=l_addSignal(hFwdMacN,'Subtract_out1',hInputDataT,slRate);
    Delay10_out1_s12=l_addSignal(hFwdMacN,'Delay10_out1',hBoolT,slRate);
    Delay11_out1_s13=l_addSignal(hFwdMacN,'Delay11_out1',hInputDataT,slRate);
    Delay15_out1_s17=l_addSignal(hFwdMacN,'Delay15_out1',hBoolT,slRate);
    Delay16_out1_s18=l_addSignal(hFwdMacN,'Delay16_out1',hInputDataT,slRate);
    Delay20_out1_s23=l_addSignal(hFwdMacN,'Delay20_out1',hBoolT,slRate);
    Delay21_out1_s24=l_addSignal(hFwdMacN,'Delay21_out1',hInputDataT,slRate);
    Delay22_out1_s25=l_addSignal(hFwdMacN,'Delay22_out1',hBoolT,slRate);
    Delay24_out1_s27=l_addSignal(hFwdMacN,'Delay24_out1',hBoolT,slRate);
    Delay6_out1_s34=l_addSignal(hFwdMacN,'Delay6_out1',hInputDataT,slRate);

    if(blockInfo.RowSize>2)
        procVecDataS=l_addSignal(hFwdMacN,'procVecData',pirelab.createPirArrayType(hInputDataT,[blockInfo.RowSize-1,0]),slRate);
    else
        procVecDataS=l_addSignal(hFwdMacN,'procVecData',hInputDataT,slRate);
    end

    nonDiagDataOutS=l_addSignal(hFwdMacN,'nonDiagDataOut',hInputDataT,slRate);
    ProductOutS=l_addSignal(hFwdMacN,'Product3',hInputDataT,slRate);
    Delay23S=l_addSignal(hFwdMacN,'Delay23',hInputDataT,slRate);
    Switch4S=l_addSignal(hFwdMacN,'Switch4',hInputDataT,slRate);


    if blockInfo.RowSize>2
        rdDataPipeline1=hFwdMacNinSigs(2).split;
        rdDataPipeline1SplitSigS=rdDataPipeline1.PirOutputSignals;
    else
        rdDataPipeline1=hFwdMacNinSigs(2);
        rdDataPipeline1SplitSigS=rdDataPipeline1;
    end

    rdDataPipeline2=hFwdMacNinSigs(3);

    if blockInfo.RowSize>2
        iterEndVal=blockInfo.RowSize-1;
    else
        iterEndVal=1;
    end

    if(blockInfo.RowSize>1)
        DelayOut=hdlhandles(1,blockInfo.RowSize-1);

        ProductS=hdlhandles(1,blockInfo.RowSize-1);
        Delay12S=hdlhandles(1,blockInfo.RowSize-1);
        Switch2S=hdlhandles(1,blockInfo.RowSize-1);
        DelayS=hdlhandles(1,blockInfo.RowSize-1);
        AddS=hdlhandles(1,blockInfo.RowSize-1);
        Delay17S=hdlhandles(1,blockInfo.RowSize-1);
        Switch3S=hdlhandles(1,blockInfo.RowSize-1);
        Delay3S=hdlhandles(1,blockInfo.RowSize-1);
        SwitchAddOutS=hdlhandles(1,blockInfo.RowSize-1);
    end

    for itr=1:iterEndVal
        suffix=['_',int2str(itr)];

        ProductS(itr)=l_addSignal(hFwdMacN,['Product',suffix],hInputDataT,slRate);
        Delay12S(itr)=l_addSignal(hFwdMacN,['Delay12',suffix],hInputDataT,slRate);
        Switch2S(itr)=l_addSignal(hFwdMacN,['Switch2',suffix],hInputDataT,slRate);
        DelayS(itr)=l_addSignal(hFwdMacN,['Delay',suffix],hInputDataT,slRate);
        AddS(itr)=l_addSignal(hFwdMacN,['Add',suffix],hInputDataT,slRate);
        Delay17S(itr)=l_addSignal(hFwdMacN,['Delay17',suffix],hInputDataT,slRate);
        Switch3S(itr)=l_addSignal(hFwdMacN,['Switch3',suffix],hInputDataT,slRate);
        Delay3S(itr)=l_addSignal(hFwdMacN,['Delay3',suffix],hInputDataT,slRate);
        SwitchAddOutS(itr)=l_addSignal(hFwdMacN,['SwitchAddOut',suffix],hInputDataT,slRate);

        hMultC=pirelab.getMulComp(hFwdMacN,...
        [rdDataPipeline1SplitSigS(itr),rdDataPipeline2],...
        ProductS(itr),...
        'Floor','Wrap',['Product',suffix],'**','',-1,0);

        pirelab.getIntDelayComp(hFwdMacN,...
        ProductS(itr),...
        Delay12S(itr),...
        resolveLatencyForIPType(hMultC,'MUL'),['Delay12',suffix],...
        single(0),...
        0,0,[],0,0);

        pirelab.getSwitchComp(hFwdMacN,...
        [Delay12S(itr),Constant2_out1_s9],...
        Switch2S(itr),...
        Delay10_out1_s12,['Switch2',suffix],...
        '~=',0,'Floor','Wrap');

        pirelab.getIntDelayComp(hFwdMacN,...
        Switch2S(itr),...
        DelayS(itr),...
        1,['Delay',suffix],...
        single(0),...
        0,0,[],0,0);

        hAddC=pirelab.getAddComp(hFwdMacN,...
        [Delay3S(itr),DelayS(itr)],...
        AddS(itr),...
        'Floor','Wrap',['Add',suffix],hInputDataT,'++');


        pirelab.getIntDelayComp(hFwdMacN,...
        AddS(itr),...
        Delay17S(itr),...
        resolveLatencyForIPType(hAddC,'ADDSUB'),['Delay17',suffix],...
        single(0),...
        0,0,[],0,0);

        pirelab.getSwitchComp(hFwdMacN,...
        [Delay17S(itr),Delay3S(itr)],...
        SwitchAddOutS(itr),...
        Delay15_out1_s17,['Switch3',suffix],...
        '~=',0,'Floor','Wrap');

        pirelab.getSwitchComp(hFwdMacN,...
        [Constant2_out1_s9,SwitchAddOutS(itr)],...
        Switch3S(itr),...
        hFwdMacNinSigs(5),['Switch3',suffix],...
        '~=',0,'Floor','Wrap');

        pirelab.getIntDelayComp(hFwdMacN,...
        Switch3S(itr),...
        Delay3S(itr),...
        1,['Delay3',suffix],...
        single(0),...
        0,0,[],0,0);

        DelayOut(itr)=Delay3S(itr);

    end

    pirelab.getConstComp(hFwdMacN,...
    Constant1_out1_s8,...
    single(0),...
    'Constant1','on',1,'','','');


    pirelab.getConstComp(hFwdMacN,...
    Constant2_out1_s9,...
    single(0),...
    'Constant2','on',1,'','','');

    pirelab.getIntDelayComp(hFwdMacN,...
    hFwdMacNinSigs(4),...
    Delay10_out1_s12,...
    resolveLatencyForIPType(hMultC,'MUL'),'Delay10',...
    false,...
    0,0,[],0,0);

    pirelab.getIntDelayComp(hFwdMacN,...
    Subtract_out1_s50,...
    Delay11_out1_s13,...
    resolveLatencyForIPType(hAddC,'ADDSUB'),'Delay11',...
    single(0),...
    0,0,[],0,0);

    pirelab.getIntDelayComp(hFwdMacN,...
    Delay24_out1_s27,...
    Delay15_out1_s17,...
    resolveLatencyForIPType(hAddC,'ADDSUB'),'Delay15',...
    false,...
    0,0,[],0,0);

    pirelab.getIntDelayComp(hFwdMacN,...
    Delay6_out1_s34,...
    Delay16_out1_s18,...
    resolveLatencyForIPType(hAddC,'ADDSUB'),'Delay16',...
    single(0),...
    0,0,[],0,0);

    pirelab.getIntDelayComp(hFwdMacN,...
    Delay22_out1_s25,...
    Delay20_out1_s23,...
    resolveLatencyForIPType(hMultC,'MUL'),'Delay20',...
    false,...
    0,0,[],0,0);
    pirelab.getIntDelayComp(hFwdMacN,...
    Delay20_out1_s23,...
    hFwdMacNoutSigs(2),...
    1,'Delay25',...
    false,...
    0,0,[],0,0);


    pirelab.getIntDelayComp(hFwdMacN,...
    Delay16_out1_s18,...
    Delay21_out1_s24,...
    1,'Delay21',...
    single(0),...
    0,0,[],0,0);

    pirelab.getIntDelayComp(hFwdMacN,...
    Delay15_out1_s17,...
    Delay22_out1_s25,...
    1,'Delay22',...
    false,...
    0,0,[],0,0);

    pirelab.getIntDelayComp(hFwdMacN,...
    Delay10_out1_s12,...
    Delay24_out1_s27,...
    1,'Delay24',...
    false,...
    0,0,[],0,0);

    pirelab.getIntDelayComp(hFwdMacN,...
    Delay11_out1_s13,...
    Delay6_out1_s34,...
    1,'Delay6',...
    single(0),...
    0,0,[],0,0);

    pirelab.getAddComp(hFwdMacN,...
    [Constant1_out1_s8,hFwdMacNinSigs(1)],...
    Subtract_out1_s50,...
    'Floor','Wrap','Subtract',hInputDataT,'+-');

    pirelab.getMuxComp(hFwdMacN,...
    DelayOut(1:end),...
    procVecDataS,...
    'concatenate');

    hMult2C=pirelab.getMulComp(hFwdMacN,...
    [Delay21_out1_s24,nonDiagDataOutS],...
    ProductOutS,...
    'Floor','Wrap','ProductOut','**','',-1,0);

    pirelab.getIntDelayComp(hFwdMacN,...
    ProductOutS,...
    Delay23S,...
    resolveLatencyForIPType(hMult2C,'MUL'),'Delay23',...
    single(0),...
    0,0,[],0,0);

    pirelab.getSwitchComp(hFwdMacN,...
    [Delay23S,Constant2_out1_s9],...
    Switch4S,...
    Delay20_out1_s23,'Switch4',...
    '~=',0,'Floor','Wrap');

    pirelab.getIntDelayComp(hFwdMacN,...
    Switch4S,...
    hFwdMacNoutSigs(1),...
    1,'Delay7',...
    single(0),...
    0,0,[],0,0);





    ProcDataSelInSigs=[hFwdMacNinSigs(6),hFwdMacNinSigs(7),...
    procVecDataS];
    ProcDataSelOutSigs=nonDiagDataOutS;

    this.ProcessDataSelector(hFwdMacN,ProcDataSelInSigs,ProcDataSelOutSigs,...
    hCounterT,hInputDataT,slRate,blockInfo);

    pirelab.instantiateNetwork(hN,hFwdMacN,FwdMacInSigs,...
    FwdMacOutSigs,[hFwdMacN.Name,'_inst']);

end


function hS=l_addSignal(hN,sigName,pirTyp,simulinkRate)
    hS=hN.addSignal;
    hS.Name=sigName;
    hS.Type=pirTyp;
    hS.SimulinkHandle=-1;
    hS.SimulinkRate=simulinkRate;
end

function latency=resolveLatencyForIPType(hC,targetIPType)

    hDriver=hdlcurrentdriver;

    p=pir(hC.Owner.getCtxName);
    targetCompDataType='SINGLE';
    targetDriver=hDriver.getTargetCodeGenDriver(p);
    if isempty(targetDriver)||~strcmpi(class(targetDriver),'targetcodegen.nfpdriver')
        latency=-1;
        return;
    end
    latency=targetDriver.getDefaultLatency(targetIPType,targetCompDataType,hC);
end



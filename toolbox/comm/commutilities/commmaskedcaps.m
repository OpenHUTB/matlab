function subsysCap=commmaskedcaps(block)






    if~strcmpi(get_param(block,'Mask'),'on')
        DAStudio.error('Simulink:bcst:ErrOnlyMasks',mfilename);
    end

    maskType=get_param(block,'MaskType');


    [maskStr,trans]=getMaskStr(maskType,block);


    if strcmpi(get_param(block,'Mask'),'on')&&...
        strcmpi(get_param(block,'BlockType'),'SubSystem')&&...
        isSublibrary(block)
        maskStr='';

    end


    subsysCap=bcstCreateCap(maskType,maskStr,trans);



    function[subsysCapStr,trans]=getMaskStr(maskType,block)

        persistent maskTable transTable;
        if isempty(maskTable)
            [maskTable,transTable]=getMaskTable;
        end

        if isempty(maskType)||(strcmpi(get_param(block,'BlockType'),'SubSystem')&&isempty(get_param(block,'Blocks')))

            subsysCapStr='';
            trans=transTable;
        else

            findMask=find(strcmp(maskType,maskTable(:,2)));
            if~isempty(findMask)

                subsysCapStr=maskTable{findMask,1};
                trans=transTable;
            else
                DAStudio.error('Simulink:bcst:ErrMaskNotFound',maskType,mfilename);
            end
        end



        function[maskTable,transTable]=getMaskTable



            transTable.d='double';

            transTable.s='single';
            transTable.si='singleIn';
            transTable.so='singleOut';
            transTable.depends.si='s';
            transTable.depends.so='s';

            transTable.b='boolean';
            transTable.bi='booleanIn';
            transTable.bo='booleanOut';
            transTable.depends.bi='b';
            transTable.depends.bo='b';

            transTable.i='integer';
            transTable.ii='integerIn';
            transTable.io='integerOut';
            transTable.depends.ii='i';
            transTable.depends.io='i';

            transTable.f='fixedpt';
            transTable.fi='fixedptIn';
            transTable.fo='fixedptOut';
            transTable.depends.fi='f';
            transTable.depends.fo='f';

            transTable.e='enumerated';
            transTable.B='bus';

            transTable.c='codegen';
            transTable.p='production';
            transTable.m='multidimension';
            transTable.v='variablesize';
            transTable.I='foreach';

































            maskTable={...
...
...
...
            'd;s;b;i;c;p','Bernoulli Binary Generator';...
            'd;i;c;p','Poisson Integer Generator';...
            'd;s;b;i;c;p','Random Integer Generator';...
...
            'd;i;c.comm_FnNoSuppIntOnlyCodegen;p;','Barker Code Generator';...
            'd;b;fo.comm_Fnu1asic;c;p;v;','Gold Sequence Generator';...
            'd;i;c.comm_FnNoSuppIntOnlyCodegen;p;','Hadamard Code Generator';...
            'd;b;c;p;v;I;','Kasami Sequence Generator';...
            'd;i;c.comm_FnNoSuppIntOnlyCodegen;p;','OVSF Code Generator';...
            'd;b;I;fo.comm_Fnbpack;c;p;v;','PN Sequence Generator';...
            'd;i;c.comm_FnNoSuppIntOnlyCodegen;p;','Walsh Code Generator';...
            'd;s;i;c;p;','Baseband File Reader';...
...
            'd;s;b;i;f;c;p;v;I;','Error Rate Calculation';...
            'd;s;i;c;p;','Baseband File Writer';...
...
            'd;c;p;','A-Law Compressor';...
            'd;c;p;','A-Law Expander';...
            'd;s;b;i;f;c;p;','Differential Decoder';...
            'd;s;b;i;f;c;p;','Differential Encoder';...
            'd;c;p;','Mu-Law Compressor';...
            'd;c;p;','Mu-Law Expander';...
            'd;s;f;c;p;','Quantizing Decoder';...
            'd;s;f.comm_Fns;c;p;','Quantizing Encoder';...
...
            'd;b;c;p;v;I;','General CRC Generator';...
            'd;b;c;p;v;I;','General CRC Syndrome Detector';...
            'd;s;b;i;f;c;','General CRC Generator HDL Optimized';...
            'd;s;b;i;f;c;','General CRC Syndrome Detector HDL Optimized';...
...
            'd;s;b;i;c;p;I;','BCH Decoder';...
            'd;s;b;i;c;p;I;','BCH Encoder';...
            'd;s;b;i;f;c;p;','Binary Cyclic Decoder';...
            'd;s;b;i;f;c;p;','Binary Cyclic Encoder';...
            'd;s;b;i;f;c;p;','Binary Linear Decoder';...
            'd;s;b;i;f;c;p;','Binary Linear Encoder';...
            'd;s;b;i;f.comm_Fnu1;c;p;','Binary-Input RS Encoder';...
            'd;s;b;i;f.comm_Fnu1;c;p;','Binary-Output RS Decoder';...
            'd;s;b;i;f;c;p;','Hamming Decoder';...
            'd;s;b;i;f;c;p;','Hamming Encoder';...
            'd;s;i;c;p;I;','Integer-Input RS Encoder';...
            'd;s;i;c;p;I;','Integer-Output RS Decoder';...
            'd;b;c;p;','LDPC Decoder';...
            'd;s;b;i;c;p;','LDPC Encoder';...
            'd;s;i;f;c;','Integer-Input RS Encoder HDL Optimized';...
            'd;s;i;f;c;','Integer-Output RS Decoder HDL Optimized';...
            'd;si;bo;c;p;','TPC Decoder';...
            'd;s;b;i;c;p;','TPC Encoder';...
...
            'd;s;c;p;v;I;','APP Decoder';...
            'd;s;b;i;f.comm_Fnu1;c;p;v;I;','Convolutional Encoder';...
            'd;si;c;p;v;I;','Turbo Decoder';...
            'd;s;b;i;f.comm_Fnu1;c;p;v;I;','Turbo Encoder';...
            'd;s;b;i;f.comm_Fnudecn;c;p;v;I;','Viterbi Decoder';...
...
            'd;s;b;i;f;e;c;p;I;','Algebraic Deinterleaver';...
            'd;s;b;i;f;e;c;p;I;','Algebraic Interleaver';...
            'd;s;b;i;f;e;c;p;v;I;','General Block Deinterleaver';...
            'd;s;b;i;f;e;c;p;v;I;','General Block Interleaver';...
            'd;s;b;i;f;e;c;p;I;','Matrix Deinterleaver';...
            'd;s;b;i;f;e;c;p;I;','Matrix Helical Scan Deinterleaver';...
            'd;s;b;i;f;e;c;p;I;','Matrix Helical Scan Interleaver';...
            'd;s;b;i;f;e;c;p;I;','Matrix Interleaver';...
            'd;s;b;i;f;e;c;p;I;','Random Deinterleaver';...
            'd;s;b;i;f;e;c;p;I;','Random Interleaver';...
...
            'd;s;b;i;f;c;p;I;','Convolutional Deinterleaver';...
            'd;s;b;i;f;c;p;I;','Convolutional Interleaver';...
            'd;s;b;i;f;c;p;I;','General Multiplexed Deinterleaver';...
            'd;s;b;i;f;c;p;I;','General Multiplexed Interleaver';...
            'd;s;b;i;f;c;p;','Helical Deinterleaver';...
            'd;s;b;i;f;c;p;','Helical Interleaver';...
...
            'd;s;bo;io;f.comm_Fnis,comm_Fnouk;c;p;v;I;','General QAM Demodulator Baseband';...
            'd;so;bi;ii;f.comm_Fniuk,comm_Fnos;c;p;v;I;','General QAM Modulator Baseband';...
            'd;s;bo;io;f.comm_Fnis,comm_Fnouk;c;p;v;I;','M-PAM Demodulator Baseband';...
            'd;so;bi;ii;f.comm_Fniukbi,comm_Fnos;c;p;v;I;','M-PAM Modulator Baseband';...
            'd;s;bo;io;f.comm_FnSquareQAMOnly,comm_Fnis,comm_Fnouk;c;p;v;I;','Rectangular QAM Demodulator Baseband';...
            'd;so;bi;ii;f.comm_FnSquareQAMOnly,comm_Fniukbi,comm_Fnos;c;p;v;I;','Rectangular QAM Modulator Baseband';...
            'd;s;bo;io;m;c;p;','MIL-188 QAM Demodulator Baseband';...
            'd;s;bi;ii;m;c;p;','MIL-188 QAM Modulator Baseband';...
...
            'd;si;bo;io;f.comm_Fnis,comm_Fnou1;c;p;v;I;','BPSK Demodulator Baseband';...
            'd;so;bi;ii;f.comm_Fniuk,comm_Fnos;c;p;v;I;','BPSK Modulator Baseband';...
            'd;si;bo;io;c;p;I;','DBPSK Demodulator Baseband';...
            'd;so;bi;ii;c;p;I;','DBPSK Modulator Baseband';...
            'd;si;bo;io;c;p;I;','DQPSK Demodulator Baseband';...
            'd;so;bi;ii;c;p;I;','DQPSK Modulator Baseband';...
            'd;si;bo;io;c;p;I;','M-DPSK Demodulator Baseband';...
            'd;so;bi;ii;c;p;I;','M-DPSK Modulator Baseband';...
            'd;si;bo;io;f.comm_FnM8Only,comm_Fnis,comm_Fnouk;c;p;v;I;','M-PSK Demodulator Baseband';...
            'd;so;bi;ii;f.comm_Fniukbi,comm_Fnos;c;p;v;I;','M-PSK Modulator Baseband';...
            'd;si;bo;io;c.comm_FnTrigSubOnlySingleRate;p;I.comm_FnTrigSubOnlySingleRate;','OQPSK Demodulator Baseband';...
            'd;so;bi;ii;c.comm_FnTrigSubOnlySingleRate;p;I.comm_FnTrigSubOnlySingleRate;','OQPSK Modulator Baseband';...
            'd;si;bo;io;f.comm_Fnis,comm_Fnouk;c;p;v;I;','QPSK Demodulator Baseband';...
            'd;so;bi;ii;f.comm_Fniukbi,comm_Fnos;c;p;v;I;','QPSK Modulator Baseband';...
...
            'd;s;bo;io;m;c;p;','M-APSK Demodulator Baseband';...
            'd;s;bi;ii;m;c;p;','M-APSK Modulator Baseband';...
            'd;s;bo;io;m;c;p;','DVBS-APSK Demodulator Baseband';...
            'd;s;bi;ii;m;c;p;','DVBS-APSK Modulator Baseband';...
...
            'd;si;bo;io;c.comm_FnNoTrigSub;p;','M-FSK Demodulator Baseband';...
            'd;so;bi;ii;c.comm_FnNoTrigSub;p;','M-FSK Modulator Baseband';...
...
            'd;si;bo;io;c.comm_FnTrigSubOnlySingleRate;p;I.comm_FnTrigSubOnlySingleRate;','CPFSK Demodulator Baseband';...
            'd;so;bi;ii;c.comm_FnTrigSubOnlySingleRate;p;I.comm_FnTrigSubOnlySingleRate;','CPFSK Modulator Baseband';...
            'd;si;bo;io;c.comm_FnTrigSubOnlySingleRate;p;I.comm_FnTrigSubOnlySingleRate;','CPM Demodulator Baseband';...
            'd;so;bi;ii;c.comm_FnTrigSubOnlySingleRate;p;I.comm_FnTrigSubOnlySingleRate;','CPM Modulator Baseband';...
            'd;si;bo;io;c.comm_FnTrigSubOnlySingleRate;p;I.comm_FnTrigSubOnlySingleRate;','GMSK Demodulator Baseband';...
            'd;so;bi;ii;c.comm_FnTrigSubOnlySingleRate;p;I.comm_FnTrigSubOnlySingleRate;','GMSK Modulator Baseband';...
            'd;si;bo;io;c.comm_FnTrigSubOnlySingleRate;p;I.comm_FnTrigSubOnlySingleRate;','MSK Demodulator Baseband';...
            'd;so;bi;ii;c.comm_FnTrigSubOnlySingleRate;p;I.comm_FnTrigSubOnlySingleRate;','MSK Modulator Baseband';...
...
            'd;c;m;p;','OFDM Demodulator';...
            'd;c;m;p;','OFDM Modulator';...
...
            'd;si;bo;c;p;I;','General TCM Decoder';...
            'd;so;bi;fi.comm_Fnu1;c;p;','General TCM Encoder';...
            'd;si;bo;c;p;I;','M-PSK TCM Decoder';...
            'd;so;bi;fi.comm_Fnu1;c;p;','M-PSK TCM Encoder';...
            'd;si;bo;c;p;I;','Rectangular QAM TCM Decoder';...
            'd;so;bi;fi.comm_Fnu1;c;p;','Rectangular QAM TCM Encoder';...
...
            'd;s;bo;io;m;c;p;','DVBS-APSK Demodulator Baseband';...
            'd;s;bi;ii;m;c;p;','DVBS-APSK Modulator Baseband';...
            'd;s;bo;io;m;c;p;','MIL-188 QAM Demodulator Baseband';...
            'd;s;bi;ii;m;c;p;','MIL-188 QAM Modulator Baseband';...
...
            'd;s;c.comm_FnNoTrigSub;p;','FM Modulator Baseband';...
            'd;s;c.comm_FnNoTrigSub;p;','FM Demodulator Baseband';...
            'd;s;c.comm_FnNoTrigSub;p;','FM Broadcast Modulator Baseband';...
            'd;s;c.comm_FnNoTrigSub;p;','FM Broadcast Demodulator Baseband';...
...
            'd;p;','DSB AM Demodulator Passband';...
            'd;c;p;','DSB AM Modulator Passband';...
            'd;p;','DSBSC AM Demodulator Passband';...
            'd;c;p;','DSBSC AM Modulator Passband';...
            'd;c;p;','FM Demodulator Passband';...
            'd;c;p;','FM Modulator Passband';...
            'd;c;p;','PM Demodulator Passband';...
            'd;c;p;','PM Modulator Passband';...
            'd;p;','SSB AM Demodulator Passband';...
            'd;c;p;','SSB AM Modulator Passband';...
...
...
            'd;s;f.comm_Fnos;c;p;v;','Ideal Rectangular Pulse Filter';...
            'd;s;f;c.comm_FnTrigSubOnlySingleRate;p;I.comm_FnTrigSubOnlySingleRate;','Integrate and Dump';...
            'd;s;f.comm_Fnos;c;p;v;','Raised Cosine Receive Filter';...
            'd;s;f.comm_Fnos;c;p;v;','Raised Cosine Transmit Filter';...
            'd;s;f.comm_Fns;c;p;v','Windowed Integrator';...
...
            'd;s;c;p;','AWGN Channel';...
            'd;s;b;i;f;c;p;','Binary Symmetric Channel';...
            'd;s;m;c;p;v;','SISO Fading Channel';...
            'd;s;m;c;p;v;','MIMO Fading Channel';...
...
            'd;s;c;p;','Free Space Path Loss';...
            'd;s;c;p;','I/Q Imbalance';...
            'd;s;c;p;','Memoryless Nonlinearity';...
            'd;s;c;p;','Phase Noise';...
            'd;s;c;p;','Phase/Frequency Offset';...
            'd;s;c.comm_FnNoTrigSub;p;','Receiver Thermal Noise';...
            'd;s;c;p;v;','Amplifier';...
            'd;s;c;p;','Multiband Combiner';...
            'd;s;c;p;v;','Sample Rate Offset';...
            'd;s;c;p;','Sample-Rate Match';...
...
...
            'd;s;c;p;v;','AGC';...
            'd;s;c.comm_FnNoTrigSub;p;','Coarse Frequency Compensator';...
            'd;s;c;p;v;','DPD';...
            'd;s;c;p;v;','DPD Coefficient Estimator';...
            'd;s;c;p;','I/Q Compensator Coefficient to Imbalance';...
            'd;s;c;p;','I/Q Imbalance Compensator';...
            'd;s;c;p;','I/Q Imbalance to Compensator Coefficient';...
            'd;s;c;p;','Phase/Frequency Offset';...
...
            'd;s;c.comm_FnNoTrigSub;p;v;','Carrier Synchronizer';...
            'd;s;c.comm_FnNoTrigSub;p;','Coarse Frequency Compensator';...
            'd;s;c;p;v;','Symbol Synchronizer';...
            'd;s;bi.comm_Fnibi;ii.comm_Fnibi,comm_Fnius8;c;p;v;','Preamble Detector';...
...
            'd;s;c;p;','CMA Equalizer';...
            'd;s;c;p;','LMS Decision Feedback Equalizer';...
            'd;s;c;p;','LMS Linear Equalizer';...
            'd;s;c;p;I;','MLSE Equalizer';...
            'd;s;c;p;','Normalized LMS Decision Feedback Equalizer';...
            'd;s;c;p;','Normalized LMS Linear Equalizer';...
            'd;s;c;p;','RLS Decision Feedback Equalizer';...
            'd;s;c;p;','RLS Linear Equalizer';...
            'd;s;c;p;','Sign LMS Decision Feedback Equalizer';...
            'd;s;c;p;','Sign LMS Linear Equalizer';...
            'd;s;c;p;','Variable Step LMS Decision Feedback Equalizer';...
            'd;s;c;p;','Variable Step LMS Linear Equalizer';...
...
            'd;s;c;p;v;','Decision Feedback Equalizer';...
            'd;s;c;p;v;','Linear Equalizer';...
            'd;s;c;p;m;v;','OFDM Equalizer';...
...
            'd;s;m;f.comm_Fns;c;p;v;I;','OSTBC Encoder';...
            'd;s;m;f.comm_Fns;c;p;v;I;','OSTBC Combiner';...
            'd;bo;m;c;p;v;','Sphere Decoder';...
...
            'd;s;b;i;f;e;c;p;I;','Deinterlacer';...
            'd;s;c.comm_FnTrigSubOnlySingleRate;p;I.comm_FnTrigSubOnlySingleRate;','Derepeat';...
            'd;b;i;c;p;I;','Descrambler';...
            'd;s;b;i;f;e;c;p;I;','Interlacer';...
            'd;s;b;i;f;e;c;p;I;','Puncture';...
            'd;b;i;c;p;I;','Scrambler';...
...
            'd;s;bo;i;f.comm_Fns;c;p;','Bipolar to Unipolar Converter';...
            'd;s;c;p;','Complex Phase Difference';...
            'd;s;c;p;','Complex Phase Shift';...
            'd;s;i;f;c;p;','Data Mapper';...
            'd;si;ii.comm_Fns;fi.comm_Fns;c;m;p;v;I;','EVM Measurement';...
            'd;s;i.comm_FnSIntsOnly;e;c.comm_FnNoTrigSub;p;','Find Delay';...
            'd;si;ii.comm_Fns;fi.comm_Fns;c;m;p;v;I;','MER Measurement';...
            'd;s;bi;i;f;c;p;','Unipolar to Bipolar Converter';...
            };



            function isSubLib=isSublibrary(block)

                cnln=newline;
                sublibs={...
                'commlibv2/Channels',...
                ['commlibv2/Comm',cnln,'Filters'],...
                ['commlibv2/Comm',cnln,'Sinks'],...
                ['commlibv2/Comm',cnln,'Sources'],...
                'commlibv2/Demos',...
                'commlibv2/Equalizers',...
                ['commlibv2/Error Detection',cnln,'and Correction'],...
                'commlibv2/Interleaving',...
                'commlibv2/Modulation',...
                'commlibv2/MIMO',...
                ['commlibv2/RF Impairments',cnln,'and Components'],...
                ['commlibv2/RF Impairments',cnln,'Correction'],...
                ['commlibv2/Sequence',cnln,'Operations'],...
                ['commlibv2/Source',cnln,'Coding'],...
                'commlibv2/Synchronization',...
                ['commlibv2/Utility',cnln,'Blocks'],...
                ['commfilt2/Filter Designs',cnln,'Library Link'],...
                ['commfilt2/Multirate Filters',cnln,'Library Link'],...
                'commsource2/Random Data Sources',...
                'commsource2/Sequence Generators',...
                'commedac2/Block',...
                'commedac2/CRC',...
                'commedac2/Convolutional',...
                'comminterleave2/Block',...
                'comminterleave2/Convolutional',...
                ['commmod2/Analog',cnln,'Passband',cnln,'Modulation'],...
                ['commmod2/Digital',cnln,'Baseband',cnln,'Modulation'],...
                'commdigbbnd2/AM',...
                'commdigbbnd2/APM',...
                'commdigbbnd2/CPM',...
                'commdigbbnd2/FM',...
                'commdigbbnd2/PM',...
                'commdigbbnd2/Standard-Compliant',...
                'commdigbbnd2/TCM',...
                };

                nameSp=[get_param(block,'Parent'),'/',get_param(block,'Name')];

                isSubLib=any(strcmp(nameSp,sublibs));








function[T_in,props]=preprocess2P(mdot,h_in,p,...
    u_TLU,v_TLU,T_TLU,nu_TLU,k_TLU,Pr_TLU,idx_liq,idx_vap,...
    a_liq,a_vap,a_mix,b,c,D_ref,S_ref,Nu_lam,delta_h_thres)

%#codegen
    coder.allowpcode('plain')


    h_TLU=u_TLU+p*v_TLU;


    mu_TLU=nu_TLU./v_TLU;


    T_in=interp1(h_TLU,T_TLU,h_in,'linear','extrap');


    v_sat_liq=v_TLU(idx_liq);
    v_sat_vap=v_TLU(idx_vap);

    if v_sat_vap/v_sat_liq>1+1e-6
        sqrt_v_sat_ratio=sqrt(v_sat_vap/v_sat_liq);
    else
        sqrt_v_sat_ratio=sqrt(1+1e-6);
    end


    props=struct(...
    'mdot',mdot,...
    'u_TLU',u_TLU,...
    'h_TLU',h_TLU,...
    'v_TLU',v_TLU,...
    'T_TLU',T_TLU,...
    'mu_TLU',mu_TLU,...
    'k_TLU',k_TLU,...
    'Pr_TLU',Pr_TLU,...
    'v_sat_liq',v_sat_liq,...
    'v_sat_vap',v_sat_vap,...
    'h_sat_liq',h_TLU(idx_liq),...
    'h_sat_vap',h_TLU(idx_vap),...
    'T_sat_liq',T_TLU(idx_liq),...
    'T_sat_vap',T_TLU(idx_vap),...
    'mu_sat_liq',mu_TLU(idx_liq),...
    'mu_sat_vap',mu_TLU(idx_vap),...
    'k_sat_liq',k_TLU(idx_liq),...
    'k_sat_vap',k_TLU(idx_vap),...
    'Pr_sat_liq',Pr_TLU(idx_liq),...
    'Pr_sat_vap',Pr_TLU(idx_vap),...
    'sqrt_v_sat_ratio',sqrt_v_sat_ratio,...
    'a_liq',a_liq,...
    'a_vap',a_vap,...
    'a_mix',a_mix,...
    'b',b,...
    'c',c,...
    'DS_ratio',D_ref/S_ref,...
    'Nu_lam',Nu_lam,...
    'delta_h_thres',delta_h_thres);

end
function sl_postprocess(h)





    engine_block=sprintf('sdl_lib/Engines & Motors/Generic Engine');
    engine_LoadFcn=get_param(engine_block,'LoadFcn');
    new_engine_LoadFcn=sprintf([engine_LoadFcn,'\nif get_param(bdroot,''VersionLoaded'') <= 8',...
    '\n   sdl_internal.line_mover(gcbh, 4,5);','\nend']);
    set_param(engine_block,'LoadFcn',new_engine_LoadFcn);



    add_block('sdl_transmission_templates/Transmissions','sdl_lib/Transmissions');

    set_param('sdl_lib/Transmissions','Tag','simscape_sublibrary');

    nesl_libautolayout=nesl_private('nesl_libautolayout');
    nesl_libautolayout(h);


    copyFcnStr=sprintf('set_param(gcb,''auto_seed'',num2str(randi(2^32-1)))');
    set_param(sprintf('sdl_lib/Sources/Force Noise Source'),'copyFcn',copyFcnStr);
    set_param(sprintf('sdl_lib/Sources/Torque Noise Source'),'copyFcn',copyFcnStr);
    set_param(sprintf('sdl_lib/Sources/Translational Velocity Noise Source'),'copyFcn',copyFcnStr);
    set_param(sprintf('sdl_lib/Sources/Rotational Velocity Noise Source'),'copyFcn',copyFcnStr);


    gearLibrary=find_system(h,'SearchDepth',1,'Name','Gears');
    reorder_library(gearLibrary,{sprintf('Planetary\nSubcomponents'),'Rotational'})

    clutchLibrary=find_system(h,'SearchDepth',1,'Name','Clutches');
    reorder_library(clutchLibrary,{sprintf('Fundamental\nComponents')})

    couplingsLibrary=find_system(h,'SearchDepth',1,'Name','Couplings & Drives');
    reorder_library(couplingsLibrary,{sprintf('Springs & Dampers')})

    transmissionsLibrary=find_system(h,'SearchDepth',1,'Name','Transmissions');
    reorder_library(transmissionsLibrary,{sprintf('10-Speed')})


    ft={
    {sprintf('sdl_lib/Engines/Generic Engine'),sprintf('sdl_lib/Engines & Motors/Generic Engine')}...
    ,{sprintf('sdl_lib/Engines/Piston Engine'),sprintf('sdl_lib/Engines & Motors/Piston Engine')}...
    ,{sprintf('sdl_lib/Engines/Piston'),sprintf('sdl_lib/Engines & Motors/Piston')}...
    };

    set_param(h,'ForwardingTable',ft);

    simscape.internal.blockforwarding.registerBlockUpdates(h,...
    {sprintf('sdl_lib/Tires & Vehicles/Vehicle Body'),...
    '0.0','8009000.1'});
    simscape.internal.blockforwarding.registerBlockUpdates(h,...
    {sprintf('sdl_lib/Inertias & Loads/Variable Inertia'),...
    '0.0','8009000.1'});
    simscape.internal.blockforwarding.registerBlockUpdates(h,...
    {sprintf('sdl_lib/Inertias & Loads/Variable Mass'),...
    '0.0','8009000.1'});
    simscape.internal.blockforwarding.registerBlockUpdates(h,...
    {sprintf('sdl_lib/Couplings & Drives/Springs & Dampers/Variable Rotational Spring'),...
    '0.0','8009000.1'});
    simscape.internal.blockforwarding.registerBlockUpdates(h,...
    {sprintf('sdl_lib/Couplings & Drives/Springs & Dampers/Variable Translational Spring'),...
    '0.0','8009000.1'});
    simscape.internal.blockforwarding.registerBlockUpdates(h,...
    {sprintf('sdl_lib/Couplings & Drives/Springs & Dampers/Nonlinear Rotational Spring'),...
    '0.0','8009000.1'});
    simscape.internal.blockforwarding.registerBlockUpdates(h,...
    {sprintf('sdl_lib/Couplings & Drives/Springs & Dampers/Nonlinear Translational Spring'),...
    '0.0','8009000.1'});
    simscape.internal.blockforwarding.registerBlockUpdates(h,...
    {sprintf('sdl_lib/Couplings & Drives/Chain Drive'),...
    '0.0','10001000.1'});
    simscape.internal.blockforwarding.registerBlockUpdates(h,...
    {sprintf('sdl_lib/Sources/Sinusoidal Force Source'),...
    '0.0','10005000.1'});
    simscape.internal.blockforwarding.registerBlockUpdates(h,...
    {sprintf('sdl_lib/Sources/Sinusoidal Torque Source'),...
    '0.0','10005000.1'});
    simscape.internal.blockforwarding.registerBlockUpdates(h,...
    {sprintf('sdl_lib/Sources/Sinusoidal Translational Velocity Source'),...
    '0.0','10005000.1'});
    simscape.internal.blockforwarding.registerBlockUpdates(h,...
    {sprintf('sdl_lib/Sources/Sinusoidal Rotational Velocity Source'),...
    '0.0','10005000.1'});


    simscape.internal.blockforwarding.registerBlockUpdates(h,...
    {sprintf('sdl_lib/Couplings & Drives/Shock Absorber'),...
    '0.0','9000000.1'});
    simscape.internal.blockforwarding.registerBlockUpdates(h,...
    {sprintf('sdl_lib/Couplings & Drives/Torsional Spring-Damper'),...
    '0.0','9000000.1'});


    simscape.internal.blockforwarding.registerBlockUpdates(h,...
    {sprintf('sdl_lib/Tires & Vehicles/Tire (Friction Parameterized)'),...
    '0.0','10006000.1'});


    simscape.internal.blockforwarding.registerBlockUpdates(h,...
    {sprintf('sdl_lib/Tires & Vehicles/Tire (Magic Formula)'),...
    '0.0','9002000.1'});
    simscape.internal.blockforwarding.registerBlockUpdates(h,...
    {sprintf('sdl_lib/Tires & Vehicles/Tire Subcomponents/Tire-Road Interaction (Magic Formula)'),...
    '0.0','9002000.1'});


    simscape.internal.blockforwarding.registerBlockUpdates(h,...
    {sprintf('sdl_lib/Brakes & Detents/Rotational/Band Brake'),...
    '0.0','9004000.1'});
    simscape.internal.blockforwarding.registerBlockUpdates(h,...
    {sprintf('sdl_lib/Brakes & Detents/Rotational/Disc Brake'),...
    '0.0','9004000.1'});
    simscape.internal.blockforwarding.registerBlockUpdates(h,...
    {sprintf('sdl_lib/Brakes & Detents/Rotational/Double-Shoe Brake'),...
    '0.0','9004000.1'});
    simscape.internal.blockforwarding.registerBlockUpdates(h,...
    {sprintf('sdl_lib/Brakes & Detents/Rotational/Loaded-Contact Rotational Friction'),...
    '0.0','9004000.1'});
    simscape.internal.blockforwarding.registerBlockUpdates(h,...
    {sprintf('sdl_lib/Brakes & Detents/Translational/Loaded-Contact Translational Friction'),...
    '0.0','9004000.1'});
    simscape.internal.blockforwarding.registerBlockUpdates(h,...
    {sprintf('sdl_lib/Clutches/Fundamental Components/Fundamental Friction Clutch'),...
    '0.0','9004000.1'});
    simscape.internal.blockforwarding.registerBlockUpdates(h,...
    {sprintf('sdl_lib/Clutches/Cone Clutch'),...
    '0.0','9004000.1'});
    simscape.internal.blockforwarding.registerBlockUpdates(h,...
    {sprintf('sdl_lib/Clutches/Disk Friction Clutch'),...
    '0.0','9004000.1'});
    simscape.internal.blockforwarding.registerBlockUpdates(h,...
    {sprintf('sdl_lib/Clutches/Dog Clutch'),...
    '0.0','9004000.1'});
    simscape.internal.blockforwarding.registerBlockUpdates(h,...
    {sprintf('sdl_lib/Clutches/Double-Sided Synchronizer'),...
    '0.0','9004000.1'});
    simscape.internal.blockforwarding.registerBlockUpdates(h,...
    {sprintf('sdl_lib/Clutches/Synchronizer'),...
    '0.0','9004000.1'});


    simscape.internal.blockforwarding.registerBlockUpdates(h,...
    {sprintf('sdl_lib/Couplings & Drives/Flexible Shaft'),...
    '0.0','9004000.1'});


    simscape.internal.blockforwarding.registerBlockUpdates(h,...
    {sprintf('sdl_lib/Gears/Compound Planetary Gear'),...
    '0.0','10001000.1'});
    simscape.internal.blockforwarding.registerBlockUpdates(h,...
    {sprintf('sdl_lib/Gears/Planetary Gear'),...
    '0.0','10001000.1'});
    simscape.internal.blockforwarding.registerBlockUpdates(h,...
    {sprintf('sdl_lib/Gears/Ravigneaux Gear'),...
    '0.0','10001000.1'});
    simscape.internal.blockforwarding.registerBlockUpdates(h,...
    {sprintf('sdl_lib/Gears/Double-Pinion Planetary Gear'),...
    '0.0','10001000.1'});
    simscape.internal.blockforwarding.registerBlockUpdates(h,...
    {sprintf('sdl_lib/Gears/Differential'),...
    '0.0','10001000.1'});
    simscape.internal.blockforwarding.registerBlockUpdates(h,...
    {sprintf('sdl_lib/Gears/Limited-Slip Differential'),...
    '0.0','10001000.1'});
    simscape.internal.blockforwarding.registerBlockUpdates(h,...
    {sprintf('sdl_lib/Gears/Planetary Subcomponents/Planet-Planet'),...
    '0.0','10001000.1'});
    simscape.internal.blockforwarding.registerBlockUpdates(h,...
    {sprintf('sdl_lib/Gears/Planetary Subcomponents/Ring-Planet'),...
    '0.0','10001000.1'});
    simscape.internal.blockforwarding.registerBlockUpdates(h,...
    {sprintf('sdl_lib/Gears/Planetary Subcomponents/Sun-Planet'),...
    '0.0','10001000.1'});
    simscape.internal.blockforwarding.registerBlockUpdates(h,...
    {sprintf('sdl_lib/Gears/Planetary Subcomponents/Sun-Planet Bevel'),...
    '0.0','10001000.1'});
    simscape.internal.blockforwarding.registerBlockUpdates(h,...
    {sprintf('sdl_lib/Gears/Planetary Subcomponents/Sun-Planet Worm Gear'),...
    '0.0','10001000.1'});


    simscape.internal.blockforwarding.registerBlockUpdates(h,...
    {sprintf('sdl_lib/Couplings & Drives/Universal Joint'),...
    '0.0','10001000.1'});


    simscape.internal.blockforwarding.registerBlockUpdates(h,...
    {sprintf('sdl_lib/Gears/Cycloidal Drive'),...
    '0.0','10002000.1'});
    simscape.internal.blockforwarding.registerBlockUpdates(h,...
    {sprintf('sdl_lib/Gears/Worm Gear'),...
    '0.0','10002000.1'});
    simscape.internal.blockforwarding.registerBlockUpdates(h,...
    {sprintf('sdl_lib/Gears/Simple Gear with Variable Efficiency'),...
    '0.0','10002000.1'});
    simscape.internal.blockforwarding.registerBlockUpdates(h,...
    {sprintf('sdl_lib/Gears/Rotational-\nTranslational/Leadscrew'),...
    '0.0','10002000.1'});
    simscape.internal.blockforwarding.registerBlockUpdates(h,...
    {sprintf('sdl_lib/Gears/Rotational-\nTranslational/Rack & Pinion'),...
    '0.0','10002000.1'});
    simscape.internal.blockforwarding.registerBlockUpdates(h,...
    {sprintf('sdl_lib/Gears/Simple Gear'),...
    '0.0','10002000.1'});
    simscape.internal.blockforwarding.registerBlockUpdates(h,...
    {sprintf('sdl_lib/Gears/Harmonic Drive'),...
    '0.0','10002000.1'});


    simscape.internal.blockforwarding.registerBlockUpdates(h,...
    {sprintf('sdl_lib/Couplings & Drives/Torque Converter'),...
    '0.0','10002000.1'});


    simscape.internal.blockforwarding.registerBlockUpdates(h,...
    {sprintf('sdl_lib/Couplings & Drives/Variable Ratio Transmission'),...
    '0.0','10004000.1'});
    simscape.internal.blockforwarding.registerBlockUpdates(h,...
    {sprintf('sdl_lib/Couplings & Drives/Springs & Dampers/Rotational Damper'),...
    '0.0','10004000.1'});
    simscape.internal.blockforwarding.registerBlockUpdates(h,...
    {sprintf('sdl_lib/Couplings & Drives/Springs & Dampers/Translational Damper'),...
    '0.0','10004000.1'});


    simscape.internal.blockforwarding.registerBlockUpdates(h,...
    {sprintf('sdl_lib/Couplings & Drives/Belt Pulley'),...
    '0.0','10004000.1'});
    simscape.internal.blockforwarding.registerBlockUpdates(h,...
    {sprintf('sdl_lib/Couplings & Drives/Belt Drive'),...
    '0.0','10004000.1'});


    simscape.internal.blockforwarding.registerBlockUpdates(h,...
    {'sdl_lib/Engines & Motors/Propeller',...
    'sdl_lib/Engines & Motors/Marine Propeller'})


    simscape.internal.blockforwarding.registerBlockUpdates(h,...
    {sprintf('sdl_lib/Engines & Motors/Generic Engine'),...
    '0.0','10006000.1'});

end


function reorder_library(sublibraryPath,blocksToMove)




    items=find_system(sublibraryPath,'SearchDepth',1);
    items=items(2:end);
    nItems=length(items);
    nReloc=length(blocksToMove);


    positionData=cell(nItems,1);
    centerPoints=cell(nItems,1);
    idx=zeros(1,nReloc);
    for i=1:nItems
        x=get_param(items(i),'Position');
        positionData{i}=x;
        centerPoints{i}=[(x(1)+x(3))/2,(x(2)+x(4))/2];
        blockName=get_param(items(i),'Name');
        for j=1:nReloc
            if~isempty(strfind(blockName,blocksToMove{j}))
                idx(j)=i;
            end
        end
    end


    order=[];
    for j=1:nItems
        if isempty(find(idx==j,1))
            order=[order,j];%#ok
        end
    end
    newOrder=[order,idx];






    for i=1:nItems
        x_old=positionData{newOrder(i)};
        x0_old=centerPoints{newOrder(i)};
        x0_new=centerPoints{i};
        x_offset=x0_new(1)-x0_old(1);
        y_offset=x0_new(2)-x0_old(2);
        set_param(items(newOrder(i)),'Position',x_old+[x_offset,y_offset,x_offset,y_offset]);
    end

end

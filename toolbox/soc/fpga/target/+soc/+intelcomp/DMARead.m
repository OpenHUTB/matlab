classdef DMARead<soc.intelcomp.IntelComponentBase
    properties
burst_size
fifo_depth
    end

    methods
        function obj=DMARead(varargin)

            obj.Configuration={...
            'dev_addr','0x00000000',...
            'dev_range','0',...
            'btt','24',...
            'mm_dw','64',...
            's_dw','32',...
            'sw_dw','32',...
            'bsize','16',...
            'fifo_depth','4',...
            'mem_addr','0x00000000',...
            'mem_range','0',...
            'diagnostics','1',...
            'bufferSize','1024',...
            'mem_type','memPS',...
            };

            if nargin>0
                obj.Configuration=varargin;
            end

            obj.burst_size=str2double(obj.Configuration.bsize);
            obj.fifo_depth=str2double(obj.Configuration.fifo_depth);

            [fifo_depth,bsize]=soc.internal.getDMAParams(obj.fifo_depth,obj.burst_size,obj.Configuration.mm_dw,obj.Configuration.s_dw);
            obj.Configuration={'fifo_depth',fifo_depth};
            obj.Configuration={'bsize',bsize};


            obj.addClk('dma_mm2s.s_axi_clock','SystemClk');
            obj.addRst('dma_mm2s.s_axi_reset','SystemRstn');
            obj.addAXI4Slave('dma_mm2s.s_axi','reg','sys',obj.Configuration.dev_addr);


            obj.addInterrupt('dma_mm2s.interrupt_sender');


            obj.addClk('dma_mm2s.m_src_axi_clock',obj.type2ClkName(obj.Configuration.mem_type));
            obj.addRst('dma_mm2s.m_src_axi_reset',obj.type2RstnName(obj.Configuration.mem_type));
            obj.addAXI4Master('dma_mm2s.m_src_axi',obj.Configuration.mem_type,obj.Configuration.mem_type);


            obj.addClk('dma_mm2s.if_m_axis_aclk','IPCoreClk');


            obj.addClk('axis_master_gasket.clock','IPCoreClk');
            obj.addRst('axis_master_gasket.reset','IPCoreRstn');


            obj.Instance=[...
'add_instance dma_mm2s axi_dmac 1.0 \n'...
            ,'set_instance_parameter_value dma_mm2s {ASYNC_CLK_DEST_REQ_MANUAL} {1} \n',...
            'set_instance_parameter_value dma_mm2s {ASYNC_CLK_REQ_SRC_MANUAL} {1} \n',...
            'set_instance_parameter_value dma_mm2s {ASYNC_CLK_SRC_DEST_MANUAL} {1} \n',...
            'set_instance_parameter_value dma_mm2s {AUTO_ASYNC_CLK} {1} \n',...
            'set_instance_parameter_value dma_mm2s {AXI_SLICE_DEST} {0} \n',...
            'set_instance_parameter_value dma_mm2s {AXI_SLICE_SRC} {0} \n',...
            'set_instance_parameter_value dma_mm2s {CYCLIC} {0} \n',...
            'set_instance_parameter_value dma_mm2s {DMA_2D_TRANSFER} {0} \n',...
            'set_instance_parameter_value dma_mm2s {DMA_DATA_WIDTH_DEST} {',obj.Configuration.s_dw,'} \n',...
            'set_instance_parameter_value dma_mm2s {DMA_DATA_WIDTH_SRC} {',obj.Configuration.mm_dw,'} \n',...
            'set_instance_parameter_value dma_mm2s {DMA_LENGTH_WIDTH} {24} \n',...
            'set_instance_parameter_value dma_mm2s {MAX_BYTES_PER_BURST} {',obj.Configuration.bsize,'} \n',...
            'set_instance_parameter_value dma_mm2s {DMA_TYPE_DEST} {1} \n',...
            'set_instance_parameter_value dma_mm2s {DMA_TYPE_SRC} {0} \n',...
            'set_instance_parameter_value dma_mm2s {DMA_AXI_PROTOCOL_SRC} {0} \n',...
            'set_instance_parameter_value dma_mm2s {FIFO_SIZE} {',obj.Configuration.fifo_depth,'}\n',...
            'set_instance_parameter_value dma_mm2s {ID} {0}\n',...
            'set_instance_parameter_value dma_mm2s {SYNC_TRANSFER_START} {0} \n',...
            'set_instance_parameter_value dma_mm2s {USE_TLAST_DEST} {1} \n',...
            'set_instance_parameter_value dma_mm2s {ENABLE_DIAGNOSTICS_IF} {',obj.Configuration.diagnostics,'} \n',...
            'add_instance axis_master_gasket axis_master_gasket 1.0 \n',...
            'set_instance_parameter_value axis_master_gasket {DWIDTH} {',obj.Configuration.s_dw,'} \n',...
            'add_connection axis_master_gasket.conduit_tdata  dma_mm2s.if_m_axis_data \n',...
            'add_connection axis_master_gasket.conduit_tready dma_mm2s.if_m_axis_ready \n',...
            'add_connection axis_master_gasket.conduit_tvalid dma_mm2s.if_m_axis_valid \n',...
            'add_connection axis_master_gasket.conduit_tlast  dma_mm2s.if_m_axis_last \n',...
            ];
        end

        function result=validateProperties(obj)
            result=soc.internal.validateDMA(obj.fifo_depth,obj.Configuration.mm_dw,obj.Configuration.s_dw,obj.burst_size,'Reader',obj.BlkName);
        end
    end
end
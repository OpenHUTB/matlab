classdef VDMARead<soc.xilcomp.XilinxComponentBase
    properties
        FrameSize=struct('width',[],'height',[],'hporch',[],'vporch',[]);
buf_depth
bsize
    end

    methods
        function obj=VDMARead(varargin)

            obj.Configuration={...
            'dev_addr','0x00000000',...
            'dev_range','0',...
            'mm_dw','32',...
            'buf_depth','16',...
            'bsize','16',...
            's_dw','16',...
            'diagnostics','0',...
            'mem_addr','0x00000000',...
            'mem_range','0',...
            'mem_type','memPL',...
            };
            if nargin>0
                obj.Configuration=varargin;
            end

            obj.buf_depth=str2double(obj.Configuration.buf_depth);
            obj.bsize=str2double(obj.Configuration.bsize);

            [buf_depth,bsize]=soc.internal.getDMAParams(obj.buf_depth,obj.bsize,obj.Configuration.mm_dw,obj.Configuration.s_dw);
            obj.Configuration={'buf_depth',buf_depth};
            obj.Configuration={'bsize',bsize};


            obj.addAXI4Master('axi_vdma_mm2s_0/m_src_axi',obj.Configuration.mem_type,obj.Configuration.mem_type);
            obj.addAXI4Slave('axi_vdma_mm2s_0/s_axi','reg','sys',obj.Configuration.dev_addr,obj.Configuration.dev_range);


            obj.addClk({'axi_vdma_mm2s_0/s_axi_aclk',},'SystemClk');
            obj.addRst('axi_vdma_mm2s_0/s_axi_aresetn','SystemRstn');
            obj.addClk('axi_vdma_mm2s_0/m_src_axi_aclk',obj.type2ClkName(obj.Configuration.mem_type));
            obj.addRst('axi_vdma_mm2s_0/m_src_axi_aresetn',obj.type2RstnName(obj.Configuration.mem_type));
            obj.addClk('axi_vdma_mm2s_0/m_axis_aclk','IPCoreClk');

            obj.Instance=[...
            'set axi_vdma_mm2s_0 [ create_bd_cell -type ip -vlnv analog.com:user:axi_dmac:1.0 axi_vdma_mm2s_0 ]\n',...
'set_property -dict [list'...
            ,' CONFIG.CYCLIC {true}',...
            ' CONFIG.DMA_2D_TLAST_MODE {1}',...
            ' CONFIG.DMA_2D_TRANSFER {true} ',...
            ' CONFIG.DMA_LENGTH_WIDTH {24}',...
            ' CONFIG.DMA_TYPE_SRC {0} ',...
            ' CONFIG.DMA_TYPE_DEST {1}',...
            ' CONFIG.DMA_AXI_PROTOCOL_SRC {0} ',...
            ' CONFIG.DMA_DATA_WIDTH_DEST ',obj.Configuration.s_dw,...
            ' CONFIG.DMA_DATA_WIDTH_SRC ',obj.Configuration.mm_dw,...
            ' CONFIG.FIFO_SIZE ',obj.Configuration.buf_depth,...
            ' CONFIG.MAX_BYTES_PER_BURST ',obj.Configuration.bsize,...
            ' CONFIG.ENABLE_DIAGNOSTICS_IF ',obj.Configuration.diagnostics,...
            ' CONFIG.ENABLE_FRAME_LOCK {false}',...
            ' CONFIG.SYNC_TRANSFER_START {true}',...
'] $axi_vdma_mm2s_0\n'...
            ];
        end

        function result=validateProperties(obj)
            result=soc.internal.validateDMA(obj.buf_depth,obj.Configuration.mm_dw,obj.Configuration.s_dw,'','Reader',obj.BlkName);
        end
    end
end
